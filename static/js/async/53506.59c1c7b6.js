"use strict";(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([["53506"],{22937(e,t,a){a.d(t,{_o:()=>eD,ZF:()=>ej,Ay:()=>eR});var s,n=a(4440),i=a(96912),r=a(39195),o=a(54166),c=a(40738),g=a(15312);class h{fullSaveState;chapterNum;checkpointNum;constructor(){this.fullSaveState=(0,c._8)()}async loadLastSaveState(){this.fullSaveState=await (0,g.Z)()}registerGameInfo(e,t,a){this.chapterNum=e,this.checkpointNum=t,a||(this.fullSaveState.gameSaveStates[e]=(0,c.GT)())}async saveGame(){eR.getInstance().getCurrentSceneRef()instanceof r.A&&(this.fullSaveState=(0,c.Bt)(this.fullSaveState,this.getChapterNum(),this.getCheckpointNum()),await (0,g.i)(this.fullSaveState))}async saveChapterComplete(e){this.fullSaveState.gameSaveStates[e].chapterNewlyCompleted=!0,e>this.getLargestCompletedChapterNum()&&(this.fullSaveState.userSaveState.largestCompletedChapter=e),await (0,g.i)(this.fullSaveState)}async saveSettings(e){this.fullSaveState.userSaveState.settings=e,await (0,g.i)(this.fullSaveState)}getSettings(){return this.fullSaveState.userSaveState.settings}getLoadedUserState(){return this.fullSaveState.userSaveState}getLargestCompletedChapterNum(){return this.fullSaveState.userSaveState.largestCompletedChapter}getGameSaveState(){return this.fullSaveState.gameSaveStates[this.getChapterNum()]||(0,c.GT)()}getLoadedLocation(){return this.getGameSaveState().currentLocation}getChapterSaveState(e){return this.fullSaveState.gameSaveStates[e]||(0,c.GT)()}getTriggeredStateChangeActions=()=>this.getGameSaveState().triggeredStateChangeActions;getTriggeredInteractions=()=>this.getGameSaveState().triggeredInteractions;getCompletedObjectives=()=>this.getGameSaveState().completedObjectives;getCompletedTasks=()=>this.getGameSaveState().completedTasks;getIncompleteTasks=()=>this.getGameSaveState().incompleteTasks;getLoadedPhase=()=>this.getGameSaveState().currentPhase;getChapterNewlyCompleted=()=>this.getGameSaveState().chapterNewlyCompleted;getQuizScores=()=>this.getGameSaveState().quizScores;getChapterNum=()=>(0,o.y)(this.chapterNum);getCheckpointNum=()=>(0,o.y)(this.checkpointNum);getFullSaveState=()=>this.fullSaveState}var l=a(84977),d=a(68440),p=a(45798),u=a(21638),y=a(89751),m=a(72407),M=a(3563),A=a(1185),w=a(7329);let k={key:A.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},I=["Clang. Thud. One hit to the wall, one hit to my flesh.","","They told me I was to be the pillar of this","spaceship - who knew they meant it literally?","- A. Halim"],b=["I blink synchronously with the screen;","I breathe as the machine steams on and off.","","Behind this closed space, my very blood fuels","these engines - hoping for you to find me.","- T. S. Chong"];function S(e,t,a,s,n=50,i=50){let r=new Phaser.GameObjects.Rectangle(e,a,s,n,i,0,0),o="A"===t?I:b;r.setInteractive({useHandCursor:!0}),r.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>f(e,o)),e.getLayerManager().addToLayer(7,r)}async function f(e,t){let a=(0,M.gN)(e).setInteractive().setAlpha(0),s=(0,m.XA)({numOfItems:t.length,xSpacing:0,ySpacing:80}),n={x:i.MF.x,y:0,oriX:.5,oriY:.5},r=i.MF.y-80*t.length*.5;e.getLayerManager().addToLayer(13,a),e.add.tween((0,M.qG)([a],i.YM.fadeDuration)),eR.getInstance().getSoundManager().playSound(y.A.radioStatic.key),await (0,o.yy)(i.YM.fadeDuration),t.forEach((t,a)=>{let i=function(e,t,a={x:0,y:0,oriX:.5,oriY:.5},s=k,n=4,i=5,r=3){let o=[];for(let c=0;c<n;c++){let n={x:a.x+i*Math.random(),y:a.y+r*Math.random(),oriX:a.oriX,oriY:a.oriY},c=(0,w.P)(e,t,n,s);c.setAlpha(.4).setBlendMode(Phaser.BlendModes.SCREEN),o.push(c)}return o.forEach(t=>{e.tweens.add({targets:t,x:t.x+i*Math.random(),y:t.y+r*Math.random(),alpha:.5,duration:20,yoyo:!0,loop:-1,loopDelay:1e3*Math.random()})}),o}(e,t,{...n,y:s[a][1]+r});i.forEach(t=>e.getLayerManager().addToLayer(13,t)),setTimeout(()=>i.forEach(e=>e.destroy()),5e3)}),await (0,o.yy)(5e3),(0,M.E_)(e,a)}var C=a(35071),x=a(96550),P=a(28664),v=a(4907);let T={scrollSpeed:20,tileDim:2048,maxAwardsPerCol:2,arrow:{xOffset:875},award:{xSpace:300,yStart:300,ySpace:i.MF.y-50,dim:200},awardInfo:{width:300},banner:{xOffset:-(.28*i.es.x)},bannerTextConfig:{x:30,y:0,oriX:0,oriY:.5}},L={key:A.A.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},G={fontFamily:"Verdana",fontSize:"30px",fill:m.Q1.lightBlue,align:"center",wordWrap:{width:T.award.dim-20}},O={fontFamily:"Verdana",fontSize:"20px",fill:m.Q1.lightBlue,align:"left",wordWrap:{width:T.awardInfo.width-20}},B={fontFamily:"Verdana",fontSize:"15px",fill:m.Q1.offWhite,align:"left",wordWrap:{width:T.awardInfo.width-20}},E={fontFamily:"Verdana",fontSize:"15px",fill:m.Q1.lightBlue,align:"left",wordWrap:{width:T.awardInfo.width-20}};class j extends Phaser.Scene{layerManager;inputManager;backgroundTile;awardsContainer;isScrollLeft;isScrollRight;scrollLim;awardXSpace;constructor(){super("AwardsHall"),eR.getInstance().setCurrentSceneRef(this),this.isScrollLeft=!1,this.isScrollRight=!1,this.scrollLim=0,this.awardXSpace=0}init(){this.layerManager=new x.A(this),this.inputManager=new C.A(this)}preload(){(0,u.K)(this)}async create(){let e=this.getUserStateManager().getAchievements().length,t=this.getUserStateManager().getCollectibles().length;this.awardXSpace=Math.ceil(Math.max(e,t)/T.maxAwardsPerCol)*T.award.xSpace,this.scrollLim=this.awardXSpace<i.es.x?0:this.awardXSpace-i.es.x,this.renderBackground(),this.renderAwards(),S(this,"A",.95*i.es.x,.99*i.es.y)}update(){if(!this.backgroundTile||!this.awardsContainer)return;let e=this.awardsContainer.x;this.isScrollRight?e-=T.scrollSpeed:this.isScrollLeft&&(e+=T.scrollSpeed),e=(0,o.NS)(e,-this.scrollLim,0),this.backgroundTile.tilePositionX=-e,this.awardsContainer.x=e}renderBackground(){this.backgroundTile&&this.backgroundTile.destroy(),this.backgroundTile=new Phaser.GameObjects.TileSprite(this,0,0,T.tileDim,T.tileDim,l.A.awardsBackground.key).setOrigin(0,.25),this.getLayerManager().addToLayer(1,this.backgroundTile);let e=["Achievements","Collectibles"],t=(0,m.lj)({direction:"Column",numOfItems:e.length});e.forEach((e,a)=>{let s=this.createBanner(e,t[a][1]);this.getLayerManager().addToLayer(7,s)});let a=(0,P.T)(this,{assetKey:l.A.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(i.MF.x-T.arrow.xOffset,i.MF.y),s=(0,P.T)(this,{assetKey:l.A.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(i.MF.x+T.arrow.xOffset,i.MF.y).setScale(-1,1),n=new p.A(this,()=>{this.cleanUp(),this.scene.start("MainMenu")});this.getLayerManager().addToLayer(7,a),this.getLayerManager().addToLayer(7,s),this.getLayerManager().addToLayer(7,n)}renderAwards(){this.awardsContainer&&this.awardsContainer.destroy(),this.awardsContainer=new Phaser.GameObjects.Container(this,0,0);let e=this.getAwards(this.getUserStateManager().getAchievements()),t=(0,m.lj)({direction:"Column",numOfItems:e.length,numItemLimit:T.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:T.award.ySpace});this.awardsContainer.add(e.map((e,a)=>this.createAward(e,t[a][0],t[a][1]+T.award.yStart-i.MF.y)));let a=this.getAwards(this.getUserStateManager().getCollectibles()),s=(0,m.lj)({direction:"Column",numOfItems:a.length,numItemLimit:T.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:T.award.ySpace});this.awardsContainer.add(a.map((e,t)=>this.createAward(e,s[t][0],s[t][1]+T.award.yStart))),this.getLayerManager().addToLayer(8,this.awardsContainer)}getAwards(e){return(0,d.cc)(e)}createAward(e,t,a){let s,n,r,o,c,g,h,d,p=new Phaser.GameObjects.Container(this,t,a);if(e.assetKey===i.YM.nullInteractionId){(s=new Phaser.GameObjects.Rectangle(this,0,0,T.award.dim,T.award.dim,m.Xj.darkBlue,.8)).setInteractive();let t=new Phaser.GameObjects.Text(this,0,0,e.title,G).setOrigin(.5,.5);p.add([s,t])}else s=new Phaser.GameObjects.Sprite(this,0,0,e.assetKey).setOrigin(.5),(0,v.Dz)(s,T.award.dim,T.award.dim),s.setInteractive({pixelPerfect:!0,useHandCursor:!0}),p.add(s);let u=new Phaser.GameObjects.Rectangle(this,0,0,T.award.dim,T.award.dim,0).setAlpha(.8*!e.completed);p.add(u);let y=(n=new Phaser.GameObjects.Container(this,0,0),r=new Phaser.GameObjects.Text(this,20,20,e.title,O),o=new Phaser.GameObjects.Text(this,20,r.getBounds().bottom+20,e.assetKey,B),c=new Phaser.GameObjects.Text(this,20,o.getBounds().bottom+20,e.description,E),g=new Phaser.GameObjects.Rectangle(this,0,0,T.awardInfo.width,c.getBounds().bottom+20,m.Xj.darkBlue).setOrigin(0,0).setAlpha(.8),h=new Phaser.GameObjects.Sprite(this,T.awardInfo.width/2,0,l.A.scrollFrame.key),d=new Phaser.GameObjects.Sprite(this,T.awardInfo.width/2,g.getBounds().bottom,l.A.scrollFrame.key),n.add([g,r,c,h,d]),e.completed&&n.add(o),n.setVisible(!1),n);return s.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>y.setVisible(!0)),s.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>y.setVisible(!1)),s.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,e=>{y.x=e.x+10,y.y=e.y-10}),this.getLayerManager().addToLayer(7,y),p}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createBanner(e,t){let a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Sprite(this,T.banner.xOffset,0,l.A.awardsPage.key),n=(0,w.P)(this,e,T.bannerTextConfig,L);return a.add([s,n]),a}getUserStateManager=()=>eR.getInstance().getUserStateManager();getInputManager=()=>(0,o.y)(this.inputManager);getLayerManager=()=>(0,o.y)(this.layerManager)}let R={keyTextConfig:{x:i.MF.x-100,y:0,oriX:.5,oriY:.5},keyDescTextConfig:{x:i.MF.x+100,y:0,oriX:.5,oriY:.5},key:{xOffset:i.es.x/5,yOffset1:i.MF.y-i.es.y/4,yOffset2:i.MF.y-i.es.y/1.5,yInterval:150},icon:{x:i.MF.x-100}},N={key:A.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},D={key:A.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class F extends Phaser.Scene{layerManager;inputManager;constructor(){super("Bindings")}init(){this.layerManager=new x.A(this),this.inputManager=new C.A(this)}create(){this.renderBackground(),this.renderBindings()}renderBackground(){let e=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,l.A.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,i.MF.x,i.MF.y,i.es.x,i.es.y,0).setAlpha(.3);this.getLayerManager().addToLayer(1,e),this.getLayerManager().addToLayer(1,t)}renderBindings(){let e=new Phaser.GameObjects.Container(this,0,0),t=this.getBindings(),a=(0,m.XA)({numOfItems:t.length,xSpacing:0,ySpacing:R.key.yInterval});e.add(t.map((e,t)=>this.createBinding(e.key,e.text,a[t][1]<450?a[t][0]-R.key.xOffset:a[t][0]+R.key.xOffset,a[t][1]<450?a[t][1]+R.key.yOffset1:a[t][1]+R.key.yOffset2)));let s=new p.A(this,()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")});this.getLayerManager().addToLayer(7,e),this.getLayerManager().addToLayer(7,s)}getBindings(){return[{key:"Esc",text:"Escape Menu"},{key:"Tab",text:"Dashboard"},{key:"Space",text:"Next dialogue"},{key:"E",text:"Explore mode"},{key:"V",text:"Move mode"},{key:"T",text:"Talk mode"},{key:"<Number>",text:"       Select topics/locations"}]}createBinding(e,t,a,s){let n=new Phaser.GameObjects.Container(this,a,s),i=new Phaser.GameObjects.Sprite(this,R.icon.x,0,l.A.squareKeyboardIcon.key);"Tab"===e&&i.setTexture(l.A.medKeyboardIcon.key),"Space"===e&&i.setTexture(l.A.medKeyboardIcon.key),"<Number>"===e&&i.setTexture(l.A.medKeyboardIcon.key);let r=(0,w.P)(this,e,R.keyTextConfig,N),o=(0,w.P)(this,t,R.keyDescTextConfig,D);return n.add([i,r,o]),n}getInputManager=()=>(0,o.y)(this.inputManager);getLayerManager=()=>(0,o.y)(this.layerManager)}var z=a(28949);let U={key:A.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},_={key:A.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},K={key:A.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},V={arrow:{xOffset:875},buttons:{scale:.65},resetButton:{xOffset:135,yOffset:85},playButton:{xOffset:55,yOffset:85},frame:{xOffset:12,yOffset:-4},scrollSpeed:100,indexTextConfig:{x:0,y:-110,oriX:.5,oriY:.5},titleTextConfig:{x:0,y:-50,oriX:.5,oriY:.5},pageNumberTextConfig:{x:i.MF.x,y:i.es.y-30,oriX:.5,oriY:.5},imageRect:{width:400,height:280},imageScale:{x:.8,y:.4},chapComplete:{y:10,height:30,text:"Chapter Completed"},grid:{chapPerRow:3,chapPerCol:3,chapPerPage:9,chapGapX:50,chapGapY:50}};var X=a(94314),Y=a(87293);class Q extends Phaser.Scene{layerManager;chaptersContainer;backButtonContainer;pageNumberText;targetPage;constructor(){super("ChapterSelect"),this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=0}preload(){(0,u.K)(this)}async create(){eR.getInstance().setCurrentSceneRef(this),this.layerManager=new x.A(this),await this.preloadChapterAssets(),this.renderBackground(),this.renderChapters()}update(){if(!this.chaptersContainer)return;let e=-this.targetPage*i.es.x;if(this.chaptersContainer.x>e){let t=this.chaptersContainer.x-V.scrollSpeed;this.chaptersContainer.x=Math.max(t,e)}else if(e>this.chaptersContainer.x){let t=this.chaptersContainer.x+V.scrollSpeed;this.chaptersContainer.x=Math.min(t,e)}}cleanUp(){this.getLayerManager().clearAllLayers()}async preloadChapterAssets(){await Promise.all(this.getGameChapters().map(async e=>await (0,z.yt)(this,e.imageUrl,(0,o.T5)(e.imageUrl,!0))))}renderBackground(){let e=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,l.A.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,i.MF.x,i.MF.y,i.es.x,i.es.y,0).setAlpha(.3);this.getLayerManager().addToLayer(1,e),this.getLayerManager().addToLayer(1,t)}renderChapters(){this.backButtonContainer=new p.A(this,()=>{this.cleanUp(),this.scene.start("MainMenu")}),this.chaptersContainer=this.createChaptersContainer(),this.pageNumberText=(0,w.P)(this,`1 / ${this.numPages()}`,V.pageNumberTextConfig,K);let e=Math.min(eR.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,this.getGameChapters().length-1);this.targetPage=Math.floor(e/V.grid.chapPerPage),this.targetPage<0&&(this.targetPage=0),this.pageNumberText.setText(`${this.targetPage+1} / ${this.numPages()}`);let t=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,l.A.chapterSelectBorder.key),a=(0,P.T)(this,{assetKey:l.A.chapterSelectArrow.key,onUp:()=>this.scrollPrevPage()}).setPosition(i.MF.x-V.arrow.xOffset,i.MF.y),s=(0,P.T)(this,{assetKey:l.A.chapterSelectArrow.key,onUp:()=>this.scrollNextPage()}).setPosition(i.MF.x+V.arrow.xOffset,i.MF.y).setScale(-1,1);this.getLayerManager().addToLayer(7,this.chaptersContainer),this.getLayerManager().addToLayer(7,this.backButtonContainer),this.getLayerManager().addToLayer(7,this.pageNumberText),this.getLayerManager().addToLayer(7,t),this.getLayerManager().addToLayer(7,a),this.getLayerManager().addToLayer(7,s)}createChaptersContainer(){let e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.getGameChapters().map((e,t)=>(function(e,{title:t,imageUrl:a},s){var n;let r,o,c,g,h,d,p,[u,y]=(r=Math.floor((n=s)/V.grid.chapPerPage),o=Math.floor((n%=V.grid.chapPerPage)/V.grid.chapPerRow),c=n%V.grid.chapPerRow,g=(V.grid.chapPerRow-1)/2,h=(V.grid.chapPerCol-1)/2,d=r*i.es.x+i.MF.x+(c-g)*(V.imageRect.width+V.grid.chapGapX),[d,p=i.MF.y+(o-h)*(V.imageRect.height+V.grid.chapGapY)]),m=new Phaser.GameObjects.Container(e,u,y),M=s<=eR.getInstance().getSaveManager().getLargestCompletedChapterNum(),A=new Phaser.GameObjects.Image(e,0,0,a).setDisplaySize(V.imageRect.width,V.imageRect.height),k=new Phaser.GameObjects.Sprite(e,V.frame.xOffset,V.frame.yOffset,l.A.chapterSelectFrame.key).setScale(.99*V.imageScale.x,.99*V.imageScale.y),I=new Phaser.GameObjects.Rectangle(e,0,V.chapComplete.y,V.imageRect.width,V.chapComplete.height,0).setOrigin(.5).setAlpha(.7).setInteractive().setVisible(M),b=(0,w.P)(e,V.chapComplete.text,{x:0,y:V.chapComplete.y,oriX:.5,oriY:.5},U).setVisible(M),S=new X.A(e,V.resetButton.xOffset+8,V.resetButton.yOffset-20,"Reset progress"),f=new X.A(e,V.playButton.xOffset+8,V.playButton.yOffset-20,"Play/Continue"),C=(0,P.T)(e,{assetKey:l.A.chapterRepeatButton.key,onUp:async()=>await (0,Y.X)(!1,s,0),onHover:()=>S.setVisible(!0),onOut:()=>S.setVisible(!1)}).setPosition(V.resetButton.xOffset,V.resetButton.yOffset).setScale(V.buttons.scale),x=eR.getInstance().getSaveManager().getChapterSaveState(s).lastCheckpointPlayed,v=(0,P.T)(e,{assetKey:l.A.chapterContinueButton.key,onUp:async()=>await (0,Y.X)(!0,s,x),onHover:()=>f.setVisible(!0),onOut:()=>f.setVisible(!1)}).setPosition(V.playButton.xOffset,V.playButton.yOffset).setScale(V.buttons.scale),T=(0,w.P)(e,`Chapter ${s}`,V.indexTextConfig,U),L=(0,w.P)(e,t,V.titleTextConfig,_),G=s<=eR.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,O=new Phaser.GameObjects.Rectangle(e,0,0,V.imageRect.width,V.imageRect.height,0).setOrigin(.5).setAlpha(.8*!G).setInteractive();return m.add([A,k,I,b,C,v,S,f,T,L,O]),m})(this,e,t))).sort("depth").reverse(),e}getGameChapters=()=>eR.getInstance().getGameChapters();numPages(){return Math.max(Math.ceil(this.getGameChapters().length/V.grid.chapPerPage),1)}scrollPrevPage(){this.targetPage=Math.max(this.targetPage-1,0),this.pageNumberText?.setText(`${this.targetPage+1} / ${this.numPages()}`)}scrollNextPage(){let e=this.numPages();this.targetPage=Math.min(this.targetPage+1,e-1),this.pageNumberText?.setText(`${this.targetPage+1} / ${e}`)}getLayerManager=()=>(0,o.y)(this.layerManager)}var $=a(64297);let H={key:A.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},W={text:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",awards:"Awards Hall",settings:"Settings",bindings:"Key Bindings"},button:{ySpace:.5*i.es.y},buttonTextConfig:{x:600,y:0,oriX:1,oriY:.1},banner:{xHide:300},onFocusTween:{x:i.MF.x+200,duration:200,ease:"Power2"},outFocusTween:{x:i.MF.x+300,duration:200,ease:"Power2"},saBanner:{x:.3*i.es.x,y:.9*i.es.y}};class q extends Phaser.Scene{layerManager;constructor(){super("MainMenu")}async create(){eR.getInstance().setCurrentSceneRef(this),this.layerManager=new x.A(this),this.renderBackground(),this.renderOptionButtons(),S(this,"T",1.12*i.MF.x,1.1*i.MF.y),eR.getInstance().getSoundManager().playBgMusic(y.A.galacticHarmony.key)}renderBackground(){let e=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,l.A.spaceshipBg.key).setDisplaySize(i.es.x,i.es.y),t=(0,M.gN)(this).setAlpha(.15),a=new Phaser.GameObjects.Image(this,W.saBanner.x,W.saBanner.y,l.A.saBanner.key).setAlpha(.7);this.getLayerManager().addToLayer(1,e),this.getLayerManager().addToLayer(1,t),this.getLayerManager().addToLayer(1,a)}renderOptionButtons(){let e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=(0,m.lj)({direction:"Column",numOfItems:t.length,maxYSpace:W.button.ySpace});e.add(t.map((e,t)=>this.createOptionButton(e.text,a[t][0]+W.banner.xHide,a[t][1],e.callback))),this.getLayerManager().addToLayer(7,e)}createOptionButton(e,t,a,s){let n=e=>{this.tweens.add({targets:e,...W.onFocusTween})},i=e=>{this.tweens.add({targets:e,...W.outFocusTween})},r=(0,P.T)(this,{assetKey:l.A.mainMenuOptBanner.key,message:e,textConfig:W.buttonTextConfig,bitMapTextStyle:H,onUp:s,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1}).setPosition(t,a);return r}getOptionButtons(){return[{text:W.text.chapterSelect,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("ChapterSelect")}},{text:W.text.awards,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("AwardsHall")}},{text:W.text.studentRoom,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("RoomPreview")}},{text:W.text.settings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Settings")}},{text:W.text.bindings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Bindings")}}]}getLayerManager=()=>(0,o.y)(this.layerManager)}var J=a(57415),Z=a(38786),ee=a(27457),et=a(69681),ea=a(50891),es=a(11897),en=a(73631),ei=a(38083),er=a(99562);let eo=`
import { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from 'game';

function preload() {
    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));
}

function create() {
    const width = get_screen_width();
    const height = get_screen_height();
    const centre_x = width / 2;
    const centre_y = height / 2;

    const image = create_image(centre_x, centre_y, "galaxy");
    const image_resized = set_display_size(image, width, height);

    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);
    const black_tint_alpha = set_alpha(black_tint, 0.5);

    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");
    const text_repos = set_origin(text, 0.5, 0.5);

    add(image_resized);
    add(black_tint_alpha);
    add(text_repos);
}

function update() {}
`,ec={key:A.A.pixelFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},eg={assessmentNumber:"MYROOM",verifiedText:"VERIFIED",tag:{width:128,height:50},hoverTagTextConfig:{x:64,y:0,oriX:.5,oriY:.55},refreshButton:{x:.95*i.es.x,y:.92*i.es.y}};var eh=a(31230),el=a(52241);async function ed(){let e=await ep();return e?eu(await (0,eh.BY)(e,eR.getInstance().getAccountInfo())):eu(null)}async function ep(){let e=(await (0,eh.Dc)(eR.getInstance().getAccountInfo())||[]).find(e=>e.number===eg.assessmentNumber);return e?e.id:null}function eu(e){if(e){let t=e.questions[0];return t.answer||t.solutionTemplate}return eo}class ey extends Phaser.Scene{layerManager;inputManager;phaseManager;escapeManager;collectibleManager;achievementManager;toolbarManager;dashboardManager;studentCode;preloadImageMap;preloadSoundMap;preloadSpritesheetMap;verifCont;context;sceneLoaded=!1;constructor(){super("RoomPreview"),this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.preloadSpritesheetMap=new Map,this.studentCode=eo}init(){eR.getInstance().setCurrentSceneRef(this),this.studentCode=eR.getInstance().getRoomCode(),this.createContext()}preload(){let e,t,a,s,n;(0,u.K)(this),this.verifCont=(e=new Phaser.GameObjects.Container(this,0,0),t=new Phaser.GameObjects.Rectangle(this,0,0,eg.tag.width,eg.tag.height,m.Xj.darkBlue).setOrigin(0,.5).setAlpha(.8),a=new Phaser.GameObjects.Sprite(this,0,0,l.A.verifiedFrame.key).setOrigin(0,.5),s=new Phaser.GameObjects.Rectangle(this,0,-(.5*t.height),t.width,.05*t.height,m.Xj.offWhite).setOrigin(0,0),n=(0,w.P)(this,eg.verifiedText,eg.hoverTagTextConfig,ec).setBlendMode(Phaser.BlendModes.DIFFERENCE),this.tweens.add({targets:s,alpha:.2,y:.35*t.height,duration:2e3,ease:"Power0",yoyo:!0,loop:-1}),e.add([t,n,s,a]),e.setVisible(!1),e)}async create(){await this.eval(this.studentCode),this.renderDefaultBackground(),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map(async([e,t])=>{await (0,z.yt)(this,e,t)})),await Promise.all(Array.from(this.preloadSoundMap).map(async([e,t])=>{await (0,z.WO)(this,e,t)})),await Promise.all(Array.from(this.preloadSpritesheetMap).map(async([e,[t,a]])=>{await (0,z.f_)(this,e,t,a)}));let e=new X.A(this,eg.refreshButton.x-200,eg.refreshButton.y-30,"Refresh Room"),t=(0,P.T)(this,{assetKey:l.A.chapterRepeatButton.key,onUp:async()=>{await eR.getInstance().loadRoomCode(),this.studentCode=eR.getInstance().getRoomCode(),this.getLayerManager().clearAllLayers(),this.sound.stopAll(),this.sceneLoaded=!1,this.scene.restart()},onHover:()=>e.setVisible(!0),onOut:()=>e.setVisible(!1)}).setPosition(eg.refreshButton.x,eg.refreshButton.y);await this.eval("create();"),eR.getInstance().getSoundManager().playBgMusic(i.YM.nullInteractionId),this.initialiseManagers(),this.bindKeyboardTriggers(),this.getLayerManager().addToLayer(7,this.getVerifCont()),this.getLayerManager().addToLayer(7,t),this.getLayerManager().addToLayer(7,e),this.getToolbarManager().renderToolbarContainer(),this.sceneLoaded=!0}update(){this.sceneLoaded&&this.eval("update();")}createContext(){this.context=(0,ee.q6)(Z.Chapter.SOURCE_4,[],"playground",Z.Variant.DEFAULT),this.context.moduleContexts.game={tabs:null,state:{scene:this,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,preloadSpritesheetMap:this.preloadSpritesheetMap,remotePath:e=>(0,o.T5)(e,!0),screenSize:i.es,createAward:(e,t,a)=>this.createAward(e,t,a)}}}async eval(e){await (0,J.runInContext)(e,this.context)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase("EscapeMenu")}),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",async()=>{this.getPhaseManager().isCurrentPhase("Dashboard")?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase("Dashboard"):await this.getPhaseManager().pushPhase("Dashboard")})}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createAward(e,t,a){let s=this.getUserStateManager().getAchievements(),n=this.getUserStateManager().getCollectibles(),i=new Phaser.GameObjects.Sprite(this,e,t,l.A.cookies.key);if(!s.includes(a)&&!n.includes(a))return i;let r=(0,d.Ni)(a);if(!r.completed)return i;let o=new Phaser.GameObjects.Sprite(this,e,t,r.assetKey);return this.attachVerificationTag(o)}attachVerificationTag(e){let t=this.getVerifCont();return e.setInteractive({pixelPerfect:!0,useHandCursor:!0}),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>t.setVisible(!0)),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>t.setVisible(!1)),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,e=>{t.x=e.x+10,t.y=e.y-10}),e}renderDefaultBackground(){let e=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,this.getDefaultBackgroundKey());(0,v.v8)(e,i.es.x,i.es.y),this.add.existing(e)}getDefaultBackgroundKey(){let e=this.getUserStateManager().getAssessments().reverse(),t=eR.getInstance().getRoomPreviewMapping();for(let a=0;a<e.length;a++)if(t.has(e[a]))return e[a];return l.A.sourceCrashedPod.key}initialiseManagers(){this.layerManager=new x.A(this),this.inputManager=new C.A(this),this.phaseManager=new ei.A(new Map([["None",new el.A]]),this.inputManager),this.escapeManager=new en.A(this),this.collectibleManager=new et.A(this,eR.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new et.A(this,eR.getInstance().getUserStateManager().getAchievements),this.toolbarManager=new er.A(this),this.dashboardManager=new ea.A(this,[es.G.Collectibles,es.G.Achievements],[this.collectibleManager,this.achievementManager])}getVerifCont=()=>(0,o.y)(this.verifCont);getUserStateManager=()=>eR.getInstance().getUserStateManager();getInputManager=()=>(0,o.y)(this.inputManager);getLayerManager=()=>(0,o.y)(this.layerManager);getPhaseManager=()=>(0,o.y)(this.phaseManager);getEscapeManager=()=>(0,o.y)(this.escapeManager);getCollectibleManager=()=>(0,o.y)(this.collectibleManager);getAchievementManager=()=>(0,o.y)(this.achievementManager);getToolbarManager=()=>(0,o.y)(this.toolbarManager);getDashboardManager=()=>(0,o.y)(this.dashboardManager)}var em=a(39062),eM=a(94321);class eA extends Phaser.Scene{bgmVolumeRadioButtons;sfxVolumeRadioButtons;layerManager;constructor(){super("Settings")}async create(){eR.getInstance().setCurrentSceneRef(this),this.layerManager=new x.A(this),this.renderBackground(),this.renderOptions()}renderBackground(){let e=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,l.A.spaceshipBg.key),t=new Phaser.GameObjects.Image(this,i.MF.x,i.MF.y,l.A.settingBanner.key);this.getLayerManager().addToLayer(1,e),this.getLayerManager().addToLayer(1,t)}renderOptions(){let e=new Phaser.GameObjects.Container(this,0,0),t=this.getSettingsHeader(),a=(0,m.lj)({direction:"Column",numOfItems:t.length,maxYSpace:eM.Ay.opt.ySpace});e.add(t.map((e,t)=>this.createOptionHeader(e,a[t][1])));let{bgmVolume:s,sfxVolume:n}=this.getSaveManager().getSettings(),r=eM.Ay.volContainerOpts.findIndex(e=>parseFloat(e)===n),o=eM.Ay.volContainerOpts.findIndex(e=>parseFloat(e)===s);this.sfxVolumeRadioButtons=this.createOptRadioOptions(r,a[0][1]),this.bgmVolumeRadioButtons=this.createOptRadioOptions(o,a[1][1]);let c=(0,P.T)(this,{assetKey:l.A.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:eM.I,onUp:()=>this.applySettings()}).setPosition(i.MF.x,.925*i.es.y),g=new p.A(this,()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")});this.getLayerManager().addToLayer(7,e),this.getLayerManager().addToLayer(7,this.sfxVolumeRadioButtons),this.getLayerManager().addToLayer(7,this.bgmVolumeRadioButtons),this.getLayerManager().addToLayer(7,c),this.getLayerManager().addToLayer(7,g)}getSettingsHeader(){return["SFX","BGM"]}createOptionHeader(e,t){let a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Image(this,i.MF.x,0,l.A.settingOption.key),n=(0,w.P)(this,e,eM.Ay.optHeaderTextConfig,eM.Xg);return a.add([s,n]),a}createOptRadioOptions(e,t){return new em.A(this,{choices:eM.Ay.volContainerOpts,defaultChoiceIdx:e,maxXSpace:eM.Ay.opt.xSpace,choiceTextConfig:eM.Ay.radioButtonsTextConfig,bitmapTextStyle:eM.q6},eM.Ay.opt.x,-i.MF.y+t)}async applySettings(){let e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),eR.getInstance().getSoundManager().applyUserSettings(this.getSaveManager().getSettings())}getSaveManager=()=>eR.getInstance().getSaveManager();getLayerManager=()=>(0,o.y)(this.layerManager)}let ew={volume:0,ease:"Power2"},ek=class{soundAssetMap;bgmVol;sfxVol;currBgMusicKey;currBgMusic;constructor(){this.soundAssetMap=new Map,this.bgmVol=1,this.sfxVol=1,this.currBgMusicKey=i.YM.nullInteractionId}applyUserSettings(e){if(this.bgmVol=void 0!==e.bgmVolume?e.bgmVolume:1,this.sfxVol=void 0!==e.sfxVolume?e.sfxVolume:1,this.currBgMusic&&this.currBgMusic.isPlaying){let e=(0,o.y)(this.getSoundAsset(this.currBgMusicKey)),t=void 0!==e.config.volume?e.config.volume:1;this.currBgMusic.setVolume(t*this.bgmVol)}}addSoundAsset(e){this.soundAssetMap.set(e.key,e)}getSoundAsset(e){return this.soundAssetMap.get(e)}loadSounds(e){e.forEach(e=>{this.addSoundAsset(e),this.loadSound(e.key,(0,o.T5)(e.path,!0))})}loadSoundAssetMap(e){Object.values(e).forEach(e=>{this.addSoundAsset(e),this.loadSound(e.key,(0,o.T5)(e.path,!1))})}loadSound(e,t){this.getCurrentScene().load.audio(e,t)}playSound(e){let t=this.getSoundAsset(e);if(t){let e=void 0!==t.config.volume?t.config.volume:1;this.getBaseSoundManager().play(t.key,{...t.config,volume:e*this.sfxVol})}}playBgMusic(e,t){if(!eR.getInstance().isMounted||this.currBgMusicKey===e)return;if(e===i.YM.nullInteractionId&&this.currBgMusic){this.fadeOutAndDestroyMusic(this.currBgMusic,t),this.currBgMusic=void 0,this.currBgMusicKey=e;return}this.currBgMusic&&this.fadeOutAndDestroyMusic(this.currBgMusic);let a=(0,o.y)(this.getSoundAsset(e)),s=void 0!==a.config.volume?a.config.volume:1;try{this.currBgMusic=this.getBaseSoundManager().add(a.key,{...a.config,volume:s*this.bgmVol}),this.currBgMusicKey=a.key,this.currBgMusic.play()}catch(e){console.error(e)}}fadeOutAndDestroyMusic(e,t=1e3){this.getCurrentScene().tweens.add({targets:e,...ew,duration:t}),setTimeout(()=>e.destroy(),2*t)}stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPlaying&&this.currBgMusic.pause()}continueCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPaused&&this.currBgMusic.play()}getBaseSoundManager=()=>this.getCurrentScene().sound;getCurrentScene=()=>(0,o.y)(eR.getInstance().getCurrentSceneRef())};var eI=a(2543),eb=a.n(eI),eS=a(36896),ef=a(21681),eC=a(83919);async function ex(){let e=ef.M.getState().session.courseId,t=await (0,eS.Em)(`courses/${e}/stories`,"GET",{accessToken:eR.getInstance().getAccountInfo().accessToken,refreshToken:eR.getInstance().getAccountInfo().refreshToken});if(!t)return[];let a=200===t.status?await t.json():[],s=eb().sortBy(a,e=>new Date(e.openAt));return s.forEach(e=>e.filenames=e.filenames.map(eC.Jr)),s}let eP=[{title:"Spaceship Emergency",imageUrl:"/locations/planet-y-orbit/crashing.png",filenames:["../../assets/mockChapter0.txt","../../assets/mockChapter0.1.txt"]},{title:"Alien Attack",imageUrl:"/locations/telebay/emergency.png",filenames:["../../assets/mockChapter1.txt"]},{title:"Jedi Master",imageUrl:"/locations/classroom/normal.png",filenames:["../../assets/mockChapter2.txt"]}];var ev=a(31691);class eT{static awardsMapping;static parse(e){eT.awardsMapping=new Map;let t=ev.A.splitToLines(e);return ev.A.splitToParagraph(t).forEach(([,e])=>{eT.parseAwardParagraphs(e)}),this.awardsMapping}static parseAwardParagraphs(e){ev.A.splitToParagraph(e).forEach(([e,t])=>{let[a,s,n,i]=ev.A.splitWithLimit(t[0],",",3);eT.awardsMapping.set(e,{id:e,assetKey:a,assetPath:(0,o.T5)(s,!0),title:n,description:i,completed:!0})})}}class eL{static backgroundMapping;static parse(e){eL.backgroundMapping=new Map;let t=ev.A.splitToLines(e);return ev.A.splitToParagraph(t).forEach(([e,t])=>{eL.backgroundMapping.set(e,(0,o.T5)(t[0],!0))}),eL.backgroundMapping}}class eG extends Phaser.Scene{constructor(){super("Entry")}async preload(){eR.getInstance().setCurrentSceneRef(this),this.preloadAssets(),(0,u.K)(this),await eR.getInstance().loadGameChapters(),await eR.getInstance().loadRoomCode(),await eR.getInstance().getSaveManager().loadLastSaveState()}async create(){await this.preloadAwards(),await eR.getInstance().getUserStateManager().loadUserState(),await this.preloadRoomPreviewBackgrounds(),this.applyLoadedSettings(),this.scene.start("MainMenu")}applyLoadedSettings(){let e=eR.getInstance().getSaveManager().getSettings();eR.getInstance().getSoundManager().applyUserSettings(e)}async preloadAwards(){let e=this.cache.text.get(eC.Ay.awardsMapping.key)||"",t=eT.parse(e);eR.getInstance().setAwardsMapping(t),await Promise.all(Array.from(t.values()).map(async e=>await (0,z.yt)(this,e.assetKey,e.assetPath)))}async preloadRoomPreviewBackgrounds(){let e=this.cache.text.get(eC.Ay.roomPreviewMapping.key)||"",t=eL.parse(e);eR.getInstance().setRoomPreviewMapping(t),await Promise.all(Array.from(t.entries()).map(async([e,t])=>await (0,z.yt)(this,e,t)))}preloadAssets(){eR.getInstance().getSoundManager().loadSoundAssetMap(y.A),Object.values(l.A).forEach(e=>this.load.image(e.key,(0,o.T5)(e.path,!1))),Object.values(A.A).forEach(e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath)),Object.values(eC.Ay).forEach(e=>this.load.text(e.key,e.path))}}var eO=a(48022),eB=a(38863);class eE{collectibles;achievements;assessments;constructor(){this.collectibles=new Set([]),this.achievements=new Set([]),this.assessments=new Set([])}async loadUserState(){eR.getInstance().isGameType("Simulator")||(await this.loadAchievements(),await this.loadAssessments(),this.collectibles=new Set(eR.getInstance().getSaveManager().getLoadedUserState().collectibles))}addCollectible(e){this.collectibles.add(e)}async loadAssessments(){let e=await (0,eh.Dc)(eR.getInstance().getAccountInfo());this.assessments=new Set((e||[]).filter(e=>"submitted"===e.status).sort((e,t)=>e.closeAt<=t.closeAt?-1:1).map(e=>e.number||e.id.toString()))}async isInUserState(e,t){return eR.getInstance().isGameType("Game")?this[e].has(t):0===await (0,eO.N)(eB.A.getInstance().getGameManager(),`${ev.A.capitalize(e)} ${t}?`,["Yes","No"])}async loadAchievements(){let e=eR.getInstance().getAwardsMapping(),t=eR.getInstance().getAchievements(),a=eR.getInstance().getGoals(),s=new Map;a.forEach(e=>s.set(e.uuid,e)),t.forEach(t=>{let a=t.uuid.toString(),n=t.goalUuids.reduce((e,t)=>e&&!!s.get(t)?.completed,!0),i=e.get(a);if(i){let e={...i,completed:n};eR.getInstance().addAwardMapping(e.assetKey,e),this.achievements.add(e.assetKey)}})}getCollectibles=()=>Array.from(this.collectibles);getAchievements=()=>Array.from(this.achievements);getAssessments=()=>Array.from(this.assessments)}var ej=((s={}).Simulator="Simulator",s.Game="Game",s);class eR extends n.Game{static instance;global;isMounted;constructor(e,t){super(e),eR.instance=this,this.isMounted=!0,this.global={awardsMapping:new Map,accountInfo:void 0,achievements:void 0,currentSceneRef:void 0,gameChapters:[],gameType:t,goals:void 0,isUsingMock:!1,roomCode:"",roomPreviewMapping:new Map,saveManager:new h,setGameSimState:i.YM.nullFunction,soundManager:new ek,ssChapterSimFilenames:[],userStateManager:new eE}}static getInstance=()=>(0,o.y)(eR.instance);stopAllSounds(){this.sound.stopAll()}setAccountInfo(e){this.global.accountInfo=e}setAchievements(e){this.global.achievements=e}setAwardsMapping(e){this.global.awardsMapping=e}addAwardMapping(e,t){this.global.awardsMapping.set(e,t)}setGoals(e){this.global.goals=e}setGameSimStateSetter(e){this.setGameSimState=e}setRoomPreviewMapping(e){this.global.roomPreviewMapping=e}async loadGameChapters(){this.global.gameChapters=await ex()}async loadRoomCode(){this.global.roomCode=await ed()}setGameSimState(e){this.global.setGameSimState(e)}setCurrentSceneRef(e){this.global.currentSceneRef=e}toggleUsingMock(e){void 0===e?this.global.isUsingMock=!this.global.isUsingMock:this.global.isUsingMock=e}setChapterSimStack(e){this.global.ssChapterSimFilenames=e.reverse()}getAwardsMapping=()=>(0,o.y)(this.global.awardsMapping);getAccountInfo=()=>(0,o.y)(this.global.accountInfo);getAchievements=()=>(0,o.y)(this.global.achievements);getSoundManager=()=>(0,o.y)(this.global.soundManager);getGoals=()=>(0,o.y)(this.global.goals);getRoomPreviewMapping=()=>(0,o.y)(this.global.roomPreviewMapping);getUserStateManager=()=>(0,o.y)(this.global.userStateManager);getSaveManager=()=>(0,o.y)(this.global.saveManager);getCurrentSceneRef=()=>(0,o.y)(this.global.currentSceneRef);isGameType=e=>this.global.gameType===e;getSSChapterSimFilenames=()=>this.global.ssChapterSimFilenames;getIsUsingMock=()=>this.global.isUsingMock;getRoomCode=()=>this.global.roomCode;getGameChapters=()=>this.global.isUsingMock?eP:this.global.gameChapters}let eN={type:n.CANVAS,width:i.es.x,height:i.es.y,physics:{default:"arcade"},scale:{mode:n.Scale.FIT,parent:"game-display"},fps:{target:24},scene:[eG,q,eA,Q,r.A,$.A,j,ey,F]},eD=()=>new eR(eN,"Game")},55647(e,t,a){a.d(t,{P:()=>n});var s,n=((s={}).Image="Image",s.Sprite="Sprite",s)},1185(e,t,a){a.d(t,{A:()=>s});let s={zektonFont:{key:"zekton",pngPath:"../../assets/zekton.png",fntPath:"../../assets/zekton.fnt"},zektonDarkFont:{key:"zektonDark",pngPath:"../../assets/zekton_dark.png",fntPath:"../../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../../assets/alien_and_cows.png",fntPath:"../../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../../assets/alien_league.png",fntPath:"../../assets/alien_league.fnt"},pixelFont:{key:"pixel",pngPath:"../../assets/pixel.png",fntPath:"../../assets/pixel.fnt"}}},84977(e,t,a){a.d(t,{A:()=>n});var s=a(55647);let n={spaceshipBg:{type:s.P.Image,key:"spaceship-bg",path:"/locations/spaceshipBackground.png"},saBanner:{type:s.P.Image,key:"sa-banner",path:"/ui/sourceAcadBannerOneLine.png"},shortButton:{type:s.P.Image,key:"short-button",path:"/ui/shortButton.png"},mediumButton:{type:s.P.Image,key:"med-button",path:"/ui/mediumButton.png"},longButton:{type:s.P.Image,key:"long-button",path:"/ui/longButton.png"},topButton:{type:s.P.Image,key:"top-button",path:"/ui/topButton.png"},speechBox:{type:s.P.Image,key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{type:s.P.Image,key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{type:s.P.Image,key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{type:s.P.Image,key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{type:s.P.Image,key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{type:s.P.Image,key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{type:s.P.Image,key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{type:s.P.Image,key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{type:s.P.Image,key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{type:s.P.Image,key:"medium-box",path:"/ui/mediumBox.png"},diamond:{type:s.P.Image,key:"diamond",path:"/ui/zircon.png"},arrow:{type:s.P.Image,key:"arrow",path:"/ui/arrow.png"},cookies:{type:s.P.Image,key:"cookies",path:"/images/cookies.png"},scrollFrame:{type:s.P.Image,key:"scroll-frame",path:"/ui/scrollFrame.png"},messageBar:{type:s.P.Image,key:"message-bar",path:"/ui/messageBg.png"},escapeMenuBackground:{type:s.P.Image,key:"escape-bg",path:"/ui/escapeMenu.png"},awardsMenu:{type:s.P.Image,key:"award-bg",path:"/ui/collectiblesBg.png"},awardsBanner:{type:s.P.Image,key:"award-banner",path:"/ui/awardsBanner.png"},awardsPageChosen:{type:s.P.Image,key:"award-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},awardsPage:{type:s.P.Image,key:"award-pg-opt",path:"/ui/collectiblesPageOpt.png"},awardsBackground:{type:s.P.Image,key:"award-hall-bg",path:"/ui/awardsHall.png"},gear:{type:s.P.Image,key:"gear",path:"/ui/settings.png"},journal:{type:s.P.Image,key:"journal",path:"/ui/journal.png"},chapterRepeatButton:{type:s.P.Image,key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{type:s.P.Image,key:"chapter-continue",path:"/ui/chapterContinue.png"},StarGold:{type:s.P.Image,key:"StarGold",path:"/ui/StarGold.png"},StarSilver:{type:s.P.Image,key:"StarSilver",path:"/ui/StarSilver.png"},StarBronze:{type:s.P.Image,key:"StarBronze",path:"/ui/StarBronze.png"},chapterSelectFrame:{type:s.P.Image,key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{type:s.P.Image,key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{type:s.P.Image,key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuOptBanner:{type:s.P.Image,key:"menu-option",path:"/ui/menuOption.png"},settingBanner:{type:s.P.Image,key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{type:s.P.Image,key:"settings-opt",path:"/ui/settingsOption.png"},verifiedFrame:{type:s.P.Image,key:"verified-frame",path:"/ui/verifiedFrame.png"},sourceCrashedPod:{type:s.P.Image,key:"source-crashed-pod",path:"/locations/sourceCrashedPod.png"},squareKeyboardIcon:{type:s.P.Image,key:"keyboard-key-square",path:"/ui/keyboardKeyIcon.png"},medKeyboardIcon:{type:s.P.Image,key:"keyboard-key-medium",path:"/ui/TabIcon.png"}}},89751(e,t,a){a.d(t,{A:()=>s});let s={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.1},soundType:0},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.1},soundType:0},radioButtonClick:{key:"radio-btn-click",path:"/sfx/radioButtonClick.mp3",config:{volume:.15},soundType:0},dialogueAdvance:{key:"dialogue-advance",path:"/sfx/dialogueAdvance.mp3",config:{volume:.3},soundType:0},popUpEnter:{key:"pop-up-enter",path:"/sfx/popUpEnter.mp3",config:{volume:.35},soundType:0},popUpExit:{key:"pop-up-exit",path:"/sfx/popUpExit.mp3",config:{volume:.35},soundType:0},menuEnter:{key:"menu-enter",path:"/sfx/menuEnter.mp3",config:{volume:.5},soundType:0},menuExit:{key:"menu-exit",path:"/sfx/menuExit.mp3",config:{volume:.5},soundType:0},modeEnter:{key:"mode-enter",path:"/sfx/modeEnter.mp3",config:{volume:.1},soundType:0},notifEnter:{key:"notif-enter",path:"/sfx/notifEnter.mp3",config:{volume:.25},soundType:0},notifExit:{key:"notif-exit",path:"/sfx/notifExit.mp3",config:{volume:.25},soundType:0},radioStatic:{key:"radio-static",path:"/sfx/radioStatic.mp3",config:{volume:.1},soundType:0},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.25,loop:!0},soundType:1}}},83919(e,t,a){a.d(t,{Ay:()=>o,Jr:()=>n,NC:()=>r});var s=a(54166);let n=e=>(0,s.T5)(`/stories/${e}`,!0),i={defaultCheckpoint:{key:"default-chap",path:n("defaultCheckpoint.txt")},awardsMapping:{key:"awards-mapping",path:n("awardsMapping.txt")},roomPreviewMapping:{key:"room-prev-mapping",path:n("roomPreviewMapping.txt")}},r={defaultCheckpoint:{key:"mock-default-chap",path:"../../assets/mockDefaultCheckpoint.txt"},awardsMapping:{key:"mock-awards-mapping",path:"../../assets/mockAwardsMapping.txt"},roomPreviewMapping:{key:"mock-room-prev-mapping",path:"../../assets/mockRoomPreviewMapping.txt"}},o=i},36903(e,t,a){a.d(t,{Ay:()=>y,DD:()=>r,EA:()=>c,Ry:()=>l,nt:()=>o,sG:()=>h,uo:()=>g});var s=a(1185),n=a(96912),i=a(72407);let r={key:s.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},o={key:s.A.alienLeagueFont.key,size:50,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},c={key:s.A.zektonFont.key,size:18,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},g={fontFamily:"Verdana",fontSize:"18px",fill:i.Q1.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},h={id:"default-award",assetKey:n.YM.nullInteractionId,assetPath:n.YM.nullInteractionId,title:n.YM.nullInteractionId,description:"There is no asset associated with this award.",completed:!1},l="Asset key can be used to include the asset into your room by using 'create_award' function.",d=-(.3*n.es.x),p=-(.05*n.es.y),u=p+275,y={arrow:{x:.08*n.es.x,y:.34*n.es.y,xOffset:80,xScale:.4,yScale:.3},itemsPerPage:7,list:{yStart:-(.31*n.es.y),ySpace:100},listTextConfig:{x:-(.09*n.es.x),y:0,oriX:0,oriY:.55},noPreviewTextConfig:{x:d,y:-40,oriX:.5,oriY:.5},preview:{descText:{yOffset:320},rect:{dim:430,x:d,y:p,xOffset:30,yOffset:15},key:{x:d,y:u,width:430,height:35},keyTagTextConfig:{x:d-205,y:u,oriX:0,oriY:.5},keyTextConfig:{x:d-90,y:u,oriX:0,oriY:.5},explanation:{x:d-150,y:p+200},titleTextConfig:{x:d+20,y:p-275,oriX:.5,oriY:.5}}}},68440(e,t,a){a.d(t,{Ni:()=>g,cc:()=>c,mR:()=>h});var s=a(94314),n=a(22937),i=a(72407),r=a(7329),o=a(36903);let c=e=>e.map(e=>g(e)),g=e=>n.Ay.getInstance().getAwardsMapping().get(e)||{...o.sG,title:e};function h(e){let t=new Phaser.GameObjects.Container(e,o.Ay.preview.rect.xOffset,o.Ay.preview.rect.yOffset),a=o.Ay.preview.key,n=new Phaser.GameObjects.Rectangle(e,a.x,a.y,a.width,a.height,i.Xj.lightBlue,.1),c=new Phaser.GameObjects.Rectangle(e,a.x-a.width*n.originX*.75,a.y,a.width/4,a.height,i.Xj.lightBlue,.2),g=(0,r.P)(e,"asset key",o.Ay.preview.keyTagTextConfig,o.EA),h=new s.A(e,o.Ay.preview.explanation.x,o.Ay.preview.explanation.y,o.Ry);return c.setInteractive(),c.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>h.setVisible(!0)),c.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>h.setVisible(!1)),t.add([n,c,g,h]),t}},69681(e,t,a){a.d(t,{A:()=>d});var s=a(84977),n=a(96912),i=a(28664),r=a(54166),o=a(4907),c=a(72407),g=a(7329),h=a(36903),l=a(68440);let d=class{scene;awardsGetter;uiContainer;previewContainer;itemsContainer;activePageNumber;constructor(e,t){this.scene=e,this.awardsGetter=t,this.activePageNumber=0}createUIContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0);this.uiContainer=e;let t=(0,i.T)(this.scene,{assetKey:s.A.arrow.key,onUp:()=>this.nextPage(!1)}).setScale(h.Ay.arrow.yScale,h.Ay.arrow.yScale).setRotation(-90*Math.PI/180).setPosition(h.Ay.arrow.x-h.Ay.arrow.xOffset,h.Ay.arrow.y),a=(0,i.T)(this.scene,{assetKey:s.A.arrow.key,onUp:()=>this.nextPage(!0)}).setScale(h.Ay.arrow.xScale,h.Ay.arrow.yScale).setRotation(90*Math.PI/180).setPosition(h.Ay.arrow.x+h.Ay.arrow.xOffset,h.Ay.arrow.y);e.add([t,a]);let n=new Phaser.GameObjects.Sprite(this.scene,h.Ay.preview.rect.x,h.Ay.preview.rect.y,s.A.popUpFrame.key).setScale(1.2);return e.add(n),e.add((0,l.mR)(this.scene)),this.setPage(),e}setPage(){this.uiContainer&&(this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer),this.setPreview())}setPreview(e){if(this.uiContainer){let t;if(this.previewContainer&&this.previewContainer.destroy(),!e)return;if(this.previewContainer=new Phaser.GameObjects.Container(this.scene,h.Ay.preview.rect.xOffset,h.Ay.preview.rect.yOffset),e.assetKey===n.YM.nullInteractionId)t=(0,g.P)(this.scene,"No preview available",h.Ay.noPreviewTextConfig,h.EA);else{let a=h.Ay.preview.rect;t=new Phaser.GameObjects.Sprite(this.scene,0,0,e.assetKey),(0,o.Dz)(t,a.dim,a.dim),t.setPosition(a.x,a.y)}let a=(0,g.P)(this.scene,e.title,h.Ay.preview.titleTextConfig,h.nt),s=new Phaser.GameObjects.Text(this.scene,h.Ay.preview.rect.x,h.Ay.preview.rect.y+h.Ay.preview.descText.yOffset,e.description,h.uo).setOrigin(.5,0),i=!1===e.completed?"":e.assetKey,r=(0,g.P)(this.scene,i,h.Ay.preview.keyTextConfig,h.EA),c=new Phaser.GameObjects.Rectangle(this.scene,h.Ay.preview.rect.x,h.Ay.preview.rect.y,h.Ay.preview.rect.dim,h.Ay.preview.rect.dim,0).setAlpha(.8*!e.completed);this.previewContainer.add([t,c,a,s,r]),this.uiContainer.add(this.previewContainer)}}nextPage(e){let t=this.activePageNumber,a=(0,r.NS)(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(a).length>0&&(this.activePageNumber=a,this.setPage())}createItemsContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0),t=this.getItems(this.activePageNumber),a=(0,c.XA)({numOfItems:t.length,xSpacing:0,ySpacing:h.Ay.list.ySpace});return e.add(t.map((e,t)=>this.createItemButton(e.title,a[t][0],a[t][1]+h.Ay.list.yStart,()=>this.setPreview(e),!1!==e.completed))),e}createItemButton(e,t,a,n,r){let o=(0,i.T)(this.scene,{assetKey:s.A.awardsBanner.key,message:e,textConfig:h.Ay.listTextConfig,bitMapTextStyle:h.DD,onUp:n,onHoverEffect:r}).setPosition(t,a);return r||o.setAlpha(.5),o}getItems(e){let t=this.awardsGetter(),a=(0,l.cc)(t),s=e*h.Ay.itemsPerPage;return a.slice(s,s+h.Ay.itemsPerPage)}}},45798(e,t,a){a.d(t,{A:()=>h});var s=a(1185),n=a(84977),i=a(28664),r=a(96912);let o=-(.975*r.MF.y),c={key:s.A.zektonDarkFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class g extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0),this.renderBackButton(t)}renderBackButton(e){let t=(0,i.T)(this.scene,{assetKey:n.A.topButton.key,message:"Back",textConfig:{x:0,y:o,oriX:.5,oriY:.25},bitMapTextStyle:c,onUp:e}).setPosition(r.MF.x,r.MF.y);this.add(t)}}let h=g},96912(e,t,a){a.d(t,{MF:()=>o,YM:()=>i,es:()=>r});var s=a(91948),n=a(1185);let i={assetsFolder:"https://source-academy-assets.s3-ap-southeast-1.amazonaws.com/",useEmptyAssetPrefix:s.A.useEmptyAssetPrefix,fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popUpDuration:1e3,defaultAssetPath:"/ui/wristDeviceButton.png",defaultFontStyle:{key:n.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},defaultCursor:""},r={x:1920,y:1080},o={x:r.x/2,y:r.y/2}},39062(e,t,a){a.d(t,{A:()=>g});var s=a(89751),n=a(22937),i=a(72407),r=a(7329),o=a(96912);class c extends Phaser.GameObjects.Container{buttonClickSoundKey;activeChoice;activeChoiceIdx;choices;buttonPositions;radioChoiceConfig;choiceTextConfig;bitmapTextStyle;constructor(e,{choices:t,defaultChoiceIdx:a=0,maxXSpace:n=o.es.x,radioChoiceConfig:r={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:c={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:g=o.YM.defaultFontStyle},h,l,d=s.A.radioButtonClick.key){super(e,h,l),this.activeChoiceIdx=a,this.choices=t,this.choiceTextConfig=c,this.bitmapTextStyle=g,this.radioChoiceConfig=r,this.buttonClickSoundKey=d;const p=this.getRadioButtons(t);this.buttonPositions=(0,i.lj)({numOfItems:p.length,maxXSpace:n}),this.renderRadioButtons(p,this.buttonPositions,this.radioChoiceConfig),this.activate(a)}getRadioButtons(e){return e.map((e,t)=>({text:e,callback:()=>this.activate(t)}))}renderRadioButtons(e,t,a){this.add(e.map((e,s)=>this.createRadioButton(t[s][0],t[s][1],e.callback,a)))}createRadioButton(e,t,a,s){return new Phaser.GameObjects.Ellipse(this.scene,e,t,s.circleDim,s.circleDim,i.Xj.lightBlue).setStrokeStyle(s.outlineThickness,i.Xj.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{n.Ay.getInstance().getSoundManager().playSound(this.buttonClickSoundKey),a()})}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);let t=(0,r.P)(this.scene,this.choices[e],this.choiceTextConfig,this.bitmapTextStyle),a=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,i.Xj.darkBlue);this.activeChoice.add([t,a]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:o.YM.nullInteractionId}}let g=c},94314(e,t,a){a.d(t,{A:()=>r});var s=a(72407);let n={fontFamily:"Verdana",fontSize:"15px",fill:s.Q1.lightBlue,align:"left",wordWrap:{width:290}};class i extends Phaser.GameObjects.Container{constructor(e,t,a,s,n=300){super(e,t,a),this.renderTextHover(s,n)}renderTextHover(e,t){let a=parseInt(n.fontSize.substring(0,n.fontSize.length-2)),i=Math.min(e.length*a*.75,t),r=new Phaser.GameObjects.Text(this.scene,30,10,e,{...n,wordWrap:{width:i-10}}),o=new Phaser.GameObjects.Rectangle(this.scene,20,0,i,r.getBounds().bottom+10,s.Xj.darkBlue).setOrigin(0,0).setAlpha(.8);this.add([o,r]),this.setDepth(1),this.setVisible(!1)}}let r=i},765(e,t,a){a.d(t,{A:()=>r,E:()=>i});var s=a(1185),n=a(96912);let i={key:s.A.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},r={backButton:{y:.3*n.es.y},page:{yStart:-(.3*n.es.y),ySpace:150},pageTextConfig:{x:.3*n.es.x,y:0,oriX:.1,oriY:.5},pageArea:{x:-869,y:-412,width:.72*n.es.x,height:.77*n.es.y}}},50891(e,t,a){a.d(t,{A:()=>u});var s=a(84977),n=a(89751),i=a(96912),r=a(3563),o=a(86914),c=a(22937),g=a(28664),h=a(54166),l=a(72407),d=a(765),p=a(11897);let u=class{scene;pages;pageManagers;pageMask;uiContainer;pageChosenContainer;pageUIContainers;currPageIndex;constructor(e,t,a){this.scene=e,this.pages=t,this.pageManagers=a,this.pageMask=this.createPageMask(),this.pageUIContainers=Array(t.length),this.currPageIndex=0,this.scene.getPhaseManager().addPhaseToMap("Dashboard",this)}createPageMask(){let e=new Phaser.GameObjects.Graphics(this.scene),{x:t,y:a,width:s,height:n}=d.A.pageArea;return e.fillRect(t,a,s,n),e.createGeometryMask()}setPage(e){if(this.uiContainer){this.pageChosenContainer&&this.pageChosenContainer.destroy();let t=this.pageUIContainers[this.currPageIndex];t&&t.setVisible(!1),this.currPageIndex=e;let a=this.pageUIContainers[this.currPageIndex];a?a.setVisible(!0):((a=this.pageManagers[this.currPageIndex].createUIContainer()).setMask(this.pageMask),this.pageUIContainers[this.currPageIndex]=a,this.uiContainer.add(a));let n=this.getPageOptPositions(),i=this.currPageIndex,r=new Phaser.GameObjects.Sprite(this.scene,n[i][0],n[i][1]+d.A.page.yStart,s.A.awardsPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.scene,0,0,[r]),this.uiContainer.add(this.pageChosenContainer)}}createUIContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Rectangle(this.scene,0,0,i.es.x,4*i.es.y,0).setAlpha(.7).setInteractive(),a=new Phaser.GameObjects.Image(this.scene,0,0,s.A.awardsMenu.key);e.add([t,a]);let n=this.pages.map((e,t)=>({text:e,callback:()=>this.setPage(t)})),r=this.getPageOptPositions();e.add(n.map((e,t)=>this.createPageOpt(e.text,r[t][0],r[t][1]+d.A.page.yStart,e.callback)));let o=this.createPageOpt("Back",0,d.A.backButton.y,async()=>{this.scene.getPhaseManager().isCurrentPhase("Dashboard")&&await this.scene.getPhaseManager().popPhase()});return e.add(o),e}getPageOptPositions(){return(0,l.XA)({numOfItems:Object.keys(p.G).length,xSpacing:0,ySpacing:d.A.page.ySpace})}createPageOpt(e,t,a,n){return(0,g.T)(this.scene,{assetKey:s.A.awardsPage.key,message:e,textConfig:d.A.pageTextConfig,bitMapTextStyle:d.E,onUp:n}).setPosition(t,a)}async activateUI(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(12,this.uiContainer),this.getSoundManager().playSound(n.A.menuEnter.key),this.setPage(this.currPageIndex),this.uiContainer.setPosition(i.MF.x,-i.es.y),this.pageMask.geometryMask.setPosition(i.MF.x,-i.es.y),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...o._K,y:i.MF.y})}async deactivateUI(){this.uiContainer&&(this.pageUIContainers=Array(this.pages.length),this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getSoundManager().playSound(n.A.menuExit.key),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...o.oS}),await (0,h.yy)(o.oS.duration),(0,r.E_)(this.scene,this.uiContainer,{fadeDuration:50}))}getSoundManager=()=>c.Ay.getInstance().getSoundManager()}},11897(e,t,a){a.d(t,{G:()=>n});var s,n=((s={}).Log="Log",s.Tasks="Tasks",s.Collectibles="Collectibles",s.Achievements="Achievements",s)},26947(e,t,a){a.d(t,{Ay:()=>g,a5:()=>o,ir:()=>c});var s=a(1185),n=a(96912),i=a(72407);let r={prompt:{x:30,y:60,xPad:30,yPad:10},rect:{x:10,y:760,width:n.es.x-20},text:{xPad:100,yPad:70},speakerTextConfig:{x:320,y:745,oriX:.5,oriY:.5}},o={fontFamily:"Verdana",fontSize:"30px",fill:i.Q1.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:r.rect.width-2*r.text.xPad-2*r.rect.x}},c={key:s.A.zektonFont.key,size:36,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},g=r},53407(e,t,a){a.d(t,{v:()=>c,O:()=>o});var s=a(84977),n=a(96912);let i=function(e,{x:t=0,y:a=0,textStyle:s={},typeWriterInterval:n=1}){let i,r=new Phaser.GameObjects.Text(e,t,a,"",s),o="",c=0,g=()=>{i&&clearInterval(i)};return{container:r,changeLine:e=>{e&&(o=e,r.text="",c=0,g(),i=setInterval(()=>{r.text+=o[c++],c===o.length&&clearInterval(i)},n))},clearTyping:g}};var r=a(26947);function o(e){return new Phaser.GameObjects.Image(e,n.MF.x,n.MF.y,s.A.speechBox.key).setAlpha(.9)}function c(e,t){return i(e,{x:r.Ay.rect.x+r.Ay.text.xPad,y:r.Ay.rect.y+r.Ay.text.yPad,textStyle:t})}},68431(e,t,a){a.d(t,{A:()=>g});var s=a(84977),n=a(96912),i=a(3563),r=a(38863),o=a(26947),c=a(53407);let g=class{typewriter;dialogueBox;blinkingDiamond;constructor(e){const t=r.A.getInstance().getGameManager();this.dialogueBox=(0,c.O)(t).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=(0,c.v)(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){let e=r.A.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){let t=new Phaser.GameObjects.Image(e,n.es.x-o.Ay.prompt.x-o.Ay.prompt.xPad,n.es.y-o.Ay.prompt.y-o.Ay.prompt.yPad,s.A.diamond.key).setDisplaySize(o.Ay.prompt.x,o.Ay.prompt.y);return{container:t,clearBlink:(0,i.Zm)(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){let e=r.A.getInstance().getGameManager();this.typewriter.clearTyping(),this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),(0,i.E_)(e,this.getDialogueContainer())}async hide(){this.typewriter.container.setVisible(!1),this.dialogueBox.setVisible(!1),this.blinkingDiamond.container.setVisible(!1)}async show(){this.typewriter.container.setVisible(!0),this.dialogueBox.setVisible(!0),this.blinkingDiamond.container.setVisible(!0)}changeText(e){this.typewriter.changeLine(e)}}},3563(e,t,a){a.d(t,{E_:()=>o,Xn:()=>i,Zm:()=>h,co:()=>g,gN:()=>c,qG:()=>r});var s=a(96912),n=a(54166);a(72407);let i=(e,t=s.YM.fadeDuration)=>({alpha:0,targets:e,duration:t,ease:"Power2"}),r=(e,t=s.YM.fadeDuration)=>({alpha:1,targets:e,duration:t,ease:"Power2"});function o(e,t,{fadeDuration:a}={}){t&&(e.add.tween(i([t],a||s.YM.fadeDuration)),setTimeout(()=>t.destroy(),a||s.YM.fadeDuration))}function c(e){return new Phaser.GameObjects.Rectangle(e,s.MF.x,s.MF.y,s.es.x,s.es.y,0)}let g=async(e,t,a,s)=>{let o=c(e);e.getLayerManager().addToLayer(0,o),o.setAlpha(0),e.tweens.add(r([o],t)),await (0,n.yy)(t),await s(),await (0,n.yy)(a),o.setAlpha(1),e.tweens.add(i([o],t)),await (0,n.yy)(t),o.destroy()};function h(e,t){let a=0,s=setInterval(()=>{a%2!=0?(t.setAlpha(0),e.tweens.add(r([t],250))):(t.setAlpha(1),e.tweens.add(i([t],250))),a++},500);return function(){a=0,clearInterval(s)}}},86914(e,t,a){a.d(t,{Bs:()=>r,_K:()=>n,oS:()=>i,rX:()=>o});var s=a(96912);let n={y:0,duration:300,ease:"Power2"},i={y:-s.es.y,duration:250,ease:"Power2"};s.es.x;let r={x:0,duration:500,ease:"Power2"},o={x:s.es.x,duration:500,ease:"Power2"}},21638(e,t,a){a.d(t,{K:()=>g});var s=a(96912),n=a(3563);let i=s.MF.x-160,r=s.MF.y,o=i+10,c=r+10;function g(e){let t,a,s;e.load.on("start",()=>{s=e.add.existing((0,n.gN)(e)),t=e.add.graphics(),(a=e.add.graphics()).fillStyle(2236962,.8),a.fillRect(i,r,320,50)}),e.load.on("progress",e=>{t.clear(),t.fillStyle(0xffffff,1),t.fillRect(o,c,300*e,30)}),e.load.on("complete",function(){t.destroy(),a.destroy(),s.destroy()})}},48022(e,t,a){a.d(t,{N:()=>M});var s=a(1185),n=a(84977),i=a(89751),r=a(96912),o=a(38863),c=a(22937),g=a(28664),h=a(54166),l=a(72407),d=a(3563),p=a(86914);let u={x:15,y:-15,oriX:.5,oriY:.5},y={fontFamily:"Verdana",fontSize:"20px",fill:l.Q1.offWhite,align:"right",lineSpacing:10,wordWrap:{width:410}},m={key:s.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};async function M(e,t,a){let s=new Phaser.GameObjects.Container(e,0,0),M=Math.ceil(a.length/5),A=a.length>5?5:a.length,w=new Phaser.GameObjects.Text(e,r.es.x-20,100,t,y).setOrigin(1,0),k=new Phaser.GameObjects.Rectangle(e,r.es.x,80,450*M,.5*w.getBounds().bottom+20,l.Xj.darkBlue,.8).setOrigin(1,0),I=new Phaser.GameObjects.Rectangle(e,r.es.x,80,450*M,.5*k.getBounds().bottom+(A+.5)*100,l.Xj.lightBlue,.2).setOrigin(1,0);s.add([I,k,w]);let b=(0,l.XA)({numOfItems:a.length,xSpacing:0,ySpacing:100});o.A.getInstance().addToLayer(7,s);let S=new Promise(t=>{s.add(a.map((a,i)=>(0,g.T)(e,{assetKey:n.A.mediumButton.key,message:a,textConfig:u,bitMapTextStyle:m,onUp:()=>{s.destroy(),t(i)}}).setPosition(r.es.x-225-450*(M-Math.floor(i/5)-1),b[i][1]%500+k.getBounds().bottom+75)))});s.setPosition(r.es.x,0),c.Ay.getInstance().getSoundManager().playSound(i.A.notifEnter.key),e.add.tween({targets:s,alpha:1,...p.Bs}),await (0,h.yy)(p.Bs.duration);let f=await S;return c.Ay.getInstance().getSoundManager().playSound(i.A.notifExit.key),e.add.tween({targets:s,alpha:1,...p.rX}),await (0,h.yy)(p.rX.duration),(0,d.E_)(e,s,{fadeDuration:r.YM.fadeDuration}),f}},73631(e,t,a){a.d(t,{A:()=>M});var s=a(84977),n=a(89751),i=a(96912),r=a(39062),o=a(94321),c=a(22937),g=a(28664),h=a(72407),l=a(7329),d=a(1185);let p={key:d.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},u={key:d.A.zektonFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},y={key:d.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},m={button:{y:.15*i.es.y},escapeOptTextConfig:{x:0,y:0,oriX:.37,oriY:.75},settings:{yOffset:-(.1*i.MF.y),ySpace:.3*i.es.y},settingsTextConfig:{x:.38*i.es.x,y:-(.1*i.MF.y),oriX:0,oriY:.5},radioButtons:{xSpace:.2*i.es.x},radioChoiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},volOpt:{x:.05*i.es.x}},M=class{bgmVolumeRadioButtons;sfxVolumeRadioButtons;scene;constructor(e){this.scene=e,this.scene.getPhaseManager().addPhaseToMap("EscapeMenu",this)}createUIContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Image(this.scene,i.MF.x,i.MF.y,s.A.escapeMenuBackground.key).setDisplaySize(i.es.x,i.es.y).setInteractive({pixelPerfect:!0});e.add(t);let a=this.getSettings(),n=(0,h.lj)({direction:"Column",numOfItems:a.length,maxYSpace:m.settings.ySpace});e.add(a.map((e,t)=>(0,l.P)(this.scene,e,{...m.settingsTextConfig,y:n[t][1]+m.settingsTextConfig.y},y)));let{bgmVolume:r,sfxVolume:c}=this.getSettingsSaveManager().getSettings(),g=o.Ay.volContainerOpts.findIndex(e=>parseFloat(e)===c),d=o.Ay.volContainerOpts.findIndex(e=>parseFloat(e)===r);this.sfxVolumeRadioButtons=this.createSettingsRadioOptions(g,n[0][1]),this.bgmVolumeRadioButtons=this.createSettingsRadioOptions(d,n[1][1]),e.add([this.sfxVolumeRadioButtons,this.bgmVolumeRadioButtons]);let p=this.getOptButtons(),u=(0,h.lj)({numOfItems:p.length});return e.add(p.map((e,t)=>this.createEscapeOptButton(e.text,u[t][0],u[t][1]+m.button.y,e.callback))),e}getSettings(){return["SFX","BGM"]}createSettingsRadioOptions(e,t){return new r.A(this.scene,{choices:o.Ay.volContainerOpts,defaultChoiceIdx:e,maxXSpace:m.radioButtons.xSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:m.radioChoiceTextConfig,bitmapTextStyle:u},m.volOpt.x,-i.MF.y+t+m.settings.yOffset)}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),c.Ay.getInstance().isGameType("Simulator")?this.scene.scene.start("GameSimulatorMenu"):this.scene.scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.scene.getPhaseManager().isCurrentPhase("EscapeMenu")&&await this.scene.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}createEscapeOptButton(e,t,a,n){return(0,g.T)(this.scene,{assetKey:s.A.mediumButton.key,message:e,textConfig:m.escapeOptTextConfig,bitMapTextStyle:p,onUp:n}).setPosition(t,a)}async applySettings(){let e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t={bgmVolume:this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1,sfxVolume:e};await this.getSettingsSaveManager().saveSettings(t),c.Ay.getInstance().getSoundManager().applyUserSettings(t)}cleanUp(){this.scene.getInputManager().clearListeners(),this.scene.getLayerManager().clearAllLayers()}activateUI(){let e=this.createUIContainer();this.getSoundManager().playSound(n.A.menuEnter.key),this.scene.getLayerManager().addToLayer(10,e)}deactivateUI(){this.getSoundManager().playSound(n.A.menuExit.key),this.scene.getLayerManager().clearSeveralLayers([10])}getSoundManager=()=>c.Ay.getInstance().getSoundManager();getSettingsSaveManager=()=>c.Ay.getInstance().getSaveManager()}},13001(e,t,a){a.d(t,{L:()=>s});let s={Dashboard:Phaser.Input.Keyboard.KeyCodes.TAB,Menu:Phaser.Input.Keyboard.KeyCodes.ESC,Next:Phaser.Input.Keyboard.KeyCodes.SPACE,Notif:Phaser.Input.Keyboard.KeyCodes.SPACE,Explore:Phaser.Input.Keyboard.KeyCodes.E,Move:Phaser.Input.Keyboard.KeyCodes.V,Talk:Phaser.Input.Keyboard.KeyCodes.T,Options:[Phaser.Input.Keyboard.KeyCodes.ONE,Phaser.Input.Keyboard.KeyCodes.TWO,Phaser.Input.Keyboard.KeyCodes.THREE,Phaser.Input.Keyboard.KeyCodes.FOUR]}},35071(e,t,a){a.d(t,{A:()=>s});let s=class{scene;keyboardListeners;eventListeners;constructor(e){this.keyboardListeners=[],this.eventListeners=[],this.scene=e}setDefaultCursor(e){this.scene.input.setDefaultCursor(e)}enableMouseInput(e){this.scene.input.mouse&&(this.scene.input.mouse.enabled=e)}enableKeyboardInput(e){this.scene.input.keyboard&&(this.scene.input.keyboard.enabled=e)}registerKeyboardListener(e,t,a){if(!this.scene.input.keyboard)return;let s=this.scene.input.keyboard.addKey(e).addListener(t,a);this.keyboardListeners.push(s)}registerEventListener(e,t){let a=this.scene.input.addListener(e,t);this.eventListeners.concat(a)}clearListeners(){this.keyboardListeners.forEach(e=>e.removeAllListeners()),this.eventListeners.forEach(e=>e.removeAllListeners())}clearKeyboardListeners(e){this.keyboardListeners.forEach(t=>{e.includes(t.keyCode)&&t.removeAllListeners()})}}},96550(e,t,a){a.d(t,{A:()=>c});var s=a(38863),n=a(96912),i=a(3563),r=a(54166);let o=[1,11,8,9,2,3,15,4,5,6,14,0,12,10,7,13],c=class{layers;constructor(e){this.layers=new Map(o.map(t=>[t,new Phaser.GameObjects.Container(e,0,0)])),this.layers.forEach(t=>e.add.existing(t))}getLayer(e){return this.layers.get(e)}hideLayer(e){let t=this.layers.get(e);t?.setVisible(!1),t?.setAlpha(0)}showLayer(e){let t=this.layers.get(e);t?.setVisible(!0),t?.setAlpha(1)}async fadeInLayer(e,t=n.YM.fadeDuration){let a=s.A.getInstance().getGameManager(),o=this.layers.get(e);o.setVisible(!0),o.setAlpha(0),a.tweens.add((0,i.qG)([o],t)),await (0,r.yy)(t)}async fadeOutLayer(e,t=n.YM.fadeDuration){let a=s.A.getInstance().getGameManager(),o=this.layers.get(e);o.setVisible(!0),o.setAlpha(1),a.tweens.add((0,i.Xn)([o],t)),await (0,r.yy)(t)}addToLayer(e,t){let a=this.layers.get(e);a&&a.add(t)}clearSeveralLayers(e){e.forEach(e=>this.clearLayerContents(e))}clearAllLayers(){this.layers.forEach((e,t)=>this.clearLayerContents(t))}clearLayerContents(e){let t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}}},92633(e,t,a){a.d(t,{g:()=>s});let s={Move:"Move",Explore:"Explore",Talk:"Talk",Menu:"Menu"}},52241(e,t,a){a.d(t,{A:()=>s});let s=class{activateUI(){}deactivateUI(){}}},99370(e,t,a){a.d(t,{A:()=>U});var s=a(54166);let n=class{soundAssets;mapAssets;locations;dialogues;objects;boundingBoxes;characters;actions;gameStartActions;checkpointCompleteActions;quizzes;constructor(){this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.dialogues=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.quizzes=new Map,this.gameStartActions=[],this.checkpointCompleteActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setGameStartActions(e){this.gameStartActions=e}setCheckpointCompleteActions(e){this.checkpointCompleteActions=e}getGameStartActions(){return this.gameStartActions}getCheckpointCompleteActions(){return this.checkpointCompleteActions}getLocations(){return this.locations}getObjectPropMap(){return this.objects}getBBoxPropMap(){return this.boundingBoxes}getDialogueMap(){return this.dialogues}getCharacterMap(){return this.characters}getActionMap(){return this.actions}getQuizMap(){return this.quizzes}getSoundAssets(){return this.soundAssets}setItemInMap(e,t,a){this[e].set(t,a)}addItemToLocation(e,t,a){this.getLocationAtId(e)[t].add(a)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}getLocationAtId=e=>(0,s.y)(this.locations.get(e),`Location ${e} was not found!`);getAssetByKey=e=>(0,s.y)(this.mapAssets.get(e),`Asset ${e} not found!`);getLocationIds(){return Array.from(this.locations.keys())}getAssetKeyFromId(e){return(0,s.y)(this.objects.get(e)?.assetKey||this.locations.get(e)?.assetKey,`Id ${e} not found!`)}},i=class{objective;totalNumOfObjectives;numOfCompletedObjectives;constructor(){this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){let a=this.objective.get(e);this.objective.set(e,t),void 0!==a&&a!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach(e=>this.addObjective(e))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){let t=this.objective.get(e);if(void 0===t)throw Error(`Cannot find objective with the given task id "${e}"`);return t}getObjectives(){return this.objective}setObjectives(e){this.objective=e}},r=class{tasks;taskDetails;constructor(){this.tasks=new Map,this.taskDetails=new Map}setTask(e,t){this.tasks.set(e,t)}showTask(e){let t=this.taskDetails.get(e);if(void 0!==t){let a={...t,visible:!0};this.taskDetails.set(e,a)}}addTask(e){let t=e.taskId;this.tasks.set(t,!1),this.taskDetails.set(t,e)}addTasks(e){e.forEach(e=>this.addTask(e))}getTaskState(e){let t=this.tasks.get(e);if(void 0===t)throw Error(`Cannot find task with the given task id "${e}"`);return t}getTaskDetail(e){let t=this.taskDetails.get(e);if(void 0===t)throw Error(`Cannot find task with the given task id "${e}"`);return t}getAllTasks(){return this.tasks}getAllIncompleteTasks(){let e=[];for(let t of this.tasks.keys())!this.tasks.get(t)&&this.taskDetails.get(t)?.visible&&e.push(t);return e}getAllVisibleTaskData(){let e=[];for(let t of this.tasks.keys()){let a=this.getTaskState(t),s=this.getTaskDetail(t);void 0!==a&&void 0!==s&&s.visible&&e.push([s,a])}return e}};var o=a(31691);a(92633);let c={small:"Small",medium:"Medium",large:"Large"},g={left:"Left",middle:"Middle",right:"Right"},h={talk:"Talk",explore:"Explore",move:"Move",menu:"Menu"},l={navigation:"navigation",talkTopics:"talkTopics",objects:"objects",boundingBoxes:"boundingBoxes",characters:"characters",actions:"actions",bgmKey:"bgmKey",collectibles:"collectibles"},d={move_character:"MoveCharacter",update_character:"UpdateCharacter",obtain_collectible:"ObtainCollectible",complete_objective:"CompleteObjective",complete_task:"CompleteTask",show_task:"ShowTask",add_item:"AddItem",remove_item:"RemoveItem",change_background:"ChangeBackground",start_animation:"StartAnimation",stop_animation:"StopAnimation",show_dialogue:"ShowDialogue",add_mode:"AddLocationMode",remove_mode:"RemoveLocationMode",add_popup:"AddPopup",make_object_glow:"MakeObjectGlow",make_object_blink:"MakeObjectBlink",play_bgm:"PlayBGM",play_sfx:"PlaySFX",preview_location:"PreviewLocation",show_object_layer:"ShowObjectLayer",navigate_to_assessment:"NavigateToAssessment",update_assessment_status:"UpdateAssessmentStatus",delay:"Delay",show_quiz:"ShowQuiz"},p={checklist:"ChecklistState",tasklist:"TasklistState",userstate:"UserState",attemptedQuiz:"AttemptedQuizState",passedQuiz:"PassedQuizState",quizScore:"QuizScoreState"},u={assessments:"assessments",achievements:"achievements",collectibles:"collectibles"};class y{static stringToSize(e){return c[e]||"Medium"}static stringToPosition(e){return g[e]||"Middle"}static stringToGameMode(e){return(0,s.y)(h[e],`Invalid location mode, ${e}`)}static stringToActionType(e){return(0,s.y)(d[e],`Invalid action type, ${e}`)}static stringToGameStateStorage(e){return(0,s.y)(p[e],`Invalid condition type, ${e}`)}static stringToGameItemType(e){return(0,s.y)(l[e],`Invalid entity type, ${e}`)}static stringToBoolean(e){return"false"!==e}static stringToUserStateType(e){return(0,s.y)(u[e],`Invalid user state type ${e}`)}}var m=a(89751);class M{gameItemAsserts;gameEntityAsserts;gameAnimAsserts;gameAnimMaps=[U.checkpoint.map.getLocations(),U.checkpoint.map.objects];allItemIds;constructor(){this.gameItemAsserts=new Map,this.gameEntityAsserts=new Map,this.gameAnimAsserts=[],this.allItemIds=new Set}registerId(e){if(this.allItemIds.has(e))throw Error(`Duplicate item id ${e}`);this.allItemIds.add(e)}verifyAssertions(){this.verifyGameItemAssert(),this.verifyGameEntityAsserts(),this.verifyGameAnimAsserts()}assertItemType(e,t,a){"talkTopics"===e?e="dialogues":"navigation"===e&&(e="locations"),this.gameItemAsserts.get(e)||this.gameItemAsserts.set(e,[]),this.gameItemAsserts.get(e).push({itemId:t,actionType:a})}verifyGameItemAssert(){this.gameItemAsserts.forEach((e,t)=>{e.forEach(e=>{let{itemId:a,actionType:s}=e;if(!U.checkpoint.map[t].has(a))throw s&&this.actionAssertionError(a,t,s),Error(`Cannot find id "${a}" under ${t} entity type`)})})}assertItemTypes(e,t,a){t.forEach(t=>this.assertItemType(e,t,a))}assertEntityType(e,t,a){this.gameEntityAsserts.get(e)||this.gameEntityAsserts.set(e,[]),this.gameEntityAsserts.get(e).push({itemId:t,actionType:a})}verifyGameEntityAsserts(){this.gameEntityAsserts.forEach((e,t)=>{e.forEach(e=>{let{itemId:a,actionType:s}=e;switch(t){case"locations":U.checkpoint.map.getLocationAtId(a);break;case"objectives":if(void 0===U.checkpoint.objectives.getObjectives().get(a))throw s&&this.actionAssertionError(a,t,s),Error(`Cannot find objective id "${a}"`);break;case"tasks":if(void 0===U.checkpoint.tasks.getAllTasks().get(a))throw s&&this.actionAssertionError(a,t,s),Error(`Cannot find task id "${a}"`);break;case"bgms":{let e=U.checkpoint.map.getSoundAssets().reduce((e,t)=>e+ +(1===t.soundType&&t.key===a),0);if(0===e){if(!Object.values(m.A).some(e=>1===e.soundType&&e.key===a))throw Error(`Cannot find bgm key "${a}"`)}else if(e>1)throw Error(`More than 1 bgm key "${a}"`);break}case"sfxs":{let e=U.checkpoint.map.getSoundAssets().reduce((e,t)=>e+ +(0===t.soundType&&t.key===a),0);if(0===e){if(!Object.values(m.A).some(e=>0===e.soundType&&e.key===a))throw Error(`Cannot find sfx key "${a}"`)}else if(e>1)throw Error(`More than 1 sfx key "${a}"`)}}})})}assertAnimType(e,t){this.gameAnimAsserts.push({itemId:e,actionType:t})}verifyGameAnimAsserts(){this.gameAnimAsserts.forEach(e=>{let{itemId:t,actionType:a}=e,s=!1;this.gameAnimMaps.forEach(e=>{e.get(t)&&(s=!0)}),s||this.actionAssertionError(t,"locationId or itemId",a)})}actionAssertionError(e,t,a){throw Error(`Expected type of "${t}" as argument for "${a}", obtained "${e}" which is either undefined or the wrong id.`)}}class A{static parse(e){let t="!"===e[0];t&&(e=e.slice(1));let[a,...s]=o.A.splitByChar(e,".");switch(y.stringToGameStateStorage(a)){case"ChecklistState":return U.validator.assertEntityType("objectives",s[0]),{state:"ChecklistState",conditionParams:{id:s[0]},boolean:!t};case"TasklistState":return U.validator.assertEntityType("tasks",s[0]),{state:"TasklistState",conditionParams:{id:s[0]},boolean:!t};case"UserState":return{state:"UserState",conditionParams:{userStateType:y.stringToUserStateType(s[0]),id:s[1]},boolean:!t};case"AttemptedQuizState":return U.validator.assertItemType("quizzes",s[0]),{state:"AttemptedQuizState",conditionParams:{id:s[0]},boolean:!t};case"PassedQuizState":return U.validator.assertItemType("quizzes",s[0]),{state:"PassedQuizState",conditionParams:{id:s[0]},boolean:!t};case"QuizScoreState":if(U.validator.assertItemType("quizzes",s[0]),Number.isNaN(parseInt(s[1])))throw Error("Parsing error: quiz score condition requires number as second param");return{state:"QuizScoreState",conditionParams:{id:s[0],score:s[1]},boolean:!t};default:throw Error("Parsing error: Invalid condition param")}}}class w{static parseActions(e){return e.map(e=>this.parseAction(e))}static parseAction(e){let[t,a]=o.A.splitByChar(e,"if"),s=this.parseActionContent(t);return a&&(s.actionConditions=o.A.splitByChar(a,"AND").map(e=>A.parse(e))),U.checkpoint.map.setItemInMap("actions",s.interactionId,s),s.interactionId}static parseActionContent(e){let[t,a]=o.A.splitByChar(e,"("),s=!1,n=t;"*"===t[t.length-1]&&(s=!0,n=n.slice(0,-1));let i=y.stringToActionType(n),r=o.A.splitByChar(a.slice(0,-1),","),c={};switch(i){case"ObtainCollectible":c.id=r[0];break;case"CompleteObjective":c.id=r[0],U.validator.assertEntityType("objectives",r[0],n);break;case"CompleteTask":case"ShowTask":c.id=r[0],U.validator.assertEntityType("tasks",r[0],n);break;case"PreviewLocation":case"ChangeBackground":c.id=r[0],U.validator.assertEntityType("locations",r[0],n);break;case"StartAnimation":c.id=r[0],c.startFrame=+r[1],c.frameRate=+r[2],c.assetCategory=r[3],U.validator.assertAnimType(r[0],n);break;case"StopAnimation":c.id=r[0],U.validator.assertAnimType(r[0],n);break;case"ShowDialogue":c.id=r[0],U.validator.assertItemType("dialogues",r[0],n);break;case"AddItem":case"RemoveItem":{let e=y.stringToGameItemType(r[0]);c.gameItemType=e,c.locationId=r[1],U.validator.assertEntityType("locations",r[1],n),c.id=r[2],U.validator.assertItemType(e,r[2],n);break}case"AddLocationMode":case"RemoveLocationMode":U.validator.assertEntityType("locations",r[0],n),c.locationId=r[0],c.mode=y.stringToGameMode(r[1]);break;case"AddPopup":U.validator.assertItemType("objects",r[0],n),c.id=r[0],c.position=y.stringToPosition(r[1]),r[2]&&(c.duration=1e3*parseInt(r[2])),r[3]&&(c.size=y.stringToSize(r[3]));break;case"MakeObjectBlink":case"MakeObjectGlow":U.validator.assertItemType("objects",r[0],n),c.id=r[0],c.turnOn=y.stringToBoolean(r[1]);break;case"PlayBGM":c.id=r[0],U.validator.assertEntityType("bgms",r[0],n);break;case"PlaySFX":c.id=r[0],U.validator.assertEntityType("sfxs",r[0],n);break;case"ShowObjectLayer":c.show=y.stringToBoolean(r[0]);break;case"UpdateCharacter":U.validator.assertItemType("characters",r[0],n),c.id=r[0],c.expression=r[1];break;case"MoveCharacter":U.validator.assertItemType("characters",r[0],n),U.validator.assertEntityType("locations",r[1],n),c.id=r[0],c.locationId=r[1],c.position=y.stringToPosition(r[2]);break;case"NavigateToAssessment":c.assessmentId=r[0];break;case"Delay":c.duration=1e3*parseInt(r[0]);break;case"ShowQuiz":c.id=r[0],U.validator.assertItemType("quizzes",r[0],n)}return{actionType:i,actionParams:c,actionConditions:[],interactionId:U.generateActionId(),isInteractive:!1,isRepeatable:s}}}class k{static parsePrompt(e,t){return{promptTitle:e.split("prompt:")[1].trim(),choices:t.map(this.splitChoice)}}static splitChoice(e){let t=o.A.splitWithLimit(e,"->",1);return[t[0].trim(),t[1].split(" ")[1].trim()]}}var I=a(55647);class b{static parse(e,t){t.forEach(t=>this.parseCharacterDetails(e,t))}static characterAssetKey(e,t){return e+"-"+t}static characterAssetPath(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){let a="+"===t[0];a&&(t=t.slice(1));let[s,n,i,r,c]=o.A.splitByChar(t,",");U.validator.registerId(s);let g=new Map,h={id:s,name:n,expressions:g,defaultExpression:i,defaultPosition:y.stringToPosition(r),scale:c?parseFloat(c):1};g.set(i,this.characterAssetKey(s,i)),U.checkpoint.map.addMapAsset(this.characterAssetKey(s,i),{type:I.P.Image,path:this.characterAssetPath(s,i),key:s}),U.checkpoint.map.setItemInMap("characters",s,h),a&&U.checkpoint.map.addItemToLocation(e,"characters",s)}}class S{static parse(e){let[t,a,s]=o.A.splitByChar(e.slice(1),","),n=y.stringToPosition(s);return this.addCharacterExprToMap(t,a),{speakerId:t,expression:a,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;let a=U.checkpoint.map.getCharacterMap().get(e);if(!a)throw Error(`Character "${e}" not in map`);let s=t||a.defaultExpression;a.expressions.set(t,b.characterAssetKey(e,t||s)),U.checkpoint.map.addMapAsset(b.characterAssetKey(e,s),{path:b.characterAssetPath(e,s),type:I.P.Image,key:e})}}class f{static parse(e){o.A.splitToParagraph(e).forEach(([e,t])=>{0===t.length?console.error("No dialogue found for dialogueId"):this.parseDialogue(e,t)})}static parseDialogue(e,t){let[a,s]=o.A.splitWithLimit(e,",",1);U.validator.registerId(a);let n={title:s,content:this.parseDialogueContent(t)};n.title||(n.title=o.A.toCapitalizedWords(a)),U.checkpoint.map.setItemInMap("dialogues",a,n)}static parseDialogueContent(e){let t=o.A.mapByHeader(e,C);return(0,s.LG)(t,this.createDialogueLines)}static createDialogueLines(e){let t=[],a=0;for(;a!==e.length;){let s=e[a];switch(!0){case x(s):{let[e,a]=o.A.splitByChar(s,"if"),[n,i]=a?o.A.splitByChar(a,"else"):[null,null],r=n?o.A.splitByChar(n,"AND").map(e=>A.parse(e)):[];t[t.length-1].goto={conditions:r,part:e.split(" ")[1],altPart:i};break}case T(s):{let n=[];for(;e[a+1]&&L(e[a+1]);)a++,n.push(e[a].trim());let i=k.parsePrompt(s,n);t[t.length-1].prompt=i;break}case P(s):{let e=t[t.length-1];e.actionIds||(e.actionIds=[]),e.actionIds.push(w.parseAction(s));break}case v(s):{let n=e[++a];if(!n)throw Error("Parsing error: Cannot change speaker without next line");t.push({line:n}),t[t.length-1].speakerDetail=S.parse(s);break}default:t.push({line:s}),t[t.length-1].speakerDetail=S.parse("@narrator")}a++}return t}static parseQuizReaction(e){return this.parseDialogueContent(e)}}let C=e=>new RegExp(/^[0-9]+$/).test(e),x=e=>new RegExp(/^goto [0-9]+.*$/).test(e),P=e=>e&&("	"===e[0]||"    "===e.slice(0,4)),v=e=>e&&"@"===e[0],T=e=>e.trim().startsWith("prompt:"),L=e=>new RegExp(/-> +goto/).test(e);var G=a(96912);class O{static parse(e){e.forEach(e=>{let[t,a,s,n,i]=o.A.splitByChar(e,",");U.validator.registerId(t),U.checkpoint.map.addLocation(t,{...{id:"",name:"",assetKey:"",previewKey:null,modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([])},id:t,name:s,assetKey:this.locationAssetKey(a)}),U.checkpoint.map.addMapAsset(this.locationAssetKey(a),{type:I.P[n]||I.P.Image,key:t,path:this.locationPath(a),config:{frameWidth:G.es.x,frameHeight:G.es.y,centreX:G.MF.x,centreY:G.MF.y,endFrame:parseInt(i)-1||0,animType:"Background"}})})}static locationAssetKey(e){return e}static locationPath(e){return e}}class B{static parse(e,t){o.A.splitToParagraph(t).forEach(([t,a])=>{let s=this.parseBBoxConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=w.parseActions(a))})}static parseBBoxConfig(e,t){let a="+"===t[0];a&&(t=t.slice(1));let[s,n,i,r,c]=o.A.splitByChar(t,","),g={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(c),isInteractive:!1,interactionId:s};return U.validator.registerId(s),U.checkpoint.map.setItemInMap("boundingBoxes",s,g),a&&U.checkpoint.map.addItemToLocation(e,"boundingBoxes",s),g}}class E{static parse(e,t,a){t.forEach((t,s)=>{let[n,i,r]=o.A.splitByChar(t,",");U.validator.registerId(n),U.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseFloat(r),loop:1===a},soundType:a}),1===a&&0===s&&U.checkpoint.map.setBGMusicAt(e,n)})}}class j{static parse(e,t){o.A.splitToParagraph(t).forEach(([t,a])=>{let s=this.parseObjectConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=w.parseActions(a))})}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){let a="+"===t[0];a&&(t=t.slice(1));let[s,n,i,r,c,g,h,l]=o.A.splitByChar(t,",");U.validator.registerId(s);let d={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(c)||void 0,height:parseInt(g)||void 0,isInteractive:!1,interactionId:s};return U.checkpoint.map.addMapAsset(this.objectAssetKey(n),{type:I.P[h]||I.P.Image,key:s,path:this.objectPath(n),config:{frameHeight:parseInt(g)||-1,frameWidth:parseInt(c)||-1,centreX:0,centreY:0,endFrame:parseInt(l)-1||0,animType:"Object"}}),U.checkpoint.map.setItemInMap("objects",s,d),a&&U.checkpoint.map.addItemToLocation(e,"objects",s),d}}class R{static parse(e,t){let a=U.checkpoint.map.getLocationAtId(e);o.A.splitToParagraph(t).forEach(([e,t])=>{0===t.length&&e.includes(":")?this.parseLocationConfig(a,e):this.parseLocationParagraphs(a,e,t)})}static parseLocationConfig(e,t){let[a,s]=o.A.splitByChar(t,":"),n=o.A.splitByChar(s,",");switch(a){case"modes":n.forEach(t=>{let a=y.stringToGameMode(t);e.modes.add(a)});break;case"nav":n.forEach(t=>{U.validator.assertEntityType("locations",t),e.navigation.add(t)});break;case"talkTopics":U.validator.assertItemTypes("dialogues",n),e.talkTopics=new Set(n);break;case"preview":{let[t]=n;if(t){let a="/preview"+t;U.checkpoint.map.addMapAsset(a,{type:I.P.Image,key:e.id+"Preview",path:t}),e.previewKey=a}break}default:throw Error(`Invalid config key "${a}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,a){switch(t){case"objects":j.parse(e.id,a);break;case"boundingBoxes":B.parse(e.id,a);break;case"characters":b.parse(e.id,a);break;case"bgm":E.parse(e.id,a,1);break;case"sfx":E.parse(e.id,a,0);break;case"actions":e.actionIds=w.parseActions(a);break;default:throw Error(`Invalid location paragraph header "${t}"`)}}}class N{static parse(e){o.A.splitToParagraph(e).forEach(([e,t])=>{if(0===t.length)throw Error("Parsing error: No quiz content found for quizId");this.parseQuiz(e,t)})}static parseQuiz(e,t){U.validator.registerId(e);let a=o.A.mapByHeader(t,D),s=this.parseQuizQuestions(a);U.checkpoint.map.setItemInMap("quizzes",e,{questions:s})}static parseQuizQuestions(e){let t=Array(e.size);return e.forEach((e,a)=>{t[parseInt(a)]=this.createQuestion(e)}),t}static createQuestion(e){if(e.length<2)throw Error("Parsing error: Quiz missing question or answer");return{question:e[0],speaker:S.parse("@narrator"),answer:this.getQuizAnswer(e[1]),options:this.parseOptions(e.slice(2))}}static getQuizAnswer(e){let t=e.split(":");if(t.length<2||Number.isNaN(parseInt(t[1])))throw Error("Parsing error: Invalid answer for Quiz");return parseInt(t[1])}static parseOptions(e){let t=o.A.splitToParagraph(e),a=Array(t.length);return t.forEach(([e,t],s)=>{a[s]=this.createOption(t)}),a}static createOption(e,t=!1){if(!e)throw Error("Parsing error: Quiz option not provided");return e.length<=1&&(t=!0),{text:e[0],reaction:t?void 0:f.parseQuizReaction(e.slice(1))}}}let D=e=>new RegExp(/^[0-9]+$/).test(e);class F{static parse(e){let t=[];e.forEach(e=>{let[a,s,n]=o.A.splitWithLimit(e,",",2);t.push({taskId:a,title:s,description:n,visible:!1})}),U.checkpoint.tasks.addTasks(t)}}class z{static checkpoint;static actionIdNum;static validator;static generateActionId(){return z.actionIdNum++,`action#${z.actionIdNum}`}static init(){z.actionIdNum=0,z.checkpoint={map:new n,startingLoc:"",objectives:new i,tasks:new r},z.validator=new M}static parse(e,t=!1){t||z.init();let a=o.A.splitToLinesAndRemoveComments(e);o.A.splitToParagraph(a).forEach(([e,t])=>{0===t.length&&e.includes(":")?z.parseCheckpointConfig(e):z.parseCheckpointParagraphs(e,t)||R.parse(e,t)}),z.validator.verifyAssertions()}static parseCheckpointConfig(e){let[t,a]=o.A.splitByChar(e,":");if("startingLoc"===t)z.validator.assertEntityType("locations",a),z.checkpoint.startingLoc=a;else throw Error(`Invalid checkpoint config key, "${e}"`)}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":z.checkpoint.objectives.addObjectives(t);break;case"tasks":F.parse(t);break;case"locations":O.parse(t);break;case"gameStartActions":z.checkpoint.map.setGameStartActions(w.parseActions(t));break;case"checkpointCompleteActions":z.checkpoint.map.setCheckpointCompleteActions(w.parseActions(t));break;case"dialogues":f.parse(t);break;case"quizzes":N.parse(t);break;default:return!1}return!0}}let U=z},38083(e,t,a){a.d(t,{A:()=>r});var s,n=a(96912),i=((s={}).EscapeMenu="EscapeMenu",s.Dashboard="Dashboard",s);class r{phaseMap;phaseStack;inputManager;interruptCheckCallback;interruptTransitionCallback;transitionCallback;constructor(e,t){this.phaseStack=["None"],this.phaseMap=e,this.interruptCheckCallback=()=>!1,this.interruptTransitionCallback=async()=>n.YM.nullFunction(),this.transitionCallback=n.YM.nullFunction,this.inputManager=t}addPhaseToMap(e,t){this.phaseMap.set(e,t)}setInterruptCheckCallback(e){this.interruptCheckCallback=e}setInterruptCallback(e){this.interruptTransitionCallback=e}setCallback(e){this.transitionCallback=e}async popPhase(){let e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){let t=this.getCurrentPhase();e!==t&&(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){let t=this.getCurrentPhase();e!==t&&(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){if(this.inputManager.enableKeyboardInput(!1),this.inputManager.enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),this.interruptCheckCallback(e,t)){this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0),await this.interruptTransitionCallback(e,t);return}this.transitionCallback(e,t),await this.phaseMap.get(t).activateUI(),this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}isCurrentPhaseTerminal(){return Object.values(i).includes(this.getCurrentPhase())}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=["None"]),this.phaseStack[this.phaseStack.length-1]}}},40738(e,t,a){a.d(t,{Bt:()=>i,GT:()=>o,Q9:()=>c,_8:()=>r});var s=a(38863),n=a(22937);function i(e,t,a){let i=s.A.getInstance().getGameManager(),r=i.getStateManager(),o=i.getPhaseManager();return{gameSaveStates:{...e.gameSaveStates,[t]:{lastCheckpointPlayed:a,currentLocation:i.currentLocationId,currentPhase:o.getCurrentPhase(),chapterNewlyCompleted:r.getChapterNewlyCompleted(),incompleteTasks:r.getIncompleteTasks(),completedTasks:r.getCompletedTasks(),completedObjectives:r.getCompletedObjectives(),triggeredInteractions:r.getTriggeredInteractions(),triggeredStateChangeActions:r.getTriggeredStateChangeActions(),quizScores:r.getQuizScores()}},userSaveState:{settings:e.userSaveState.settings,recentlyPlayedCheckpoint:[t,a],collectibles:n.Ay.getInstance().getUserStateManager().getCollectibles(),largestCompletedChapter:e.userSaveState.largestCompletedChapter}}}let r=()=>({gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}),o=()=>({lastCheckpointPlayed:0,currentLocation:void 0,currentPhase:"Menu",chapterNewlyCompleted:!1,incompleteTasks:[],completedTasks:[],completedObjectives:[],triggeredInteractions:[],triggeredStateChangeActions:[],quizScores:[]});function c(e){return Array.from(e).filter(([e,t])=>t).map(([e])=>e)}},15312(e,t,a){a.d(t,{Z:()=>h,i:()=>g});var s=a(2543),n=a.n(s),i=a(91948),r=a(22937),o=a(54166),c=a(40738);async function g(e){let t={method:"PUT",headers:l(r.Ay.getInstance().getAccountInfo().accessToken),body:JSON.stringify({gameStates:e})},a=await fetch(`${i.A.backendUrl}/v2/courses/${(0,o.$3)()}/user/game_states`,t);if(a&&a.ok)return a}async function h(){let e={method:"GET",headers:l(r.Ay.getInstance().getAccountInfo().accessToken)},t=await fetch(`${i.A.backendUrl}/v2/user`,e),a=await t.text(),s=JSON.parse(a).courseRegistration?.gameStates;return n().isEmpty(s)?(0,c._8)():s}function l(e){let t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t.append("Content-Type","application/json"),t}},64297(e,t,a){a.d(t,{A:()=>d});var s=a(22937),n=a(54166),i=a(7329),r=a(87293),o=a(1185),c=a(96912);let g={key:o.A.alienCowsFont.key,size:80,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},h={text:{chapter:"Chapter completed.",checkpoint:"Checkpoint reached."},transitionTextConfig:{x:c.MF.x,y:c.MF.y,oriX:.5,oriY:.5},tweenDuration:1500,entryTween:{alpha:1,duration:1500,ease:"Power2"},exitTween:{alpha:0,duration:1500,ease:"Power2"}};class l extends Phaser.Scene{constructor(){super("CheckpointTransition")}preload(){s.Ay.getInstance().setCurrentSceneRef(this)}async create(){if(s.Ay.getInstance().isGameType("Simulator")){await this.showTransitionText(h.text.checkpoint),await (0,r.S)();return}let e=s.Ay.getInstance().getSaveManager().getFullSaveState(),t=s.Ay.getInstance().getGameChapters(),[a,n]=e.userSaveState.recentlyPlayedCheckpoint;this.isLastCheckpoint(t,a,n)?(await s.Ay.getInstance().getSaveManager().saveChapterComplete(a),await this.showTransitionText(h.text.chapter),this.isLastChapter(t,a))?this.scene.start("ChapterSelect"):await (0,r.X)(!0,a+1,0):(await this.showTransitionText(h.text.checkpoint),await (0,r.X)(!1,a,n+1))}async showTransitionText(e){let t=(0,i.P)(this,e,h.transitionTextConfig,g).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...h.entryTween}),await (0,n.yy)(2*h.tweenDuration),this.tweens.add({targets:t,...h.exitTween}),await (0,n.yy)(h.tweenDuration)}isLastCheckpoint(e,t,a){return a>=e[t].filenames.length-1}isLastChapter(e,t){return t>=e.length-1}}let d=l},38863(e,t,a){let s;a.d(t,{A:()=>v});var n=a(31230),i=a(68440),r=a(1185),o=a(84977),c=a(89751),g=a(96912),h=a(22937),l=a(54166),d=a(7329),p=a(3563),u=a(86914);let y={x:1900,y:100,oriX:1,oriY:.5},m={key:r.A.zektonDarkFont.key,size:24,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},M=(s=Promise.resolve(),(e,t)=>{s=s.then(()=>A(e,t))});async function A(e,t){let a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Sprite(e,g.es.x,100,o.A.messageBar.key);s.setScale(-1.5,.8);let n=(0,d.P)(e,t,y,m);a.add([s,n]),e.getLayerManager().addToLayer(0,a),a.setPosition(g.es.x,0),a.setAlpha(0),h.Ay.getInstance().getSoundManager().playSound(c.A.notifEnter.key),e.add.tween({targets:a,alpha:1,...u.Bs}),await (0,l.yy)(u.Bs.duration+3e3),h.Ay.getInstance().getSoundManager().playSound(c.A.notifExit.key),e.add.tween({targets:a,alpha:1,...u.rX}),await (0,l.yy)(u.rX.duration),(0,p.E_)(e,a,{fadeDuration:g.YM.fadeDuration})}var w=a(26947),k=a(68431),I=a(13001),b=a(35071);let S={key:r.A.alienLeagueFont.key,size:100,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},f={x:g.MF.x,y:w.Ay.rect.y+2*S.size,oriX:.5,oriY:.9};async function C(e,t){let a=new k.A({}),s=a.getDialogueContainer();e.getLayerManager().addToLayer(0,s),e.getLayerManager().fadeInLayer(0);let n=(0,d.P)(e,t,f,S).setAlpha(0);s.add(n),h.Ay.getInstance().getSoundManager().playSound(c.A.notifEnter.key),e.add.tween((0,p.qG)([n],2*g.YM.fadeDuration)),await (0,l.yy)(2*g.YM.fadeDuration);let i=new b.A(e),r=()=>{h.Ay.getInstance().getSoundManager().playSound(c.A.notifExit.key),(0,p.E_)(e,n,{fadeDuration:g.YM.fadeDuration/4}),a.destroy()},o=new Promise(e=>{i.registerKeyboardListener(I.L.Notif,"up",async()=>{i.clearKeyboardListeners([I.L.Notif]),r(),e()}),a.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{r(),e()})});await o}var x=a(48022);class P{gameManager;static instance;constructor(){this.gameManager=void 0}static getInstance(){return P.instance||(P.instance=new P),P.instance}getGameManager=()=>(0,l.y)(this.gameManager);setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getStateManager().getGameMap().getLocationAtId(e)}async changeLocationTo(e){await this.getGameManager().changeLocationTo(e)}getLocationModes(e){return this.getGameManager().getStateManager().getLocationModes(e)}addLocationMode(e,t){this.getGameManager().getStateManager().addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().getStateManager().removeLocationMode(e,t)}hasTriggeredInteraction(e){return this.getGameManager().getStateManager().hasTriggeredInteraction(e)}triggerStateChangeAction(e){this.getGameManager().getStateManager().triggerStateChangeAction(e)}triggerInteraction(e){this.getGameManager().getStateManager().triggerInteraction(e)}watchGameItemType(e,t){this.getGameManager().getStateManager().watchGameItemType(e,t)}getGameMap(){return this.getGameManager().getStateManager().getGameMap()}getGameItemsInLocation(e,t){return this.getGameManager().getStateManager().getGameItemsInLocation(e,t)}addItem(e,t,a){this.getGameManager().getStateManager().addItem(e,t,a)}removeItem(e,t,a){return this.getGameManager().getStateManager().removeItem(e,t,a)}makeObjectGlow(e,t){this.getGameManager().getObjectManager().makeObjectGlow(e,t)}makeObjectBlink(e,t){this.getGameManager().getObjectManager().makeObjectBlink(e,t)}objectHoverGlow(e,t){this.getGameManager().getObjectManager().objectHoverGlow(e,t)}setObjProperty(e,t){this.getGameManager().getStateManager().setObjProperty(e,t)}renderObjectLayerContainer(e){this.getGameManager().getObjectManager().renderObjectsLayerContainer(e)}getAllActivatables(){return[...this.getGameManager().getObjectManager().getActivatables(),...this.getGameManager().getBBoxManager().getActivatables()]}setBBoxProperty(e,t){this.getGameManager().getStateManager().setBBoxProperty(e,t)}renderBBoxLayerContainer(e){this.getGameManager().getBBoxManager().renderBBoxLayerContainer(e)}areAllObjectivesComplete(){return this.getGameManager().getStateManager().areAllObjectivesComplete()}isObjectiveComplete(e){return this.getGameManager().getStateManager().isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().getStateManager().areObjectivesComplete(e)}completeObjective(e){this.getGameManager().getStateManager().completeObjective(e)}isTaskComplete(e){return this.getGameManager().getStateManager().isTaskComplete(e)}areTasksComplete(e){return this.getGameManager().getStateManager().areTasksComplete(e)}completeTask(e){this.getGameManager().getStateManager().completeTask(e),M(this.getGameManager(),"Task completed!")}showTask(e){this.getGameManager().getStateManager().showTask(e),M(this.getGameManager(),"New task added")}getAllVisibleTaskData(){return this.getGameManager().getStateManager().getAllVisibleTaskData()}addCollectible(e){h.Ay.getInstance().getUserStateManager().addCollectible(e)}async isInUserState(e,t){return h.Ay.getInstance().getUserStateManager().isInUserState(e,t)}clearSeveralLayers(e){this.getGameManager().getLayerManager().clearSeveralLayers(e)}addToLayer(e,t){this.getGameManager().getLayerManager().addToLayer(e,t)}showLayer(e){this.getGameManager().getLayerManager().showLayer(e)}hideLayer(e){this.getGameManager().getLayerManager().hideLayer(e)}async fadeInLayer(e,t){await this.getGameManager().getLayerManager().fadeInLayer(e,t)}async fadeOutLayer(e,t){await this.getGameManager().getLayerManager().fadeOutLayer(e,t)}async bringUpUpdateNotif(e){await C(this.getGameManager(),e)}async processGameActions(e){await this.getGameManager().getPhaseManager().pushPhase("Sequence"),await this.getGameManager().getActionManager().processGameActions(e),await this.getGameManager().getPhaseManager().popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().getActionManager().processGameActions(e)}async showDialogue(e){await this.getGameManager().getPhaseManager().pushPhase("Sequence"),await this.getGameManager().getDialogueManager().showDialogue(e),await this.getGameManager().getPhaseManager().popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().getDialogueManager().showDialogue(e)}async showNextLine(e){await this.getGameManager().getDialogueManager().showNextLine(e)}storeDialogueLine(e,t){this.getGameManager().getDialogueStorageManager().storeLine(e,t)}getDialogueStorage(){return this.getGameManager().getDialogueStorageManager().getDialogueStorage()}async obtainCollectible(e){M(this.getGameManager(),`Obtained ${(0,i.Ni)(e).title}`),h.Ay.getInstance().getUserStateManager().addCollectible(e)}displayPopUp(e,t,a,s){this.getGameManager().getPopupManager().displayPopUp(e,t,a,s)}destroyAllPopUps(){this.getGameManager().getPopupManager().destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().getPopupManager().destroyPopUp(e)}async saveGame(){await this.getGameManager().getSaveManager().saveGame()}async saveSettings(e){await this.getGameManager().getSaveManager().saveSettings(e)}getLoadedUserState(){return this.getGameManager().getSaveManager().getLoadedUserState()}getSoundManager(){return h.Ay.getInstance().getSoundManager()}playSound(e){h.Ay.getInstance().getSoundManager().playSound(e)}playBgMusic(e){h.Ay.getInstance().getSoundManager().playBgMusic(e)}async stopAllSound(){h.Ay.getInstance().getSoundManager().stopAllSound()}pauseCurrBgMusic(){h.Ay.getInstance().getSoundManager().pauseCurrBgMusic()}continueCurrBgMusic(){h.Ay.getInstance().getSoundManager().continueCurrBgMusic()}applySoundSettings(e){h.Ay.getInstance().getSoundManager().applyUserSettings(e)}loadSounds(e){h.Ay.getInstance().getSoundManager().loadSounds(e)}startAnimation(e,t,a){let s=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().displayAnimation(s,t,a)}stopAnimation(e){let t=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().stopAnimation(t)}setDefaultCursor(e){this.getGameManager().getInputManager().setDefaultCursor(e)}enableKeyboardInput(e){this.getGameManager().getInputManager().enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().getInputManager().enableMouseInput(e)}enableSprite(e,t){t?this.getGameManager().input.enable(e):this.getGameManager().input.disable(e)}async popPhase(){await this.getGameManager().getPhaseManager().popPhase()}async pushPhase(e){await this.getGameManager().getPhaseManager().pushPhase(e)}async swapPhase(e){await this.getGameManager().getPhaseManager().swapPhase(e)}isCurrentPhase(e){return this.getGameManager().getPhaseManager().isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(e)}async promptNavigateToAssessment(e){if(0===await (0,x.N)(P.getInstance().getGameManager(),"Are you ready for the challenge?",["Yes","No"])){let t=await (0,n.Dc)(h.Ay.getInstance().getAccountInfo());if(t){let{id:a,type:s}=t.filter(t=>t.number===e)[0];window.open(`/courses/${(0,l.$3)()}/${s.toLowerCase()}/${a}/0`,"blank"),window.focus()}}}async updateAssessmentState(){await h.Ay.getInstance().getUserStateManager().loadAssessments()}createCharacterSprite(e,t,a){return this.getGameManager().getCharacterManager().createCharacterSprite(e,t,a)}moveCharacter(e,t,a){this.getGameManager().getStateManager().moveCharacter(e,t,a)}updateCharacter(e,t){this.getGameManager().getStateManager().updateCharacter(e,t)}getDialogueById(e){return(0,l.y)(this.getGameMap().getDialogueMap().get(e))}getCharacterById(e){return(0,l.y)(this.getGameMap().getCharacterMap().get(e))}getActionById(e){return(0,l.y)(this.getGameMap().getActionMap().get(e))}getObjectById(e){return(0,l.y)(this.getGameMap().getObjectPropMap().get(e))}getBBoxById(e){return(0,l.y)(this.getGameMap().getBBoxPropMap().get(e))}getQuizById(e){return(0,l.y)(this.getGameMap().getQuizMap().get(e))}getAssetByKey(e){return this.getGameMap().getAssetByKey(e)}async showQuiz(e){await this.getGameManager().getQuizManager().showQuiz(e)}getQuizLength(e){return this.getGameManager().getQuizManager().getNumOfQns(e)}isQuizAttempted(e){return this.getGameManager().getStateManager().isQuizAttempted(e)}isQuizComplete(e){return this.getGameManager().getStateManager().isQuizComplete(e)}setQuizScore(e,t){this.getGameManager().getStateManager().setQuizScore(e,t)}getQuizScore(e){return this.getGameManager().getStateManager().getQuizScore(e)}}let v=P},39195(e,t,a){a.d(t,{A:()=>eL});var s=a(38863);class n{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map(async e=>await this.checkConditionSatisfied(e)))).every(e=>!0===e)}static async checkConditionSatisfied(e){let{state:t,conditionParams:a,boolean:n}=e;switch(t){case"UserState":return await s.A.getInstance().isInUserState(a.userStateType,a.id)===n;case"ChecklistState":return s.A.getInstance().isObjectiveComplete(a.id)===n;case"TasklistState":return s.A.getInstance().isTaskComplete(a.id)===n;case"AttemptedQuizState":return s.A.getInstance().isQuizAttempted(a.id)===n;case"PassedQuizState":return s.A.getInstance().isQuizComplete(a.id)===n;case"QuizScoreState":return s.A.getInstance().getQuizScore(a.id)>=parseInt(a.score)===n;default:return!0}}}var i=a(22937),r=a(54166);class o{static async executeGameAction(e,t){let a=s.A.getInstance();switch(e){case"AddItem":a.addItem(t.gameItemType,t.locationId,t.id);return;case"RemoveItem":a.removeItem(t.gameItemType,t.locationId,t.id);return;case"AddLocationMode":a.addLocationMode(t.locationId,t.mode);return;case"RemoveLocationMode":a.removeLocationMode(t.locationId,t.mode);return;case"MoveCharacter":a.moveCharacter(t.id,t.locationId,t.position);return;case"UpdateCharacter":a.updateCharacter(t.id,t.expression);return;case"ChangeBackground":a.renderBackgroundLayerContainer(t.id);return;case"StartAnimation":a.startAnimation(t.id,t.startFrame,t.frameRate);return;case"StopAnimation":a.stopAnimation(t.id);return;case"PreviewLocation":a.renderBackgroundLayerContainer(t.id),a.renderObjectLayerContainer(t.id),a.renderBBoxLayerContainer(t.id);return;case"ObtainCollectible":a.obtainCollectible(t.id);return;case"CompleteObjective":a.completeObjective(t.id);return;case"CompleteTask":a.completeTask(t.id);return;case"ShowTask":a.showTask(t.id);return;case"ShowDialogue":a.isCurrentPhase("Sequence")?await a.showDialogueInSamePhase(t.id):await a.showDialogue(t.id);return;case"AddPopup":await a.displayPopUp(t.id,t.position,t.duration,t.size);return;case"MakeObjectBlink":await a.makeObjectBlink(t.id,t.turnOn);return;case"MakeObjectGlow":await a.makeObjectGlow(t.id,t.turnOn);return;case"PlayBGM":i.Ay.getInstance().getSoundManager().playBgMusic(t.id);return;case"PlaySFX":await i.Ay.getInstance().getSoundManager().playSound(t.id);return;case"ShowObjectLayer":t.show?a.showLayer(8):a.hideLayer(8);return;case"NavigateToAssessment":await a.promptNavigateToAssessment(t.assessmentId);return;case"UpdateAssessmentStatus":await a.updateAssessmentState();return;case"Delay":await (0,r.yy)(t.duration);return;case"ShowQuiz":a.enableKeyboardInput(!1),await a.showQuiz(t.id),a.enableKeyboardInput(!0);return;default:return}}static isStateChangeAction(e){switch(e){case"AddItem":case"RemoveItem":case"AddLocationMode":case"RemoveLocationMode":case"MoveCharacter":case"UpdateCharacter":return!0;case"NavigateToAssessment":case"UpdateAssessmentStatus":case"PreviewLocation":case"ChangeBackground":case"StartAnimation":case"StopAnimation":case"ObtainCollectible":case"CompleteObjective":case"CompleteTask":case"ShowTask":case"ShowDialogue":case"AddPopup":case"MakeObjectBlink":case"MakeObjectGlow":case"PlayBGM":case"PlaySFX":case"ShowObjectLayer":case"Delay":case"ShowQuiz":return!1}}}class c{async fastForwardGameActions(e){if(e)for(let t of e){let{actionType:e,actionParams:a}=s.A.getInstance().getActionById(t);await o.executeGameAction(e,a)}}async processGameActions(e){if(e){for(let t of e)await this.processGameAction(t);await s.A.getInstance().saveGame(),s.A.getInstance().getGameManager().notifyActionJustSaved()}}async processGameAction(e){let{actionType:t,actionParams:a,actionConditions:n,isRepeatable:i,interactionId:r}=s.A.getInstance().getActionById(e);await this.checkCanPlayAction(i,r,n)&&(await o.executeGameAction(t,a),o.isStateChangeAction(t)&&s.A.getInstance().triggerStateChangeAction(e),s.A.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,a){return(e||!s.A.getInstance().hasTriggeredInteraction(t))&&await n.checkAllConditionsSatisfied(a)}}var g=a(55647);class h{game=s.A.getInstance().getGameManager();animationInstanceMap=new Map;createImage(e,t){switch(e.type){case g.P.Sprite:return this.createAnimation(e,e.config?.start||0,e.config?.frameRate||20),this.getAnimation(e);case g.P.Image:return new Phaser.GameObjects.Image(this.game,e?.config?.centreX||0,e?.config?.centreY||0,t)}}displayAnimation(e,t,a){let n=s.A.getInstance().getAssetByKey(e.path);switch(n&&n.config&&(n.config.start=t,n.config.frameRate=a),n.config?.animType){case"Object":{let t=s.A.getInstance().getCurrLocId();s.A.getInstance().addItem("objects",t,e.key);break}case"Background":s.A.getInstance().renderBackgroundLayerContainer(e.key)}}createAnimation(e,t,a){if(this.isSprite(e)){this.removeAnimation(e);let s=new Phaser.GameObjects.Sprite(this.game,e.config?.centreX||0,e.config?.centreY||0,e.path),n={key:e.path,frames:this.game.anims.generateFrameNumbers(e.path,{start:t,end:e.config?.endFrame||0,first:0}),frameRate:a,repeat:-1};this.game.anims.create(n),this.animationInstanceMap.set(e.key,s)}}startAnimation(e){if(this.isSprite(e)){let t=this.getAnimation(e);t.play(e.path,!1),this.game.add.existing(t)}}stopAnimation(e){let t=this.animationInstanceMap.get(e.key);this.isSprite(e)&&t&&t.anims&&t.anims.stop()}removeAnimation(e){let t=this.animationInstanceMap.get(e.key);t&&(this.game.anims.remove(e.path),t.destroy(),this.animationInstanceMap.delete(e.key))}getAnimation(e){return(0,r.y)(this.animationInstanceMap.get(e.key),`Image: ${e.path} not found`)}isSprite=e=>e.type===g.P.Sprite}var l=a(69681),d=a(96912),p=a(4907);class u{currentBackground;renderBackgroundLayerContainer(e){let t=s.A.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){let t;s.A.getInstance().clearSeveralLayers([1]),this.currentBackground=s.A.getInstance().getAssetByKey(e);let a=s.A.getInstance().getGameManager().getAnimationManager();this.currentBackground&&(t=a.createImage(this.currentBackground,e),a.startAnimation(this.currentBackground),(0,p.v8)(t,d.es.x,d.es.y),s.A.getInstance().addToLayer(1,t),s.A.getInstance().fadeInLayer(1))}}let y=class{bboxes;constructor(){this.bboxes=new Map,s.A.getInstance().watchGameItemType("boundingBoxes",this)}renderBBoxLayerContainer(e){s.A.getInstance().clearSeveralLayers([9]);let t=s.A.getInstance().getGameItemsInLocation("boundingBoxes",e);this.bboxes.clear(),t.map(e=>this.handleAdd(e))}createBBox(e){let t=s.A.getInstance().getGameManager(),{x:a,y:n,width:i,height:r,actionIds:o,interactionId:c}=e,g=new Phaser.GameObjects.Rectangle(t,a,n,i,r,0,0);return e.isInteractive&&g.setInteractive(),{sprite:g,clickArea:g,actionIds:o,interactionId:c}}handleAdd(e){let t=s.A.getInstance().getBBoxById(e),a=this.createBBox(t);return s.A.getInstance().addToLayer(9,a.sprite),this.bboxes.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){let t=this.bboxes.get(e);return!!t&&(this.bboxes.delete(e),t.sprite.destroy(),!0)}getActivatables(){return Array.from(this.bboxes.values())}},m={charWidth:600,charRect:{x:{Left:350,Middle:d.MF.x,Right:d.es.x-350}}};class M{characterSpriteMap;constructor(){this.characterSpriteMap=new Map,s.A.getInstance().watchGameItemType("characters",this)}renderCharacterLayerContainer(e){let t=s.A.getInstance().getGameItemsInLocation("characters",e);this.characterSpriteMap.clear(),t.map(e=>this.handleAdd(e))}createCharacterSprite(e,t,a){let{defaultPosition:n,defaultExpression:i,expressions:r,scale:o}=s.A.getInstance().getCharacterById(e),c=m.charRect.x[a||n],g=r.get(t||i),h=new Phaser.GameObjects.Image(s.A.getInstance().getGameManager(),c,d.es.y,g).setOrigin(.5,1);return(0,p.XR)(h,m.charWidth*o),h}handleAdd(e){let t=this.createCharacterSprite(e);return s.A.getInstance().addToLayer(2,t),this.characterSpriteMap.set(e,t),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){let t=this.characterSpriteMap.get(e);return!!t&&(this.characterSpriteMap.delete(e),t.destroy(),!0)}}var A=a(50891),w=a(11897),k=a(89751),I=a(48022),b=a(13001),S=a(35071),f=a(26947);class C{currPart;currLineNum;dialogueContent;constructor(e){this.dialogueContent=e,this.currPart=e.keys().next().value||"",this.currLineNum=0}async generateNextLine(){let e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){let t=e.goto.part;if(await n.checkAllConditionsSatisfied(e.goto.conditions)||(t=e.goto.altPart),t)if(!this.dialogueContent.get(t))return{line:""};else this.currPart=t,this.currLineNum=0;else this.currLineNum++}else this.currLineNum++;return e}updateCurrPart(e){this.currPart=e,this.currLineNum=0}}var x=a(68431),P=a(84977),v=a(31691),T=a(7329);class L{currentSpeakerId;speakerSprite;speakerSpriteBox;changeSpeakerTo(e){void 0!==e&&(this.currentSpeakerId&&s.A.getInstance().clearSeveralLayers([3,6]),this.showNewSpeaker(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){if("narrator"===e)return;let t="you"===e?this.createSpeakerBox(this.getUsername(),"Right"):this.createSpeakerBox(s.A.getInstance().getCharacterById(e).name,"Left");s.A.getInstance().addToLayer(6,t)}drawSpeakerSprite({speakerId:e,speakerPosition:t,expression:a}){if(this.currentSpeakerId=e,"you"===e||"narrator"===e)return;let n=s.A.getInstance().createCharacterSprite(e,a,t);this.speakerSprite=n,s.A.getInstance().addToLayer(3,n)}createSpeakerBox(e,t){let a=s.A.getInstance().getGameManager(),n=new Phaser.GameObjects.Container(a,0,0),i=new Phaser.GameObjects.Image(a,d.MF.x,d.MF.y,P.A.speakerBox.key).setAlpha(.8),r=(0,T.P)(a,"",f.Ay.speakerTextConfig,f.ir);return"Right"===t&&(i.displayWidth*=-1,r.x=d.es.x-r.x),n.add([i,r]),r.text=v.A.capitalize(e),this.speakerSpriteBox=n,n}async hide(){this.getSpeakerSprite().setVisible(!1),this.getSpeakerSpriteBox().setVisible(!1)}async show(){this.getSpeakerSprite().setVisible(!0),this.getSpeakerSpriteBox().setVisible(!0)}getUsername=()=>i.Ay.getInstance().getAccountInfo().name;getSpeakerSprite=()=>this.speakerSprite;getSpeakerSpriteBox=()=>this.speakerSpriteBox}class G{speakerRenderer;dialogueRenderer;dialogueGenerator;gameInputManager=new S.A(s.A.getInstance().getGameManager());async showDialogue(e){let t=s.A.getInstance().getDialogueById(e);this.dialogueRenderer=new x.A(f.a5),this.dialogueGenerator=new C(t.content),this.speakerRenderer=new L,s.A.getInstance().addToLayer(5,this.dialogueRenderer.getDialogueContainer()),s.A.getInstance().fadeInLayer(5),await new Promise(e=>this.playWholeDialogue(e)),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null)}async playWholeDialogue(e){await this.showNextLine(e),this.getInputManager().registerKeyboardListener(b.L.Next,"up",async()=>{s.A.getInstance().getGameManager().getPhaseManager().isCurrentPhaseTerminal()||await this.showNextLine(e)}),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,async()=>{await this.showNextLine(e)})}async showNextLine(e){s.A.getInstance().playSound(k.A.dialogueAdvance.key);let{line:t,speakerDetail:a,actionIds:n,prompt:i}=await this.getDialogueGenerator().generateNextLine(),r=this.makeLineWithQuizScores(t).replace("{name}",this.getUsername());if(this.getDialogueRenderer().changeText(r),this.getSpeakerRenderer().changeSpeakerTo(a),s.A.getInstance().storeDialogueLine(r,a),s.A.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!1),this.getInputManager().enableKeyboardInput(!1),i){this.getInputManager().enableKeyboardInput(!1);let e=await (0,I.N)(s.A.getInstance().getGameManager(),i.promptTitle,i.choices.map(e=>e[0]));this.getInputManager().enableKeyboardInput(!0),this.getDialogueGenerator().updateCurrPart(i.choices[e][1])}await s.A.getInstance().processGameActionsInSamePhase(n),s.A.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!0),this.getInputManager().enableKeyboardInput(!0),t||(this.getInputManager().clearKeyboardListeners([b.L.Next]),e())}async hideAll(){await this.getDialogueRenderer().hide(),await this.getSpeakerRenderer().hide()}async showAll(){await this.getDialogueRenderer().show(),await this.getSpeakerRenderer().show()}makeLineWithQuizScores(e){for(let t of e.matchAll(/\{(.+?)\.score\}/g))e=e.replace(t[0],s.A.getInstance().getQuizScore(t[1]).toString());return e}getDialogueGenerator=()=>this.dialogueGenerator;getDialogueRenderer=()=>this.dialogueRenderer;getSpeakerRenderer=()=>this.speakerRenderer;getInputManager=()=>this.gameInputManager;getUsername=()=>i.Ay.getInstance().getAccountInfo().name}class O{dialogueStorage;storeLine(e,t){if(!t)return;this.dialogueStorage||(this.dialogueStorage=[]);let a={speaker:this.getSpeakerName(t),line:e};this.dialogueStorage.push(a)}getSpeakerName(e){let t=e?.speakerId;return t?"you"===t?this.getUsername():"narrator"===t?"Narrator":s.A.getInstance().getCharacterById(t).name:""}clearDialogueStorage(){this.dialogueStorage=[]}getDialogueStorage(){return this.dialogueStorage?this.dialogueStorage.map(e=>`${e.speaker}:
${e.line}`):[]}getUsername=()=>i.Ay.getInstance().getAccountInfo().name}var B=a(3563),E=a(21638),j=a(73631),R=a(96550),N=a(765),D=a(1185);let F={key:D.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},z=.251*d.es.x,U={logTextConfig:{x:-.44*d.es.x,y:-.378*d.es.y,oriX:0,oriY:0},textMaxWidth:.68*d.es.x,logHeight:.7632*d.es.y,scrollbarTrack:{x:z,y:.005*d.es.y,width:7,height:.73*d.es.y,color:5592405},scrollbarThumb:{x:z,width:7,color:8947848},scrollSpeed:.5},_=class{scene;constructor(e){this.scene=e}createUIContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0),t=s.A.getInstance().getDialogueStorage();if(0===t.length)return e;let a=(0,T.P)(this.scene,t.join("\n\n"),U.logTextConfig,F).setMaxWidth(U.textMaxWidth),n=U.logTextConfig.y-Math.max(a.height-U.logHeight,0);a.y=n,e.add(a);let i=new Phaser.GameObjects.Rectangle(this.scene,U.scrollbarTrack.x,U.scrollbarTrack.y,U.scrollbarTrack.width,U.scrollbarTrack.height,U.scrollbarTrack.color),o=Math.max(U.logHeight/a.height*U.scrollbarTrack.height,4*U.scrollbarThumb.width),c=U.scrollbarTrack.y+U.scrollbarTrack.height/2-o/2,g=(U.scrollbarTrack.height-o)/(U.logTextConfig.y-n),h=new Phaser.GameObjects.Rectangle(this.scene,U.scrollbarThumb.x,c,U.scrollbarThumb.width,o,U.scrollbarThumb.color);e.add(i),e.add(h),a.height<=U.logHeight&&(i.setVisible(!1),h.setVisible(!1));let{x:l,y:d,width:p,height:u}=N.A.pageArea,y=new Phaser.GameObjects.Zone(this.scene,l+p/2,d+u/2,p,u);return y.setInteractive(),y.on("wheel",(e,t,s,i)=>{a.y=(0,r.NS)(a.y-s*U.scrollSpeed,n,U.logTextConfig.y),h.y=c-(a.y-n)*g}),e.add(y),e}};var K=a(92633);class V{scene;container;imageGlow;clickArea;glowClearer;blinkClearer;constructor(e,t,a,n,i,r){this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,a),this.imageGlow=new Phaser.GameObjects.Image(e,0,0,n).setAlpha(0).setBlendMode(Phaser.BlendModes.ADD),this.clickArea=new Phaser.GameObjects.Image(e,0,0,n).setAlpha(.01).setInteractive({pixelPerfect:!0});const o=s.A.getInstance().getGameMap().getMapAssets().get(n),c=s.A.getInstance().getGameManager().getAnimationManager();if(o){const e=c.createImage(o,n);switch(o?.type){case g.P.Sprite:this.clickArea.setAlpha(0),c.startAnimation(o);break;case g.P.Image:i&&((0,p.XR)(e,i,r),(0,p.XR)(this.imageGlow,i,r),(0,p.XR)(this.clickArea,i,r))}this.container.add([e,this.imageGlow,this.clickArea])}}startGlow(){this.glowClearer?.(),this.glowClearer=(0,B.Zm)(this.scene,this.imageGlow),this.imageGlow.setAlpha(1)}clearGlow(){this.glowClearer?.(),this.imageGlow.setAlpha(0)}startBlink(){this.blinkClearer=(0,B.Zm)(this.scene,this.getContainer())}clearBlink(){this.getContainer().setAlpha(1),this.blinkClearer?.()}hoverGlowStart(){this.imageGlow.setAlpha(.5)}hoverGlowEnd(){this.imageGlow.setAlpha(0)}getContainer(){return this.container}getClickArea(){return this.clickArea}}let X=class{objects;constructor(){this.objects=new Map,s.A.getInstance().watchGameItemType("objects",this)}renderObjectsLayerContainer(e){s.A.getInstance().clearSeveralLayers([8]);let t=s.A.getInstance().getGameItemsInLocation("objects",e);this.objects.clear(),t.map(e=>this.handleAdd(e))}makeObjectGlow(e,t){let a=this.objects.get(e);a&&(t?a.sprite.startGlow():a.sprite.clearGlow())}makeObjectBlink(e,t){let a=this.objects.get(e);a&&(t?a.sprite.startBlink():a.sprite.clearBlink())}objectHoverGlow(e,t){let a=this.objects.get(e);a&&(t?a.sprite.hoverGlowStart():a.sprite.hoverGlowEnd())}createObject(e){let t=s.A.getInstance().getGameManager(),{assetKey:a,x:n,y:i,width:r,height:o,actionIds:c,interactionId:g}=e,h=new V(t,n,i,a,r,o);return{sprite:h,clickArea:h.getClickArea(),actionIds:c,interactionId:g}}handleAdd(e){let t=s.A.getInstance().getObjectById(e),a=this.createObject(t);return s.A.getInstance().addToLayer(8,a.sprite.getContainer()),this.objects.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){let t=this.objects.get(e);return!!t&&(this.objects.delete(e),t.sprite.getContainer().destroy(),!0)}getActivatables(){return Array.from(this.objects.values())}};var Y=a(38083);let Q={image:{xOffset:20,yOffset:20},rect:{x:{Left:400,Middle:d.MF.x,Right:d.es.x-400},y:{Small:325,Medium:350,Large:420},scale:{Small:.7,Medium:1,Large:1.5},width:280,height:280},tweenDuration:300},$=class{currPopUp;constructor(){this.currPopUp=new Map}async displayPopUp(e,t,a=d.YM.popUpDuration,n="Medium"){this.destroyPopUp(t);let i=s.A.getInstance().getGameManager(),o=new Phaser.GameObjects.Container(i,0,0),c=new Phaser.GameObjects.Image(i,Q.rect.x[t],Q.rect.y[n],P.A.popUpFrame.key).setScale(Q.rect.scale[n]),g=this.getAssetKey(e);if(!g)return;let h=new Phaser.GameObjects.Image(i,Q.rect.x[t]+Q.image.xOffset,Q.rect.y[n]+Q.image.yOffset,g),l=Q.rect.width*Q.rect.scale[n],u=Q.rect.height*Q.rect.scale[n];(0,p.Dz)(h,l,u),o.add([c,h]),this.currPopUp.set(t,o),s.A.getInstance().addToLayer(4,o),s.A.getInstance().playSound(k.A.popUpEnter.key),o.setActive(!0),o.setVisible(!0),o.setScale(1,0),i.tweens.add(((e,t=500)=>({scaleY:1,targets:e,duration:t,ease:"Power1"}))([o],Q.tweenDuration)),await (0,r.yy)(Q.tweenDuration),setTimeout(()=>this.destroyPopUp(t),a)}destroyAllPopUps(){this.currPopUp.forEach((e,t,a)=>{this.destroyPopUp(t)})}async destroyPopUp(e){let t=this.currPopUp.get(e);t&&(s.A.getInstance().getGameManager().tweens.add(((e,t=500)=>({scaleY:0,targets:e,duration:t,ease:"Power1"}))([t],Q.tweenDuration)),await (0,r.yy)(Q.tweenDuration),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e),s.A.getInstance().playSound(k.A.popUpExit.key))}getAssetKey(e){let t=s.A.getInstance().getGameMap().getObjectPropMap().get(e);if(t)return t.assetKey}};var H=a(53407),W=a(86914),q=a(28664),J=a(72407);let Z=["Yes","No"],ee={x:15,y:-15,oriX:.5,oriY:.5},et={x:320,y:745,oriX:.5,oriY:.5},ea={fontFamily:"Verdana",fontSize:"20px",fill:J.Q1.offWhite,align:"left",lineSpacing:10,wordWrap:{width:410}},es={fontFamily:"Verdana",fontSize:"30px",fill:J.Q1.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:d.es.x-240}},en={key:D.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ei={key:D.A.zektonFont.key,size:36,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class er{currentSpeakerId;speakerSprite;speakerSpriteBox;changeSpeakerTo(e){void 0!==e&&(this.currentSpeakerId&&s.A.getInstance().clearSeveralLayers([15,14]),this.showNewSpeaker(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){if("narrator"===e)return;let t="you"===e?this.createSpeakerBox(this.getUsername(),"Right"):this.createSpeakerBox(s.A.getInstance().getCharacterById(e).name,"Left");s.A.getInstance().addToLayer(14,t)}drawSpeakerSprite({speakerId:e,speakerPosition:t,expression:a}){if(this.currentSpeakerId=e,"you"===e||"narrator"===e)return;let n=s.A.getInstance().createCharacterSprite(e,a,t);this.speakerSprite=n,s.A.getInstance().addToLayer(15,n)}createSpeakerBox(e,t){let a=s.A.getInstance().getGameManager(),n=new Phaser.GameObjects.Container(a,0,0),i=new Phaser.GameObjects.Image(a,d.MF.x,d.MF.y,P.A.speakerBox.key).setAlpha(.8),r=(0,T.P)(a,"",et,ei);return"Right"===t&&(i.displayWidth*=-1,r.x=d.es.x-r.x),n.add([i,r]),r.text=v.A.capitalize(e),this.speakerSpriteBox=n,n}async hide(){this.getSpeakerSprite().setVisible(!1),this.getSpeakerSpriteBox().setVisible(!1)}async show(){this.getSpeakerSprite().setVisible(!0),this.getSpeakerSpriteBox().setVisible(!0)}getUsername=()=>i.Ay.getInstance().getAccountInfo().name;getSpeakerSprite=()=>this.speakerSprite;getSpeakerSpriteBox=()=>this.speakerSpriteBox}class eo{dialogue;dialogueRenderer;dialogueGenerator;speakerRenderer;constructor(e){this.dialogue=e}async showReaction(){this.dialogueRenderer=new x.A(es),this.dialogueGenerator=new C(this.dialogue),this.speakerRenderer=new er,s.A.getInstance().addToLayer(5,this.dialogueRenderer.getDialogueContainer()),s.A.getInstance().fadeInLayer(5),await new Promise(e=>this.playWholeDialogue(e)),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null)}async playWholeDialogue(e){await this.showNextLine(e),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,async()=>{await this.showNextLine(e)})}async showNextLine(e){s.A.getInstance().playSound(k.A.dialogueAdvance.key);let{line:t,speakerDetail:a,actionIds:n,prompt:i}=await this.getDialogueGenerator().generateNextLine(),r=t.replace("{name}",this.getUsername());if(this.getDialogueRenderer().changeText(r),this.getSpeakerRenderer().changeSpeakerTo(a),s.A.getInstance().storeDialogueLine(r,a),s.A.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!1),i){let e=await (0,I.N)(s.A.getInstance().getGameManager(),i.promptTitle,i.choices.map(e=>e[0]));this.getDialogueGenerator().updateCurrPart(i.choices[e][1])}await s.A.getInstance().processGameActionsInSamePhase(n),s.A.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!0),t||e()}getDialogueGenerator=()=>this.dialogueGenerator;getDialogueRenderer=()=>this.dialogueRenderer;getSpeakerRenderer=()=>this.speakerRenderer;getUsername=()=>i.Ay.getInstance().getAccountInfo().name}class ec{reactionManager;async showQuiz(e){let t=s.A.getInstance().getQuizById(e),a=t.questions.length;if(0===a)return;if(!await this.showStartPrompt(s.A.getInstance().getGameManager()))return void await s.A.getInstance().showNextLine(()=>{});await s.A.getInstance().getGameManager().getDialogueManager().hideAll();let n=0;for(let e=0;e<a;e++)n+=await this.showQuizQuestion(s.A.getInstance().getGameManager(),t.questions[e]);s.A.getInstance().setQuizScore(e,n),await s.A.getInstance().showNextLine(()=>{}),await s.A.getInstance().getGameManager().getDialogueManager().showAll()}async showStartPrompt(e){return 0===await (0,I.N)(e,"Start the quiz?",Z)}async showQuizQuestion(e,t){let a=t.options,n=new Phaser.GameObjects.Container(e,0,0),o=t.prompt??"What is the correct answer?",c=Math.ceil(a.length/5),g=a.length,h=(0,H.O)(e),l=(0,H.v)(e,es),p=t.question.replace("{name}",this.getUsername());l.changeLine(p),s.A.getInstance().storeDialogueLine(p,t.speaker);let u=new Phaser.GameObjects.Text(e,d.es.x-20,100,o,ea).setOrigin(1,0),y=new Phaser.GameObjects.Rectangle(e,d.es.x,80,450*c,.5*u.getBounds().bottom+20,J.Xj.darkBlue,.8).setOrigin(1,0),m=new Phaser.GameObjects.Rectangle(e,d.es.x,80,450*c,.5*y.getBounds().bottom+(g+.5)*100,J.Xj.lightBlue,.2).setOrigin(1,0);n.add([m,y,u,h,l.container]);let M=(0,J.XA)({numOfItems:a.length,xSpacing:0,ySpacing:100});s.A.getInstance().addToLayer(5,n);let A=new Promise(s=>{n.add(a.map((a,i)=>(0,q.T)(e,{assetKey:P.A.mediumButton.key,message:a.text,textConfig:ee,bitMapTextStyle:en,onUp:async()=>{n.destroy();let e=+(i===t.answer);a.reaction&&await this.showReaction(a.reaction),s(e)}}).setPosition(d.es.x-225-450*(c-Math.floor(i/5)-1),M[i][1]%500+y.getBounds().bottom+75)))}),w=await A;return n.setPosition(d.es.x,0),i.Ay.getInstance().getSoundManager().playSound(k.A.notifEnter.key),e.add.tween({targets:n,alpha:1,...W.Bs}),await (0,r.yy)(W.Bs.duration),i.Ay.getInstance().getSoundManager().playSound(k.A.notifExit.key),e.add.tween({targets:n,alpha:1,...W.rX}),(0,B.E_)(e,n,{fadeDuration:d.YM.fadeDuration}),w}async showReaction(e){this.reactionManager=new eo(e),await this.reactionManager.showReaction()}getNumOfQns(e){return s.A.getInstance().getQuizById(e).questions.length}getUsername=()=>i.Ay.getInstance().getAccountInfo().name}var eg=a(40738);let eh=class{subscribers;gameMap;checkpointObjective;checkpointTask;chapterNewlyCompleted;quizScores;updatedLocations;triggeredInteractions;triggeredStateChangeActions;constructor(e){this.subscribers=new Map,this.gameMap=e.map,this.checkpointObjective=e.objectives,this.checkpointTask=e.tasks,this.chapterNewlyCompleted=!1,this.quizScores=new Map,this.updatedLocations=new Set(this.gameMap.getLocationIds()),this.triggeredInteractions=new Map,this.triggeredStateChangeActions=[],this.loadStatesFromSaveManager()}loadStatesFromSaveManager(){this.triggeredStateChangeActions=this.getSaveManager().getTriggeredStateChangeActions(),this.getSaveManager().getTriggeredInteractions().forEach(e=>this.triggerInteraction(e)),this.getSaveManager().getCompletedObjectives().forEach(e=>this.checkpointObjective.setObjective(e,!0)),this.getSaveManager().getCompletedTasks().forEach(e=>{this.checkpointTask.setTask(e,!0),this.checkpointTask.showTask(e)}),this.getSaveManager().getIncompleteTasks().forEach(e=>{this.checkpointTask.setTask(e,!1),this.checkpointTask.showTask(e)}),this.quizScores=new Map(this.getSaveManager().getQuizScores()),this.chapterNewlyCompleted=this.getSaveManager().getChapterNewlyCompleted()}watchGameItemType(e,t){this.subscribers.set(e,t)}getSubscriberForItemType(e){return this.subscribers.get(e)}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}triggerStateChangeAction(e){this.triggeredStateChangeActions.push(e)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}addLocationNotif(e){this.updatedLocations.add(e)}removeLocationNotif(e){this.updatedLocations.delete(e)}hasLocationNotif(e){return this.updatedLocations.has(e)}isCurrentLocation(e){return e===s.A.getInstance().getCurrLocId()}getLocationModes(e){return Array.from(this.gameMap.getLocationAtId(e).modes)||[]}addLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.add(t),this.isCurrentLocation(e)||this.addLocationNotif(e)}removeLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.delete(t),this.isCurrentLocation(e)||this.addLocationNotif(e)}getGameItemsInLocation(e,t){let a=this.gameMap.getLocationAtId(t)[e];return void 0==a?[]:Array.from(a)}addItem(e,t,a){let s=this.gameMap.getLocationAtId(t)[e];s?.add(a),this.isCurrentLocation(t)?this.getSubscriberForItemType(e)?.handleAdd(a):this.addLocationNotif(t)}removeItem(e,t,a){let s=this.gameMap.getLocationAtId(t)[e];s?.delete(a),this.isCurrentLocation(t)?this.getSubscriberForItemType(e)?.handleDelete(a):this.addLocationNotif(t)}setObjProperty(e,t){this.gameMap.setItemInMap("objects",e,t),this.gameMap.getLocations().forEach((t,a)=>{t.objects.has(e)&&(this.isCurrentLocation(a)?this.getSubscriberForItemType("objects")?.handleMutate(e):this.addLocationNotif(a))})}setBBoxProperty(e,t){this.gameMap.setItemInMap("boundingBoxes",e,t),this.gameMap.getLocations().forEach((t,a)=>{t.boundingBoxes.has(e)&&(this.isCurrentLocation(a)?this.getSubscriberForItemType("boundingBoxes")?.handleMutate(e):this.addLocationNotif(a))})}moveCharacter(e,t,a){this.getCharacterAtId(e).defaultPosition=a,this.gameMap.getLocations().forEach((t,a)=>{t.characters.has(e)&&this.removeItem("characters",a,e)}),this.addItem("characters",t,e)}updateCharacter(e,t){this.getCharacterAtId(e).defaultExpression=t,this.gameMap.getLocations().forEach((t,a)=>{t.characters.has(e)&&(this.isCurrentLocation(a)?this.getSubscriberForItemType("characters")?.handleMutate(e):this.addLocationNotif(a))})}areAllObjectivesComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){return this.checkpointObjective.getObjectiveState(e)}areObjectivesComplete(e){let t=!0;return e.forEach(e=>t=t&&this.isObjectiveComplete(e)),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}isTaskComplete(e){return this.checkpointTask.getTaskState(e)}areTasksComplete(e){let t=!0;return e.forEach(e=>t=t&&this.isTaskComplete(e)),t}completeTask(e){this.checkpointTask.setTask(e,!0)}showTask(e){this.checkpointTask.showTask(e)}getAllVisibleTaskData(){return this.checkpointTask.getAllVisibleTaskData()}isQuizComplete(e){return this.quizScores.get(e)===s.A.getInstance().getQuizLength(e)}isQuizAttempted(e){return this.quizScores.has(e)}getQuizScore(e){return this.quizScores.get(e)??0}setQuizScore(e,t){this.quizScores.set(e,t)}getCompletedObjectives(){return(0,eg.Q9)(this.checkpointObjective.getObjectives())}getCompletedTasks(){return(0,eg.Q9)(this.checkpointTask.getAllTasks())}getIncompleteTasks(){return this.checkpointTask.getAllIncompleteTasks()}getTriggeredInteractions(){return(0,eg.Q9)(this.triggeredInteractions)}getTriggeredStateChangeActions(){return this.triggeredStateChangeActions}getQuizScores(){return[...this.quizScores]}getGameMap=()=>this.gameMap;getCharacterAtId=e=>(0,r.y)(this.gameMap.getCharacterMap().get(e));getSaveManager=()=>i.Ay.getInstance().getSaveManager();getChapterNewlyCompleted=()=>this.chapterNewlyCompleted},el={key:D.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},ed=.251*d.es.x,ep={taskTextConfig:{x:-.42*d.es.x,y:-.378*d.es.y,oriX:0,oriY:0},textMaxWidth:.66*d.es.x,checkMark:{x:-.202*d.es.x,y:-.369*d.es.y,imageUrl:P.A.talkOptCheck.key},logHeight:.7632*d.es.y,scrollbarTrack:{x:ed,y:.005*d.es.y,width:7,height:.73*d.es.y,color:5592405},scrollbarThumb:{x:ed,width:7,color:8947848},scrollSpeed:.5},eu=class{scene;constructor(e){this.scene=e}createUIContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0),t=s.A.getInstance().getAllVisibleTaskData(),a=new Phaser.GameObjects.Container(this.scene,0,0),n=0;if(0===t.length){let e=(0,T.P)(this.scene,"No tasks available.",ep.taskTextConfig,el).setMaxWidth(ep.textMaxWidth);a.add(e),n=e.height}else for(let e=0;e<t.length;e++){let s=t[e][0];if(t[e][1]){let e=new Phaser.GameObjects.Image(this.scene,ep.checkMark.x,ep.checkMark.y+n,ep.checkMark.imageUrl);a.add(e)}let i=(0,T.P)(this.scene,s.title,{...ep.taskTextConfig,y:ep.taskTextConfig.y+n},el).setMaxWidth(ep.textMaxWidth),r=(0,T.P)(this.scene,"_",{...ep.taskTextConfig,y:ep.taskTextConfig.y+n},el);r.setScale(i.width/r.width,1),a.add(i),a.add(r),n+=i.height;let o=(0,T.P)(this.scene,s.description+(e<t.length-1?"\n ":""),{...ep.taskTextConfig,y:ep.taskTextConfig.y+n},el).setMaxWidth(ep.textMaxWidth);a.add(o),n+=o.height}let i=-Math.max(n-ep.logHeight,0);a.y=i,e.add(a);let o=new Phaser.GameObjects.Rectangle(this.scene,ep.scrollbarTrack.x,ep.scrollbarTrack.y,ep.scrollbarTrack.width,ep.scrollbarTrack.height,ep.scrollbarTrack.color),c=Math.max(ep.logHeight/n*ep.scrollbarTrack.height,4*ep.scrollbarThumb.width),g=ep.scrollbarTrack.y+ep.scrollbarTrack.height/2-c/2,h=-((ep.scrollbarTrack.height-c)/i),l=new Phaser.GameObjects.Rectangle(this.scene,ep.scrollbarThumb.x,g,ep.scrollbarThumb.width,c,ep.scrollbarThumb.color);e.add(o),e.add(l),n<=ep.logHeight&&(o.setVisible(!1),l.setVisible(!1));let{x:d,y:p,width:u,height:y}=N.A.pageArea,m=new Phaser.GameObjects.Zone(this.scene,d+u/2,p+y/2,u,y);return m.setInteractive(),m.on("wheel",(e,t,s,n)=>{a.y=(0,r.NS)(a.y-s*ep.scrollSpeed,i,0),l.y=g-(a.y-i)*h}),e.add(m),e}};var ey=a(99562),em=a(45798);let eM={normal:`url(${(0,r.T5)("/ui/magnifying.png",!1)}), pointer`,hover:`url(${(0,r.T5)("/ui/magnifying_trigg.png",!1)}), pointer`,checked:`url(${(0,r.T5)("/ui/magnifying_check.png",!1)}), pointer`},eA=class{uiContainer;createUIContainer(){let e=s.A.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new em.A(e,async()=>await s.A.getInstance().swapPhase("Menu"));return t.add(a),t}async activateUI(){let e=s.A.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),s.A.getInstance().addToLayer(7,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-d.es.y),this.enableInteractions(),e.tweens.add({targets:this.uiContainer,...W._K}),s.A.getInstance().setDefaultCursor(eM.normal),s.A.getInstance().playSound(k.A.modeEnter.key)}async deactivateUI(){let e=s.A.getInstance().getGameManager();s.A.getInstance().setDefaultCursor(d.YM.defaultCursor),this.disableInteractions(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...W.oS}),await (0,r.yy)(500),(0,B.E_)(e,this.uiContainer))}enableInteractions(){s.A.getInstance().getAllActivatables().forEach(e=>{e.actionIds&&e.actionIds.length&&(e.clickArea.on("pointerout",()=>this.explorePointerOut(e.interactionId)),e.clickArea.on("pointerover",()=>this.explorePointerOver(e.interactionId)),e.clickArea.on("pointerup",async()=>{this.explorePointerUp(e.interactionId),await s.A.getInstance().processGameActions(e.actionIds)}))})}disableInteractions(){s.A.getInstance().getAllActivatables().forEach(e=>{e.clickArea.off("pointerout"),e.clickArea.off("pointerover"),e.clickArea.off("pointerup")})}explorePointerOver(e){let t=s.A.getInstance().hasTriggeredInteraction(e);s.A.getInstance().objectHoverGlow(e,!0),t?s.A.getInstance().setDefaultCursor(eM.checked):s.A.getInstance().setDefaultCursor(eM.hover)}explorePointerOut(e){s.A.getInstance().setDefaultCursor(eM.normal),s.A.getInstance().objectHoverGlow(e,!1)}explorePointerUp(e){s.A.getInstance().setDefaultCursor(d.YM.defaultCursor),s.A.getInstance().objectHoverGlow(e,!1),s.A.getInstance().triggerInteraction(e),s.A.getInstance().setDefaultCursor(eM.normal)}},ew={key:D.A.zektonFont.key,size:45,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ek={button:{yOffset:.3*d.es.y},entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*d.es.y,duration:300,ease:"Power2"}},eI=class{uiContainer;getLatestLocationModes(){let e=s.A.getInstance().getCurrLocId(),t=s.A.getInstance().getLocationModes(e);return 0===s.A.getInstance().getGameItemsInLocation("talkTopics",e).length&&(t=t.filter(e=>"Talk"!==e)),t}createUIContainer(){let e=s.A.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Image(e,d.MF.x,d.MF.y,P.A.modeMenuBanner.key);t.add(a);let n=this.getLatestLocationModes(),i=this.getModeButtons(n),r=(0,J.lj)({numOfItems:i.length}),o=i.map((e,t)=>this.createLine(r[t][0],r[t][1]+ek.button.yOffset+20,e));return t.add(i.map((e,t)=>this.createModeButton(e.text,r[t][0],r[t][1]+ek.button.yOffset,e.callback))),t.add(o),t}createLine(e,t,a){let n=s.A.getInstance().getGameManager();"Explore"===a.text?e+=-68:"Move"===a.text?e+=20:e+=-30;let i=n.add.line(0,15,e,t,e+20,t,0xbce7da);return i.setLineWidth(4),i}getModeButtons(e){return e.sort().map(e=>({text:e,callback:async()=>await s.A.getInstance().swapPhase(K.g[e])}))}createModeButton(e,t,a,n){let i=s.A.getInstance().getGameManager();return(0,q.T)(i,{assetKey:P.A.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:ew,onUp:n}).setPosition(t,a)}async activateUI(){let e=s.A.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),s.A.getInstance().addToLayer(7,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,d.es.y),e.tweens.add({targets:this.uiContainer,...ek.entryTweenProps}),await (0,r.yy)(500),s.A.getInstance().playSound(k.A.modeEnter.key)}async deactivateUI(){let e=s.A.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...ek.exitTweenProps}),await (0,r.yy)(500),(0,B.E_)(e,this.uiContainer))}},eb={key:D.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},eS={button:{xOffSet:.25*d.es.x,ySpace:.8*d.es.y},preview:{rect:{x:.3125*d.es.x,y:.515*d.es.y,width:.473*d.es.x,height:.56*d.es.y},frame:{x:.3*d.es.x}}},ef=class{uiContainer;setPreview(e,t){e.setTexture(t).setDisplaySize(eS.preview.rect.width,eS.preview.rect.height).setPosition(eS.preview.rect.x,eS.preview.rect.y)}getLatestNavigations(){return s.A.getInstance().getGameItemsInLocation("navigation",s.A.getInstance().getCurrLocId())}createUIContainer(){let e=s.A.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Sprite(e,eS.preview.frame.x,d.MF.y,P.A.locationPreviewFrame.key),n=new Phaser.GameObjects.Sprite(e,d.MF.x,d.MF.y,P.A.locationPreviewFill.key);t.add([a,n]);let i=this.getLatestNavigations(),r=this.getMoveButtons(i,n),o=(0,J.lj)({numOfItems:r.length,numItemLimit:1,maxYSpace:eS.button.ySpace});t.add(r.map((e,t)=>this.createMoveButton((0,q.y)(t+1,e.text),o[t][0]+eS.button.xOffSet,o[t][1],e.callback,e.onHover,e.onOut)));let c=new em.A(e,async()=>await s.A.getInstance().swapPhase("Menu"));return t.add(c),this.setPreview(n,P.A.defaultLocationImg.key),t}getMoveButtons(e,t){let a=e=>this.setPreview(t,e),n=()=>this.setPreview(t,P.A.defaultLocationImg.key);return e.map(e=>{let t=s.A.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await s.A.getInstance().swapPhase("Sequence"),await s.A.getInstance().changeLocationTo(e)},onHover:()=>a(t.previewKey||t.assetKey),onOut:()=>n()}})}createMoveButton(e,t,a,n,i,r){let o=s.A.getInstance().getGameManager();return(0,q.T)(o,{assetKey:P.A.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:eb,onUp:n,onHover:i,onOut:r}).setPosition(t,a)}registerKeyboardListener(){let e=s.A.getInstance().getGameManager().getInputManager();this.getLatestNavigations().forEach((t,a)=>{e.registerKeyboardListener(b.L.Options[a],"up",async()=>{await s.A.getInstance().swapPhase("Sequence"),await s.A.getInstance().changeLocationTo(t)})})}async activateUI(){let e=s.A.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),s.A.getInstance().addToLayer(7,this.uiContainer),this.registerKeyboardListener(),this.uiContainer.setPosition(this.uiContainer.x,-d.es.y),e.tweens.add({targets:this.uiContainer,...W._K}),s.A.getInstance().playSound(k.A.modeEnter.key)}removeKeyboardListener(){s.A.getInstance().getGameManager().getInputManager().clearKeyboardListeners(b.L.Options)}async deactivateUI(){let e=s.A.getInstance().getGameManager();this.removeKeyboardListener(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...W.oS}),await (0,r.yy)(500),(0,B.E_)(e,this.uiContainer))}};var eC=a(52241);let ex={key:D.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},eP={button:{ySpace:.7*d.es.y}},ev=class{uiContainer;getLatestTalkTopics(){return s.A.getInstance().getGameItemsInLocation("talkTopics",s.A.getInstance().getCurrLocId())}createUIContainer(){let e=s.A.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=this.getLatestTalkTopics(),n=this.getTalkTopicButtons(a),i=(0,J.lj)({direction:"Column",numOfItems:n.length,maxYSpace:eP.button.ySpace});t.add(n.map((e,t)=>this.createTalkTopicButton((0,q.y)(t+1,e.text),i[t][0],i[t][1],e.callback))),n.forEach((a,n)=>{let r=new Phaser.GameObjects.Sprite(e,i[n][0],i[n][1],P.A.talkOptCheck.key);a.interactionId&&s.A.getInstance().hasTriggeredInteraction(a.interactionId)&&t.add(r)});let r=new em.A(e,async()=>await s.A.getInstance().swapPhase("Menu"));return t.add(r),t}getTalkTopicButtons(e){return e.map(e=>({text:(0,r.y)(s.A.getInstance().getDialogueById(e)).title,callback:async()=>{s.A.getInstance().triggerInteraction(e),await s.A.getInstance().showDialogue(e)},interactionId:e}))}createTalkTopicButton(e,t,a,n){let i=s.A.getInstance().getGameManager();return(0,q.T)(i,{assetKey:P.A.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:ex,onUp:n}).setPosition(t,a)}registerKeyboardListener(){let e=this.getLatestTalkTopics(),t=s.A.getInstance().getGameManager().getInputManager();e.forEach((e,a)=>{t.registerKeyboardListener(b.L.Options[a],"up",async()=>{s.A.getInstance().triggerInteraction(e),await s.A.getInstance().showDialogue(e)})})}async activateUI(){let e=s.A.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),s.A.getInstance().addToLayer(7,this.uiContainer),this.registerKeyboardListener(),this.uiContainer.setPosition(this.uiContainer.x,-d.es.y),e.tweens.add({targets:this.uiContainer,...W._K}),s.A.getInstance().playSound(k.A.modeEnter.key)}removeKeyboardListener(){s.A.getInstance().getGameManager().getInputManager().clearKeyboardListeners(b.L.Options)}async deactivateUI(){let e=s.A.getInstance().getGameManager();this.removeKeyboardListener(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...W.oS}),await (0,r.yy)(500),(0,B.E_)(e,this.uiContainer))}};class eT extends Phaser.Scene{currentLocationId;hasTransitioned;stateManager;layerManager;objectManager;characterManager;dialogueManager;actionManager;boundingBoxManager;popUpManager;phaseManager;backgroundManager;animationManager;inputManager;escapeManager;collectibleManager;achievementManager;logManager;dialogueStorageManager;toolbarManager;taskLogManager;dashboardManager;quizManager;actionJustSaved=!1;constructor(){super("GameManager"),this.currentLocationId=d.YM.nullInteractionId,this.hasTransitioned=!1}init({gameCheckpoint:e,continueGame:t,chapterNum:a,checkpointNum:n}){s.A.getInstance().setGameManager(this),i.Ay.getInstance().setCurrentSceneRef(this),this.getSaveManager().registerGameInfo(a,n,t),this.currentLocationId=this.getSaveManager().getLoadedLocation()||e.startingLoc,this.hasTransitioned=!1,this.stateManager=new eh(e),this.layerManager=new R.A(this),this.inputManager=new S.A(this),this.phaseManager=new Y.A(new Map([["Menu",new eI],["Move",new ef],["Explore",new eA],["Talk",new ev],["Sequence",new eC.A],["None",new eC.A]]),this.inputManager),this.characterManager=new M,this.objectManager=new X,this.dialogueManager=new G,this.actionManager=new c,this.boundingBoxManager=new y,this.backgroundManager=new u,this.animationManager=new h,this.popUpManager=new $,this.escapeManager=new j.A(this),this.collectibleManager=new l.A(this,i.Ay.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new l.A(this,i.Ay.getInstance().getUserStateManager().getAchievements),this.logManager=new _(this),this.dialogueStorageManager=new O,this.toolbarManager=new ey.A(this),this.taskLogManager=new eu(this),this.dashboardManager=new A.A(this,[w.G.Log,w.G.Tasks,w.G.Collectibles,w.G.Achievements],[this.logManager,this.taskLogManager,this.collectibleManager,this.achievementManager]),this.quizManager=new ec}preload(){(0,E.K)(this),this.getPhaseManager().setInterruptCheckCallback((e,t)=>this.transitionChecker(e,t)),this.getPhaseManager().setInterruptCallback(async(e,t)=>await this.checkpointTransition()),this.getPhaseManager().setCallback(async(e,t)=>await this.handleCharacterLayer(e,t)),this.preloadLocationsAssets(),this.bindKeyboardTriggers()}preloadLocationsAssets(){let e=this.getStateManager().getGameMap();s.A.getInstance().loadSounds(e.getSoundAssets()),e.getMapAssets().forEach((e,t)=>{this.loadImage(e,t)})}loadImage(e,t){switch(e.type){case g.P.Image:this.load.image(t,(0,r.T5)(e.path,!0));break;case g.P.Sprite:this.load.spritesheet(t,(0,r.T5)(e.path,!0),e.config)}}notifyActionJustSaved(){this.actionJustSaved=!0}async create(){s.A.getInstance().hideLayer(2),await this.changeLocationTo(this.currentLocationId,!0)}async renderLocation(e,t){let a=s.A.getInstance().getLocationAtId(e);this.getToolbarManager().renderToolbarContainer(),await s.A.getInstance().playBgMusic(a.bgmKey),this.getBackgroundManager().renderBackgroundLayerContainer(e),this.getObjectManager().renderObjectsLayerContainer(e),this.getBBoxManager().renderBBoxLayerContainer(e),this.getCharacterManager().renderCharacterLayerContainer(e),await this.getPhaseManager().swapPhase("Sequence"),t&&(await this.getActionManager().fastForwardGameActions(this.getStateManager().getTriggeredStateChangeActions()),await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getGameStartActions())),await this.getActionManager().processGameActions(a.actionIds),this.getStateManager().hasLocationNotif(e)&&(await s.A.getInstance().bringUpUpdateNotif(a.name),this.getStateManager().removeLocationNotif(e)),this.getPhaseManager().isCurrentPhase("Sequence")&&await this.getPhaseManager().swapPhase("Menu")}async changeLocationTo(e,t=!1){this.currentLocationId=e,this.actionJustSaved=!1,await (0,B.co)(this,300,500,async()=>{await this.getLayerManager().clearAllLayers(),await this.renderLocation(e,t)}),this.getStateManager().triggerInteraction(e),this.actionJustSaved||await s.A.getInstance().saveGame()}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(b.L.Menu,"up",async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase("EscapeMenu")}),this.getInputManager().registerKeyboardListener(b.L.Dashboard,"up",async()=>{this.getPhaseManager().isCurrentPhase("Dashboard")?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase("Dashboard"):await this.getPhaseManager().pushPhase("Dashboard")}),this.registerMenuKeyboardListener(b.L.Explore,"Explore","Explore"),this.registerMenuKeyboardListener(b.L.Move,"Move","Move"),this.registerMenuKeyboardListener(b.L.Talk,"Talk","Talk")}registerMenuKeyboardListener(e,t,a){this.getInputManager().registerKeyboardListener(e,"up",async()=>{this.getCurrentLocationModes().includes(t)&&this.getPhaseManager().isCurrentPhase("Menu")?await this.getPhaseManager().pushPhase(a):this.getPhaseManager().isCurrentPhase(a)&&await this.getPhaseManager().swapPhase("Menu")})}getCurrentLocationModes(){let e=this.currentLocationId,t=this.getStateManager().getLocationModes(e);return 0===s.A.getInstance().getGameItemsInLocation("talkTopics",e).length&&(t=t.filter(e=>"Talk"!==e)),t}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers(),this.getDialogueStorageManager().clearDialogueStorage()}transitionChecker(e,t){return!this.hasTransitioned&&"Sequence"!==t&&s.A.getInstance().areAllObjectivesComplete()&&!this.getStateManager().getChapterNewlyCompleted()}async checkpointTransition(){this.hasTransitioned=!0,await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getCheckpointCompleteActions()),this.getInputManager().setDefaultCursor(d.YM.defaultCursor),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0),this.tweens.add((0,B.qG)([(0,B.gN)(this).setAlpha(0)],d.YM.fadeDuration)),await (0,r.yy)(d.YM.fadeDuration),this.cleanUp(),this.scene.start("CheckpointTransition")}async handleCharacterLayer(e,t){"Menu"===e&&s.A.getInstance().fadeOutLayer(2),"Menu"===t&&s.A.getInstance().fadeInLayer(2)}getSaveManager=()=>i.Ay.getInstance().getSaveManager();getStateManager=()=>(0,r.y)(this.stateManager);getObjectManager=()=>(0,r.y)(this.objectManager);getDialogueManager=()=>(0,r.y)(this.dialogueManager);getCharacterManager=()=>(0,r.y)(this.characterManager);getBBoxManager=()=>(0,r.y)(this.boundingBoxManager);getActionManager=()=>(0,r.y)(this.actionManager);getInputManager=()=>(0,r.y)(this.inputManager);getLayerManager=()=>(0,r.y)(this.layerManager);getPhaseManager=()=>(0,r.y)(this.phaseManager);getBackgroundManager=()=>(0,r.y)(this.backgroundManager);getAnimationManager=()=>(0,r.y)(this.animationManager);getPopupManager=()=>(0,r.y)(this.popUpManager);getEscapeManager=()=>(0,r.y)(this.escapeManager);getCollectibleManager=()=>(0,r.y)(this.collectibleManager);getAchievementManager=()=>(0,r.y)(this.achievementManager);getLogManager=()=>(0,r.y)(this.logManager);getDialogueStorageManager=()=>(0,r.y)(this.dialogueStorageManager);getToolbarManager=()=>(0,r.y)(this.toolbarManager);getTaskLogManager=()=>(0,r.y)(this.taskLogManager);getDashboardManager=()=>(0,r.y)(this.dashboardManager);getQuizManager=()=>(0,r.y)(this.quizManager)}let eL=eT},94321(e,t,a){a.d(t,{Ay:()=>c,I:()=>o,Xg:()=>r,q6:()=>i});var s=a(1185),n=a(96912);let i={key:s.A.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},r={key:s.A.zektonFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},o={key:s.A.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},c={optHeaderTextConfig:{x:.25*n.es.x,y:0,oriX:.5,oriY:.75},opt:{x:140,xSpace:.4*n.es.x,ySpace:.7*n.es.y},radioButtonsTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},volContainerOpts:["0","0.25","0.5","1.0","1.5","2.0"]}},99562(e,t,a){a.d(t,{A:()=>c});var s=a(28664),n=a(84977),i=a(96912);let r=[{assetKey:n.A.gear.key,onUp:e=>async()=>{let t=e.getPhaseManager();t.isCurrentPhase("EscapeMenu")?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase("EscapeMenu"):await t.pushPhase("EscapeMenu")}},{assetKey:n.A.journal.key,onUp:e=>async()=>{let t=e.getPhaseManager();t.isCurrentPhase("Dashboard")?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase("Dashboard"):await t.pushPhase("Dashboard")}}],o={firstButton:{x:i.es.x-37,y:37},xOffset:64,buttonConfigs:r},c=class{uiContainer;scene;constructor(e){this.scene=e}createUIContainer(){let e=new Phaser.GameObjects.Container(this.scene,0,0);return e.add(o.buttonConfigs.map((e,t)=>this.createToolbarButton(o.firstButton.x-o.xOffset*t,o.firstButton.y,e))),e}createToolbarButton(e,t,a){return(0,s.T)(this.scene,{assetKey:a.assetKey,onUp:a.onUp(this.scene)}).setPosition(e,t)}async renderToolbarContainer(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(7,this.uiContainer)}}},28664(e,t,a){a.d(t,{T:()=>c,y:()=>o});var s=a(89751),n=a(96912),i=a(22937),r=a(7329);function o(e,t){return"[ "+e+" ]  "+t}function c(e,{assetKey:t,message:a="",textConfig:o={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:c=n.YM.defaultFontStyle,onDown:g=n.YM.nullFunction,onUp:h=n.YM.nullFunction,onHover:l=n.YM.nullFunction,onOut:d=n.YM.nullFunction,onPointerMove:p=n.YM.nullFunction,onHoverEffect:u=!0,onClickSound:y=s.A.buttonClick.key,onHoverSound:m=s.A.buttonHover.key}){let M=new Phaser.GameObjects.Container(e,0,0),A=new Phaser.GameObjects.Sprite(e,0,0,t);A.setInteractive({pixelPerfect:!0,useHandCursor:!0}),A.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{i.Ay.getInstance().getSoundManager().playSound(y),h()}),A.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>{i.Ay.getInstance().getSoundManager().playSound(m),u&&M.setAlpha(1),l()}),A.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{u&&M.setAlpha(.9),d()}),A.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{g()}),A.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e,t,a)=>{p(e,t,a)});let w=(0,r.P)(e,a,o,c);return M.add([A,w]),u&&M.setAlpha(.9),M}},54166(e,t,a){a.d(t,{$3:()=>h,LG:()=>r,NS:()=>o,T5:()=>c,y:()=>g,yy:()=>i});var s=a(21681),n=a(96912);function i(e){return new Promise(t=>setTimeout(t,e))}function r(e,t){let a=new Map;return e.forEach((e,s)=>{let n=t(e,s);a.set(s,n)}),a}function o(e,t,a){return Math.min(Math.max(e,t),a)}function c(e,t=!1){return e.startsWith("/")&&(e=e.substring(1)),n.YM.assetsFolder+(t&&!n.YM.useEmptyAssetPrefix?l()+e:e)}function g(e,t){if(void 0===e)throw Error(t||"Object not found");return e}let h=()=>s.M.getState().session.courseId,l=()=>s.M.getState().session.assetsPrefix||""},28949(e,t,a){a.d(t,{E4:()=>n,WO:()=>i,f_:()=>r,yt:()=>s});let s=(e,t,a)=>new Promise(s=>{"__MISSING"!==e.textures.get(t).key?s(t):(e.load.image(t,a),e.load.once(`filecomplete-image-${t}`,s),e.load.once("loaderror",s),e.load.start())}),n=(e,t,a)=>new Promise(s=>{e.cache.text.exists(t)?s(t):(e.load.text(t,a),e.load.once(`filecomplete-text-${t}`,s),e.load.start())}),i=(e,t,a)=>new Promise(s=>{null!==e.sound.get(t)?s(t):(e.load.audio(t,a).on("filecomplete",s),e.load.start())}),r=(e,t,a,s)=>new Promise(n=>{"__MISSING"!==e.textures.get(t).key?n(t):(e.load.spritesheet(t,a,s),e.load.once(`filecomplete-spritesheet-${t}`,n),e.load.once("loaderror",n),e.load.start())})},4907(e,t,a){function s(e,t,a){let s=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=a||t*s):(e.displayWidth=a/s,e.displayHeight=a)}function n(e,t,a){e.displayWidth>e.displayHeight?s(e,0,a):s(e,t)}function i(e,t,a){e.displayWidth>e.displayHeight?s(e,t):s(e,0,a)}a.d(t,{Dz:()=>i,XR:()=>s,v8:()=>n})},31691(e,t,a){a.d(t,{A:()=>n});var s=a(96912);class n{static splitToParagraph(e){let t=[];return e.forEach(e=>{if(e.startsWith("	")||e.startsWith("    ")){let a=e.startsWith("	")?e.slice(1):e.slice(4);return 0===t.length?void console.error("Unexpected tabs"):void t[t.length-1][1].push(a)}t.push([e.trim(),[]])}),t}static mapByHeader(e,t){let a=new Map;if(!t(e[0]))return a.set("0",e),a;let s="";return e.forEach(e=>{if(t(e)){s=e,a.set(e,[]);return}a.get(s).push(e)}),a}static splitWithLimit(e,t,a){if(a>=0){let s=e.split(t),n=s.slice(0,a);return n.push(s.slice(a).join(t)),n.map(e=>e.trim())}return n.splitByChar(e,t)}static splitByChar(e,t){return e.split(t).map(e=>e.trim())}static splitToLines(e){return e.split("\n").map(e=>e.trimRight()).filter(e=>""!==e)}static splitToLinesAndRemoveComments(e){return this.removeMultiLineComments(e.split("\n"),"/*","*/").map(e=>this.removeSingleLineComment(e,"//")).map(e=>e.trimRight()).filter(e=>""!==e)}static removeSingleLineComment(e,t,a=!0){let s=e.indexOf(t);return -1===s?e:a?e.slice(0,s):e.slice(s+t.length)}static removeMultiLineComments(e,t,a){let s=[],n=!1;for(let i=0;i<e.length;i++){let r=e[i],o=[],c=this.findAllInstances(r,t),g=this.findAllInstances(r,a),h=-1,l=0,d=0,p=n?[0]:[];for(;l<c.length||d<g.length;){let e=h;(h=n?g[d++]+a.length:c[l++])<=e?(console.error(`Comment mismatch: Line ${i+1},  Pos ${h+1}`),h=e):(p.push(h),n=!n),2===p.length&&(o.push([p[0],p[1]]),p=[])}1===p.length&&o.push([p[0],r.length]),s.push(this.removeCommentRegions(r,o))}return s}static removeCommentRegions(e,t){let a="",s=0;return t.forEach(t=>{a+=e.slice(s,t[0]),s=t[1]}),a+=e.slice(s,e.length)}static findAllInstances(e,t){let a=[],s=e.indexOf(t);for(;-1!==s;)a.push(s),s=e.indexOf(t,s+1);return a}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(n.capitalize).join(" ")}static toIntString(e){return Math.floor(e).toString()}static isEmptyString(e){return e===s.YM.nullInteractionId}}},72407(e,t,a){a.d(t,{OP:()=>g,Q1:()=>o,XA:()=>d,Xj:()=>c,lj:()=>h});var s,n=a(2543),i=a.n(n),r=a(96912);let o={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},c=i().mapValues(o,e=>parseInt(e.slice(1),16));var g=((s={}).Row="Row",s.Column="Column",s);function h({direction:e="Row",numOfItems:t,maxXSpace:a=r.es.x,maxYSpace:s=r.es.y,numItemLimit:n=0,redistributeLast:o=!0}){let c=n||t,g=Math.ceil(t/c);return i().times(t,n=>{let i=n%c,h=Math.floor(n/c);return o&&h===g-1&&(c=t%g||c),"Row"===e?[l(r.es.x,a,i,c),l(r.es.y,s,h,g)]:[l(r.es.x,a,h,g),l(r.es.y,s,i,c)]})}function l(e,t,a,s){let n=t/s;return(e-t+n)/2+n*a}function d({numOfItems:e,xSpacing:t=30,ySpacing:a=30}){let s=[];for(let n=0;n<e;n++)s.push([n*t,n*a]);return s}},7329(e,t,a){a.d(t,{P:()=>s});let s=(e,t,{x:a,y:s,oriX:n,oriY:i},r)=>new Phaser.GameObjects.BitmapText(e,a,s,r.key,t,r.size,r.align).setOrigin(n,i)},87293(e,t,a){a.d(t,{S:()=>c,X:()=>o});var s=a(83919),n=a(99370),i=a(22937),r=a(28949);async function o(e,t,a){let o=i.Ay.getInstance().getIsUsingMock()?s.NC:s.Ay,c=i.Ay.getInstance().getCurrentSceneRef(),g=i.Ay.getInstance().getGameChapters()[t].filenames[a];if(!g)return;await (0,r.E4)(c,g,g),await (0,r.E4)(c,o.defaultCheckpoint.key,o.defaultCheckpoint.path);let h=c.cache.text.get(g),l=c.cache.text.get(o.defaultCheckpoint.key);n.A.parse(l),n.A.parse(h,!0);let d=n.A.checkpoint;c.scene.start("GameManager",{gameCheckpoint:d,continueGame:e,chapterNum:t,checkpointNum:a})}async function c(){let e=i.Ay.getInstance().getCurrentSceneRef(),t=i.Ay.getInstance().getSSChapterSimFilenames();if(!t.length)return void e.scene.start("GameSimulatorMenu");let a=t.pop();await (0,r.E4)(e,a,(0,s.Jr)(a)),await (0,r.E4)(e,s.Ay.defaultCheckpoint.key,s.Ay.defaultCheckpoint.path);let o=e.cache.text.get(a),c=e.cache.text.get(s.Ay.defaultCheckpoint.key);n.A.parse(c),n.A.parse(o,!0);let g=n.A.checkpoint;return e.scene.start("GameManager",{gameCheckpoint:g,chapterNum:-1,checkpointNum:-1}),!0}}}]);
//# sourceMappingURL=53506.59c1c7b6.js.map
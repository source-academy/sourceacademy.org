"use strict";(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([["56159"],{72782(e,s,l){l.d(s,{A:()=>t});var a=l(74848),r=l(51851),n=l(7064),i=l(96540);let t=e=>((0,i.useEffect)(()=>{e.loadContentDispatch?.()},[]),(0,a.jsx)("div",{className:"ContentDisplay row center-xs",children:(0,a.jsx)("div",{className:`${e.fullWidth?"col-md-12":"col-md-10 col-xs-11"} contentdisplay-content-parent`,children:(0,a.jsx)(r.Z,{className:"contentdisplay-content",elevation:n.e.THREE,children:e.display})})}))},64043(e,s,l){l.r(s),l.d(s,{Component:()=>eo,default:()=>ed});var a=l(74848),r=l(35537),n=l(11903),i=l(10720),t=l(5193),o=l(79642),d=l(31365),c=l(96540),u=l(94201),h=l(12149),m=l(50988),p=l(76940),x=l(46807),f=l(72782),j=l(53991),g=l(96402),b=l(54348),C=l(28761),v=l(19551),N=l(12316),A=l(40249),y=l(9584),R=l(80346),S=l(66875),D=l(2543),U=l(48422),w=l(61499),I=l(91948);let P=[{headerName:"Name",field:"name"},{headerName:"Username",field:"username"},{headerName:"Role",field:"role"}],k={flex:1,filter:!0,resizable:!0,sortable:!0},G=e=>{let[s,l]=c.useState([]),[n,i]=c.useState(""),{CSVReader:t}=(0,U.pb)(),u=(0,a.jsx)("div",{className:"Grid",children:(0,a.jsx)(S.W6,{theme:R.N8R,domLayout:"autoHeight",columnDefs:P,defaultColDef:k,rowData:s,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})}),h=[...I.A.authProviders.entries()].map(([e,s])=>e),[m,p]=c.useState(h[0]);return(0,a.jsxs)("div",{className:"add-users",children:[(0,a.jsx)(r.H2,{children:"Add Stories Users"}),u,(0,a.jsx)(r.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,a.jsx)("div",{className:"upload-container",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"upload-settings",children:[(0,a.jsx)("div",{className:"file-input",children:(0,a.jsx)(t,{onUploadAccepted:e=>(e=>{let{data:r,errors:n}=e;if(n.length)return void i("Error detected while uploading the CSV file! Please recheck the file and try again.");let t=[...s];if(r.length+s.length>1e3)return void i("Please limit each upload to 1000 entries!");for(let e=0;e<r.length;e++){if(3!==r[e].length)return void i((0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the name, username and role is specified for each row entry!"]}),(0,a.jsx)("br",{}),(0,a.jsxs)("div",{children:["Format: ",(0,a.jsx)("i",{children:"name,username,role"})]}),(0,a.jsx)("br",{}),(0,a.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(w.gO).includes(r[e][2]))return void i(`Invalid role (line ${e})! Please ensure that the third column of each entry contains one of the following: 'member, moderator, admin'`)}(r.forEach(e=>{t.push({name:e[0],username:e[1],role:e[2]})}),(0,D.uniqBy)(t,e=>e.username).length!==t.length)?i("There are duplicate usernames in the uploaded CSV(s)!"):(l(t),i(""))})(e),config:{delimiter:",",skipEmptyLines:!0},children:({getRootProps:e,acceptedFile:s,ProgressBar:l,getRemoveFileProps:r})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("label",{className:j.FILE_INPUT,...e(),children:[(0,a.jsx)("div",{style:{minWidth:250},children:" "}),(0,a.jsx)("span",{className:j.FILE_UPLOAD_INPUT,children:"Upload CSV"})]}),(0,a.jsx)(g.A,{content:(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("u",{children:"CSV Format"}),": \xa0",(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"name,username,role"})})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"name"})}),": the name of the user"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"username"})}),": username of the user in the corresponding authentication"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"role"})}),": the role of the user ",(0,a.jsx)("i",{children:"(member | moderator | admin)"})]}),(0,a.jsx)("p",{children:"\xa0"}),(0,a.jsx)("p",{children:(0,a.jsx)("u",{children:"Examples:"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(Luminus): \xa0 Wei Kai,e1234567,member"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(Google): \xa0 Timothy,learner@gmail.com,moderator"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(GitHub): \xa0 Mingkai,ghusername,admin"})})]}),interactionKind:"hover",position:b.yX.TOP,popoverClassName:"file-input-popover",children:(0,a.jsx)(C.I,{icon:y.W.HELP,className:"file-input-icon"})})]})})}),(0,a.jsx)(v.g,{className:"html-select",label:(0,a.jsxs)("div",{className:"html-select-label",children:[(0,a.jsx)("div",{children:"Authentication Provider"}),(0,a.jsx)(g.A,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:b.yX.TOP,popoverClassName:"html-select-popover",children:(0,a.jsx)(C.I,{icon:y.W.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,a.jsx)(N.g,{options:h,value:m,onChange:e=>p(e.target.value)})})]}),n&&(0,a.jsx)(A.P,{intent:d.J.DANGER,title:"Invalid CSV file provided!",children:n})]})}),(0,a.jsx)(o.$,{className:"add-button",text:"Add Stories Users",intent:0===s.length?d.J.NONE:d.J.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(s,m),l([]),p(h[0])}})]})},O=[{headerName:"Username",field:"username"},{headerName:"Role",field:"role"},{headerName:"Group",field:"group"}],H={flex:1,filter:!0,resizable:!0,sortable:!0},E=e=>{let[s,l]=c.useState([]),[n,i]=c.useState(""),{CSVReader:t}=(0,U.pb)(),u=(0,a.jsx)("div",{className:"Grid",children:(0,a.jsx)(S.W6,{theme:R.N8R,domLayout:"autoHeight",columnDefs:O,defaultColDef:H,rowData:s,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})}),h=[...I.A.authProviders.entries()].map(([e,s])=>e),[m,p]=c.useState(h[0]);return(0,a.jsxs)("div",{className:"add-users",children:[(0,a.jsx)(r.H2,{children:"Add Users"}),u,(0,a.jsx)(r.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,a.jsx)("div",{className:"upload-container",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"upload-settings",children:[(0,a.jsx)("div",{className:"file-input",children:(0,a.jsx)(t,{onUploadAccepted:e=>(e=>{let{data:r,errors:n}=e;if(n.length)return void i("Error detected while uploading the CSV file! Please recheck the file and try again.");let t=[...s];if(r.length+s.length>1e3)return void i("Please limit each upload to 1000 entries!");for(let e=0;e<r.length;e++){if(2!==r[e].length&&3!==r[e].length)return void i((0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the username and role is specified for each row entry!"]}),(0,a.jsx)("br",{}),(0,a.jsxs)("div",{children:["Format: ",(0,a.jsx)("i",{children:"username,role"})," ",(0,a.jsx)("b",{children:"OR"})," ",(0,a.jsx)("i",{children:"username,role,group"})]}),(0,a.jsx)("br",{}),(0,a.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(w.Xh).includes(r[e][1]))return void i(`Invalid role (line ${e})! Please ensure that the second column of each entry contains one of the following: 'admin, staff, student'`)}(r.forEach(e=>{t.push({username:e[0],role:e[1],group:e[2]})}),(0,D.uniqBy)(t,e=>e.username).length!==t.length)?i("There are duplicate usernames in the uploaded CSV(s)!"):(l(t),i(""))})(e),config:{delimiter:",",skipEmptyLines:!0},children:({getRootProps:e,acceptedFile:s,ProgressBar:l,getRemoveFileProps:r})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("label",{className:j.FILE_INPUT,...e(),children:[(0,a.jsx)("div",{style:{minWidth:250},children:" "}),(0,a.jsx)("span",{className:j.FILE_UPLOAD_INPUT,children:"Upload CSV"})]}),(0,a.jsx)(g.A,{content:(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("u",{children:"CSV Format"}),": \xa0",(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"username,role"})}),"\xa0\xa0OR\xa0\xa0",(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"username,role,group"})})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"username"})}),": the username of the learner in the corresponding authentication provider"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"role"})}),": the role of the learner in this course"," ",(0,a.jsx)("i",{children:"(admin | staff | student)"})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("b",{children:(0,a.jsx)("i",{children:"group (optional)"})}),": the group name that the learner belongs to in this course"]}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(*Note that staff or admin will automatically be assigned as group leader and each group"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"can only have one leader. If there are duplicates the latest entry will take effect)"})}),(0,a.jsx)("p",{children:"\xa0"}),(0,a.jsx)("p",{children:(0,a.jsx)("u",{children:"Examples:"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(Luminus): \xa0e1234567,student \xa0•\xa0 e1234567,student,Group1"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(Google): \xa0learner@gmail.com,staff \xa0•\xa0 learner@gmail.com,staff,Group1"})}),(0,a.jsx)("p",{children:(0,a.jsx)("i",{children:"(GitHub): \xa0ghusername,admin \xa0•\xa0 ghusername,admin,Group1"})})]}),interactionKind:"hover",position:b.yX.TOP,popoverClassName:"file-input-popover",children:(0,a.jsx)(C.I,{icon:y.W.HELP,className:"file-input-icon"})})]})})}),(0,a.jsx)(v.g,{className:"html-select",label:(0,a.jsxs)("div",{className:"html-select-label",children:[(0,a.jsx)("div",{children:"Authentication Provider"}),(0,a.jsx)(g.A,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:b.yX.TOP,popoverClassName:"html-select-popover",children:(0,a.jsx)(C.I,{icon:y.W.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,a.jsx)(N.g,{options:h,value:m,onChange:e=>p(e.target.value)})})]}),n&&(0,a.jsx)(A.P,{intent:d.J.DANGER,title:"Invalid CSV file provided!",children:n})]})}),(0,a.jsx)(o.$,{className:"add-button",text:"Add Users",intent:0===s.length?d.J.NONE:d.J.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(s,m),l([]),p(h[0])}})]})};var L=l(37852),T=l(11678);let F=e=>{let{data:s}=e,{rowIndex:l}=e.node,r=s[e.field],n=c.useCallback(()=>{e.setStateHandler(l,!r)},[e,l,r]);return(0,a.jsx)(T.dO,{checked:r,onChange:n})};var W=l(45111),M=l(31643),V=l(5960),X=l(29458);let J=({data:e,node:s,deleteRowHandler:l})=>{let{rowIndex:r}=s,[n,i]=(0,c.useState)(!1),t=(0,c.useCallback)(()=>{l(r),i(!1)},[l,r]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.$,{icon:y.W.CROSS,onClick:()=>{i(!0)}}),(0,a.jsxs)(W.l,{icon:y.W.WARNING_SIGN,isOpen:n,onClose:()=>i(!1),title:"Warning",children:[(0,a.jsxs)(M.R,{children:[(0,a.jsxs)("p",{children:["Are you sure you want to ",(0,a.jsx)("b",{children:"delete"})," the assessment type ",(0,a.jsx)("i",{children:e.type}),"?"]}),(0,a.jsx)("p",{children:(0,a.jsx)("b",{children:"All related assessments, submissions and answers will be deleted as well upon clicking the main save button."})})]}),(0,a.jsx)(V.E,{actions:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X.A,{label:"Cancel",icon:y.W.CROSS,onClick:()=>i(!1),options:{minimal:!1}}),(0,a.jsx)(X.A,{label:"Ok",icon:y.W.TICK,onClick:t,options:{minimal:!1,intent:d.J.WARNING}})]})})]})]})};var $=l(77555);let B=e=>{let{data:s}=e,{rowIndex:l}=e.node,r=c.useCallback(s=>{e.setStateHandler(l,s)},[e,l]);return(0,a.jsx)($.O,{value:s[e.field],min:0,clampValueOnBlur:!0,onValueChange:r})},K={assessmentConfigId:-1,type:"untitled",isManuallyGraded:!0,isGradingAutoPublished:!1,displayInDashboard:!0,isMinigame:!1,hoursBeforeEarlyXpDecay:0,hasTokenCounter:!1,hasVotingFeatures:!1,earlySubmissionXp:0},_={flex:3,minWidth:70,filter:!1,resizable:!0,sortable:!1},z=(0,c.forwardRef)(({setHasChangesAssessmentConfig:e,initialConfigs:s},l)=>{let n=c.useRef(),i=(0,c.useRef)((0,D.cloneDeep)(s)),[t,d]=(0,c.useState)(s);(0,c.useEffect)(()=>{e(!(0,D.isEqual)(t,s))},[t,s,e]),(0,c.useImperativeHandle)(l,()=>({getData:()=>t,resetData:()=>{d(s),i.current=(0,D.cloneDeep)(s)}}));let u=(0,c.useCallback)((e,s)=>{d(l=>{let a=(0,D.cloneDeep)(l)??[];return a[e].isManuallyGraded=s,s&&(a[e].isGradingAutoPublished=!1,n.current?.getDisplayedRowAtIndex(e)?.setDataValue("isGradingAutoPublished",!1)),n.current?.getDisplayedRowAtIndex(e)?.setDataValue("isManuallyGraded",s),a})},[]),h=(0,c.useCallback)((e,s)=>{d(l=>{let a=(0,D.cloneDeep)(l)??[];return a[e].isGradingAutoPublished=s,s&&(a[e].isManuallyGraded=!1,n.current?.getDisplayedRowAtIndex(e)?.setDataValue("isManuallyGraded",!1)),n.current?.getDisplayedRowAtIndex(e)?.setDataValue("isGradingAutoPublished",s),a})},[]),m=(0,c.useCallback)(e=>(s,l)=>{d(a=>{let r=(0,D.cloneDeep)(a)??[];return r[s][e]=l,n.current?.getDisplayedRowAtIndex(s)?.setDataValue(e,l),r})},[]),p=(0,c.useCallback)(m("displayInDashboard"),[]),x=(0,c.useCallback)(m("isMinigame"),[]),f=(0,c.useCallback)(m("hasTokenCounter"),[]),j=(0,c.useCallback)(m("hasVotingFeatures"),[]),g=(0,c.useCallback)(m("earlySubmissionXp"),[]),b=(0,c.useCallback)(m("hoursBeforeEarlyXpDecay"),[]),C=(0,c.useCallback)(()=>{t.length>=8?(0,L.JB)("You can have at most 8 assessment types!"):(d(e=>[...e,{...K}]),n.current?.applyTransaction({add:[{...K}]}))},[t.length]),v=(0,c.useCallback)(e=>{if(t.length<=1)return void(0,L.JB)("You must have at least 1 assessment type!");d(s=>{let l=(0,D.cloneDeep)(s)??[];return l.splice(e,1),l});let s=n.current?.getDisplayedRowAtIndex(e)?.data;n.current?.applyTransaction({remove:[s]})},[t.length]),N=(0,c.useMemo)(()=>[{headerName:"Assessment Type",field:"type",rowDrag:!0,editable:!0},{headerName:"Is Manually Graded",field:"isManuallyGraded",cellRenderer:F,cellRendererParams:{setStateHandler:u,field:"isManuallyGraded"}},{headerName:"Is Auto-published",field:"isGradingAutoPublished",cellRenderer:F,cellRendererParams:{setStateHandler:h,field:"isGradingAutoPublished"}},{headerName:"Display in Dashboard",field:"displayInDashboard",cellRenderer:F,cellRendererParams:{setStateHandler:p,field:"displayInDashboard"}},{headerName:"Is Minigame",field:"isMinigame",cellRenderer:F,cellRendererParams:{setStateHandler:x,field:"isMinigame"}},{headerName:"Voting Features*",field:"hasVotingFeatures",cellRenderer:F,cellRendererParams:{setStateHandler:j,field:"hasVotingFeatures"}},{headerName:"Token Counter*",field:"hasTokenCounter",cellRenderer:F,cellRendererParams:{setStateHandler:f,field:"hasTokenCounter"}},{headerName:"Max Bonus XP",field:"earlySubmissionXp",cellRenderer:B,cellRendererParams:{setStateHandler:g,field:"earlySubmissionXp"}},{headerName:"Early Hours Before Decay",field:"hoursBeforeEarlyXpDecay",cellRenderer:B,cellRendererParams:{setStateHandler:b,field:"hoursBeforeEarlyXpDecay"}},{headerName:"Delete",field:"placeholderToPreventColumnRerender",cellRenderer:J,cellRendererParams:{deleteRowHandler:v},resizable:!1,flex:2}],[v,p,x,g,f,j,b,h,u,x]),A=(0,c.useCallback)(e=>{let s=e.node,l=e.overNode;if(s!==l){var a,r,n;let e,i=s.data,o=l?.data,c=Y(t,i),u=Y(t,o),h=[...t];a=h,r=c,n=u,e=a[r],a.splice(r,1),a.splice(n,0,e),d(h)}},[t]),y=e=>{n.current?.setGridOption("rowData",t)},U=(0,a.jsxs)("div",{className:"Grid",children:[(0,a.jsx)(S.W6,{theme:R.N8R,domLayout:"autoHeight",columnDefs:N,defaultColDef:_,onGridReady:e=>{n.current=e.api},rowData:i.current,rowHeight:36,rowDragManaged:!0,suppressCellFocus:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0,onRowDragMove:A,onRowDragLeave:y,onRowDragEnd:y,onCellValueChanged:e=>{"type"===e.colDef.field&&d(s=>{let l=(0,D.cloneDeep)(s)??[];return l[e.rowIndex].type=e.value,l})}}),(0,a.jsxs)("div",{className:"footer-text",children:["*If you create an assessment with these toggles enabled, they will be activated within the assessment ",(0,a.jsx)("b",{children:"by default"}),". However, you can also visit ground control to manually override these settings if needed."]})]});return(0,a.jsxs)("div",{className:"assessment-configuration",children:[(0,a.jsxs)("div",{className:"assessment-configuration-header-container",children:[(0,a.jsx)(r.H2,{children:"Assessment Configuration"}),(0,a.jsx)(o.$,{text:"Add Row",onClick:C,className:"add-row-button"})]}),U]})});function Y(e,s){for(let l=0;l<e.length;l++)if((0,D.isEqual)(e[l],s))return l;return -1}var q=l(49492);let Z=e=>{let{data:s}=e,l=c.useCallback(l=>{e.handleUpdateStoriesUserRole(s.id,l.target.value)},[s,e]),r=[{label:"User",value:w.gO.Standard},{label:"Moderator",value:w.gO.Moderator},{label:"Admin",value:w.gO.Admin}];return(0,a.jsx)(g.A,{content:"You cannot downgrade yourself from an admin role!",interactionKind:"click",position:b.yX.TOP,disabled:e.id!==s.id,children:(0,a.jsx)(N.g,{options:r,onChange:l,fill:!0,minimal:!0,style:{textAlign:"center"},value:s.role,disabled:e.id===s.id})})},Q=({data:e,handleDeleteStoriesUserFromUserGroup:s})=>{let[l,r]=(0,c.useState)(!1),n=(0,c.useCallback)(()=>{s(e.id),r(!1)},[e.id,s]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.A,{content:"You cannot delete an admin!",interactionKind:"click",position:b.yX.TOP,disabled:e.role!==w.gO.Admin,children:(0,a.jsx)(o.$,{text:"Delete User",icon:y.W.CROSS,onClick:()=>{e.role===w.gO.Admin?(0,L.JB)("You cannot delete an admin user!"):r(!0)},disabled:e.role===w.gO.Admin})}),(0,a.jsxs)(W.l,{icon:y.W.WARNING_SIGN,isOpen:l,onClose:()=>r(!1),title:"Deleting Stories User",canOutsideClickClose:!0,children:[(0,a.jsx)(M.R,{children:(0,a.jsxs)("p",{children:["Are you sure you want to ",(0,a.jsx)("b",{children:"delete"})," the user"," ",(0,a.jsxs)("i",{children:[e.name," (",e.username,")"]}),"?"]})}),(0,a.jsx)(V.E,{actions:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X.A,{label:"Cancel",icon:y.W.CROSS,onClick:()=>r(!1),options:{minimal:!1}}),(0,a.jsx)(X.A,{label:"Confirm",icon:y.W.TRASH,onClick:n,options:{minimal:!1,intent:d.J.DANGER}})]})})]})]})},ee={flex:1,filter:!0,resizable:!0,sortable:!0},es=e=>{let s=c.useRef(),l=e.storiesUsers?.map(e=>e.name?e:{...e,name:"(user has yet to log in)"}),n=[{headerName:"Name",field:"name",sort:"asc"},{headerName:"Username",field:"username"},{headerName:"Role",field:"role",cellRenderer:Z,cellRendererParams:{id:e.userId,handleUpdateStoriesUserRole:e.handleUpdateStoriesUserRole}},{headerName:"Actions",field:"actions",cellRenderer:Q,cellRendererParams:{handleDeleteStoriesUserFromUserGroup:e.handleDeleteStoriesUserFromUserGroup},filter:!1,resizable:!1}],i=(0,a.jsx)("div",{className:"Grid",children:(0,a.jsx)(S.W6,{theme:R.N8R,domLayout:"autoHeight",columnDefs:n,defaultColDef:ee,onGridReady:e=>{s.current=e.api},rowData:l,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})});return(0,a.jsxs)("div",{className:"users-configuration",children:[(0,a.jsxs)("div",{className:"users-header-container",children:[(0,a.jsx)(r.H2,{children:"Stories Users"}),(0,a.jsx)(o.$,{text:"Export as CSV",className:"export-csv-button",onClick:()=>{s.current&&s.current.exportDataAsCsv({fileName:`SA Stories Users (${new Date().toISOString()}).csv`,columnKeys:["name","username","role"]})}})]}),i]})},el=e=>{let{data:s}=e,l=c.useCallback(l=>{e.handleUpdateUserRole(s.courseRegId,l.target.value)},[s,e]),r=[{label:"Student",value:w.Xh.Student},{label:"Staff",value:w.Xh.Staff},{label:"Admin",value:w.Xh.Admin}];return(0,a.jsx)(g.A,{content:"You cannot downgrade yourself from an admin role!",interactionKind:"click",position:b.yX.TOP,disabled:e.courseRegId!==s.courseRegId,children:(0,a.jsx)(N.g,{options:r,onChange:l,fill:!0,minimal:!0,style:{textAlign:"center"},value:s.role,disabled:e.courseRegId===s.courseRegId})})},ea=({data:e,handleDeleteUserFromCourse:s})=>{let[l,r]=(0,c.useState)(!1),n=(0,c.useCallback)(()=>{s(e.courseRegId),r(!1)},[e.courseRegId,s]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.A,{content:"You cannot delete an admin!",interactionKind:"click",position:b.yX.TOP,disabled:e.role!==w.Xh.Admin,children:(0,a.jsx)(o.$,{text:"Delete User",icon:y.W.CROSS,onClick:()=>{e.role===w.Xh.Admin?(0,L.JB)("You cannot delete an admin user!"):r(!0)},disabled:e.role===w.Xh.Admin})}),(0,a.jsxs)(W.l,{icon:y.W.WARNING_SIGN,isOpen:l,onClose:()=>r(!1),title:"Deleting User From Course",canOutsideClickClose:!0,children:[(0,a.jsxs)(M.R,{children:[(0,a.jsxs)("p",{children:["Are you sure you want to ",(0,a.jsx)("b",{children:"delete"})," the user"," ",(0,a.jsxs)("i",{children:[e.name," (",e.username,")"]}),"?"]}),(0,a.jsx)("p",{children:(0,a.jsx)("b",{children:"All their assessment answers will be deleted as well."})})]}),(0,a.jsx)(V.E,{actions:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X.A,{label:"Cancel",icon:y.W.CROSS,onClick:()=>r(!1),options:{minimal:!1}}),(0,a.jsx)(X.A,{label:"Confirm",icon:y.W.TRASH,onClick:n,options:{minimal:!1,intent:d.J.DANGER}})]})})]})]})},er={flex:1,filter:!0,resizable:!0,sortable:!0},en=e=>{let s=c.useRef(),l=e.userCourseRegistrations?.map(e=>e.name?e:{...e,name:"(user has yet to log in)"}),n=[{headerName:"Name",field:"name",sort:"asc"},{headerName:"Username",field:"username"},{headerName:"Group",field:"group"},{headerName:"Role",field:"role",cellRenderer:el,cellRendererParams:{courseRegId:e.courseRegId,handleUpdateUserRole:e.handleUpdateUserRole}},{headerName:"Actions",field:"actions",cellRenderer:ea,cellRendererParams:{handleDeleteUserFromCourse:e.handleDeleteUserFromCourse},filter:!1,resizable:!1}],i=(0,a.jsx)("div",{className:"Grid",children:(0,a.jsx)(S.W6,{theme:R.N8R,domLayout:"autoHeight",columnDefs:n,defaultColDef:er,onGridReady:e=>{s.current=e.api},rowData:l,rowHeight:36,suppressCellFocus:!0,suppressMovableColumns:!0,pagination:!0})});return(0,a.jsxs)("div",{className:"users-configuration",children:[(0,a.jsxs)("div",{className:"users-header-container",children:[(0,a.jsx)(r.H2,{children:"Users"}),(0,a.jsx)(o.$,{text:"Export as CSV",className:"export-csv-button",onClick:()=>{s.current&&s.current.exportDataAsCsv({fileName:`SA Users (${new Date().toISOString()}).csv`,columnKeys:["name","username","group","role"]})}})]}),i]})},ei={courseName:"",courseShortName:"",viewable:!0,enableGame:!0,enableAchievements:!0,enableOverallLeaderboard:!0,enableContestLeaderboard:!0,topLeaderboardDisplay:100,topContestLeaderboardDisplay:10,enableSourcecast:!0,enableStories:!1,enableLlmGrading:!1,moduleHelpText:"",llmApiKey:"",llmModel:"",llmApiUrl:"",llmCourseLevelPrompt:""},et=()=>{let[e,s]=(0,c.useState)(!1),[l,j]=(0,c.useState)(!1),[g,b]=(0,c.useState)(ei),C=(0,u.wA)(),v=(0,h.wV)(),N=(0,h.N4)(e=>e.stories);(0,c.useEffect)(()=>{C(x.A.fetchCourseConfig()),C(x.A.fetchAssessmentConfigs()),C(x.A.fetchAdminPanelCourseRegistrations())},[C]),(0,c.useEffect)(()=>{v.enableStories&&C(p.A.fetchAdminPanelStoriesUsers())},[C,v.enableStories]),(0,c.useEffect)(()=>{b({courseName:v.courseName,courseShortName:v.courseShortName,viewable:v.viewable,enableGame:v.enableGame,enableAchievements:v.enableAchievements,enableOverallLeaderboard:v.enableOverallLeaderboard,enableContestLeaderboard:v.enableContestLeaderboard,topLeaderboardDisplay:v.topLeaderboardDisplay,topContestLeaderboardDisplay:v.topContestLeaderboardDisplay,enableSourcecast:v.enableSourcecast,enableStories:v.enableStories,enableLlmGrading:v.enableLlmGrading,moduleHelpText:v.moduleHelpText,llmModel:v.llmModel,llmApiUrl:v.llmApiUrl,llmCourseLevelPrompt:v.llmCourseLevelPrompt})},[v.courseName,v.courseShortName,v.enableAchievements,v.enableOverallLeaderboard,v.enableContestLeaderboard,v.topLeaderboardDisplay,v.topContestLeaderboardDisplay,v.enableGame,v.enableSourcecast,v.enableStories,v.enableLlmGrading,v.moduleHelpText,v.viewable,v.llmModel,v.llmApiUrl,v.llmCourseLevelPrompt]);let A=(0,c.useRef)(null);(0,c.useEffect)(()=>{A.current?.resetData()},[v.assessmentConfigurations]);let y={userId:N.userId,storiesUsers:N.storiesUsers,handleUpdateStoriesUserRole:(e,s)=>C(x.A.updateStoriesUserRole(e,s)),handleDeleteStoriesUserFromUserGroup:e=>C(x.A.deleteStoriesUserUserGroups(e))},R=(0,c.useCallback)(()=>{e&&(C(x.A.updateCourseConfig(g)),s(!1));let a=A.current?.getData()??[],r=v.assessmentConfigurations??[],n=new Set(a.map(e=>e.assessmentConfigId));r.filter(e=>!n.has(e.assessmentConfigId)).forEach(e=>C(x.A.deleteAssessmentConfig(e))),l&&(C(x.A.updateAssessmentConfigs(a)),j(!1))},[g,C,l,e,v.assessmentConfigurations]),S=(0,a.jsxs)("div",{className:"admin-panel",children:[(0,a.jsx)(r.H1,{children:"Admin Panel"}),(0,a.jsxs)(n.t,{id:"admin-panel",renderActiveTabPanelOnly:!0,children:[(0,a.jsx)(i.o,{id:"configuration",title:"Configuration",panel:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q.A,{courseConfiguration:g,setCourseConfiguration:e=>{b(e),s(!0)}}),(0,a.jsx)(t.c,{}),(0,a.jsx)(z,{ref:A,initialConfigs:v.assessmentConfigurations??[],setHasChangesAssessmentConfig:j}),(0,a.jsx)(o.$,{text:"Save",disabled:!e&&!l,style:{marginTop:"15px"},intent:e||l?d.J.WARNING:d.J.NONE,onClick:R})]})}),(0,a.jsx)(i.o,{id:"users",title:"Users",panel:(0,a.jsx)(en,{courseRegId:v.courseRegId,userCourseRegistrations:v.userCourseRegistrations,handleUpdateUserRole:(e,s)=>C(x.A.updateUserRole(e,s)),handleDeleteUserFromCourse:e=>C(x.A.deleteUserCourseRegistration(e))})}),(0,a.jsx)(i.o,{id:"stories-users",title:"Stories Users",panel:(0,a.jsx)(es,{...y})}),(0,a.jsx)(i.o,{id:"add-users",title:"Add Users",panel:(0,a.jsx)(E,{handleAddNewUsersToCourse:(e,s)=>C(m.A.addNewUsersToCourse(e,s))})}),(0,a.jsx)(i.o,{id:"add-stories-users",title:"Add Stories Users",panel:(0,a.jsx)(G,{handleAddNewUsersToCourse:(e,s)=>C(m.A.addNewStoriesUsersToCourse(e,s))})})]})]});return(0,a.jsx)(f.A,{display:S,fullWidth:!1})},eo=et;eo.displayName="AdminPanel";let ed=et}}]);
//# sourceMappingURL=56159.41ba8083.js.map